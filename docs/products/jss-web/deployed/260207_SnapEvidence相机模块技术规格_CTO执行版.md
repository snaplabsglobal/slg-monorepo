# SnapEvidence ç›¸æœºæ¨¡å—æŠ€æœ¯è§„æ ¼æ–‡æ¡£ï¼ˆCTOæ‰§è¡Œç‰ˆï¼‰

> **æ–‡æ¡£ç±»å‹ï¼š** æŠ€æœ¯è§„æ ¼ + æ¶æ„è®¾è®¡  
> **å…³è”æ–‡æ¡£ï¼š** 260204074_JobPhotosäº§å“è§„åˆ’.md, 260204079_Phase1æ‰§è¡Œè®¡åˆ’.md  
> **åˆ›å»ºæ—¶é—´ï¼š** 2026-02-07  
> **ä¼˜å…ˆçº§ï¼š** ğŸ”´ P0 - Phase 1æ ¸å¿ƒæ¨¡å—  
> **æŠ€æœ¯æ ˆï¼š** PWAï¼ˆç°é˜¶æ®µï¼‰

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦ï¼ˆ30ç§’ç‰ˆï¼‰

**ç›®æ ‡ï¼š** åœ¨PWAç¯å¢ƒä¸‹å®ç°"å·¥åœ°çº§ç›¸æœº"â€”â€”è¿æ‹ä¸å¡ã€ç¦»çº¿ä¸ä¸¢ã€è‡ªåŠ¨è¡¥ä¼ 

**æ ¸å¿ƒåŸåˆ™ï¼š**
1. **æ‹ç…§æ°¸è¿œä¸ç­‰ç½‘ç»œ**
2. **æœ¬åœ°æŒä¹…åŒ–ä¼˜å…ˆäºäº‘ç«¯**
3. **çŠ¶æ€å¯è§ã€å¯æ¢å¤ã€å¯é‡è¯•**

**å…³é”®å†³ç­–ï¼š**
- âœ… Phase 1ç”¨PWAå®ç°ï¼ˆä¸é˜»å¡ä¸Šçº¿ï¼‰
- âœ… åŸç”ŸAppä½œä¸ºPhase 2æ€§èƒ½å‡çº§
- âœ… è¿½æ±‚"ä¸ä¸¢ä¸ä¹±"è€Œé"æœ€å¿«å¸§ç‡"

---

## ğŸ¯ äº§å“èƒŒæ™¯ä¸æˆ˜ç•¥å®šä½

### ä¸ºä»€ä¹ˆè¦åšSnapEvidenceï¼Ÿ

**å¸‚åœºæœºä¼šï¼š**
- Procoreç§»åŠ¨ç«¯ä½“éªŒå·®ï¼ˆæ…¢ã€ä¸¢ã€æ‰¾ä¸åˆ°ï¼‰
- CompanyCamå•ç‚¹åŠŸèƒ½ï¼ˆ$30+/æœˆé¢å¤–æˆæœ¬ï¼‰
- Roofræ²¡æœ‰åŸç”ŸAppï¼ˆPWAæ‹ç…§æå¼±ï¼‰

**æˆ‘ä»¬çš„å·®å¼‚åŒ–ï¼š**
- ä¸åªæ˜¯"æ‹ç…§"ï¼Œæ˜¯"å­˜è¯"
- ä¸LedgerSnapè´¢åŠ¡é—­ç¯
- ä¸Jobç®¡ç†æ·±åº¦é›†æˆ

**ä¸€å¥è¯å®šä½ï¼š**
> å…¨ä¸–ç•Œæœ€ä¸å®¹æ˜“ä¸¢è¯æ®çš„å·¥åœ°ç›¸æœº

---

## ğŸ§± ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ ¸å¿ƒç†å¿µ

```
æ‹ç…§ = å†™å…¥æœ¬åœ°äº‹å®
ä¸Šä¼  = åå°å¤åˆ¶

[æ‹ç…§æµç¨‹]
å¿«é—¨æŒ‰ä¸‹ â†’ ç«‹å³å†™å…¥æœ¬åœ° â†’ æ˜¾ç¤ºç¼©ç•¥å›¾ â†’ åå°ä¸Šä¼ 

[å¤±è´¥æ¢å¤]
æ–­ç½‘/å´©æºƒ â†’ æœ¬åœ°é˜Ÿåˆ—ä¿ç•™ â†’ ç½‘ç»œæ¢å¤ â†’ è‡ªåŠ¨è¡¥ä¼ 
```

---

### ç»„ä»¶æ€»è§ˆï¼ˆ4ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Camera UIï¼ˆå‰å°äº¤äº’ï¼‰                â”‚
â”‚  - å¿«é—¨æ§åˆ¶                                  â”‚
â”‚  - ç¼©ç•¥æ¡æ˜¾ç¤º                                â”‚
â”‚  - çŠ¶æ€åé¦ˆ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ å†™å…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Local Storeï¼ˆæœ¬åœ°æŒä¹…åŒ–å±‚ï¼‰               â”‚
â”‚  - IndexedDB: items + blobs                 â”‚
â”‚  - OPFS (å¯é€‰)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ è¯»å–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Upload Queueï¼ˆä¸Šä¼ é˜Ÿåˆ—ï¼‰                  â”‚
â”‚  - çŠ¶æ€æœº: pendingâ†’uploadingâ†’uploaded       â”‚
â”‚  - é‡è¯•ç­–ç•¥                                  â”‚
â”‚  - å¤±è´¥æ¢å¤                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ è°ƒåº¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sync Orchestratorï¼ˆåŒæ­¥è°ƒåº¦å™¨ï¼‰             â”‚
â”‚  - ç½‘ç»œäº‹ä»¶è§¦å‘                              â”‚
â”‚  - Appå”¤é†’è§¦å‘                               â”‚
â”‚  - æ™ºèƒ½èŠ‚æµ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ æ¨¡å—1ï¼šCamera UIï¼ˆå‰å°äº¤äº’ï¼‰

### A. å¿«é—¨å“åº”ï¼ˆå¿…é¡»æé€Ÿï¼‰

**æ¯æ¬¡å¿«é—¨åªåš3ä»¶äº‹ï¼š**

```javascript
async function onShutterClick() {
  // 1. ç”Ÿæˆé˜Ÿåˆ—é¡¹ï¼ˆè½»é‡å…ƒæ•°æ®ï¼‰
  const item = {
    id: uuid(),
    job_id: currentJobId, // ç”¨æˆ·é¢„é€‰çš„Job
    taken_at: new Date().toISOString(),
    stage: 'during', // é»˜è®¤
    status: 'pending'
  };
  
  // 2. å†™å…¥æœ¬åœ°å­˜å‚¨
  await localStore.saveItem(item, photoBlob);
  
  // 3. ç«‹å³æ˜¾ç¤ºç¼©ç•¥å›¾
  thumbnailStrip.append(item.id, blobURL);
  
  // âŒ ä¸åšï¼šä¸Šä¼ ã€å‹ç¼©ã€æ°´å°ï¼ˆåå°å¼‚æ­¥å¤„ç†ï¼‰
}
```

**æ€§èƒ½è¦æ±‚ï¼š**
- å¿«é—¨å“åº”æ—¶é—´ï¼š< 100ms
- è¿æ‹é—´éš”ï¼š< 200ms
- ä¸»çº¿ç¨‹ä¸é˜»å¡

---

### B. ç¼©ç•¥æ¡ï¼ˆçŠ¶æ€å¯è§ï¼‰

**UIè®¾è®¡ï¼š**
```
[ç›¸æœºç”»é¢]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ç¼©ç•¥æ¡]
â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â”
â”‚ğŸ•’â”‚ â”‚â¬†ï¸â”‚ â”‚âœ…â”‚ â”‚âš ï¸â”‚
â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜
pending uploading uploaded failed
```

**çŠ¶æ€è§’æ ‡ï¼š**
- ğŸ•’ `pending` - ç°è‰²åœ†ç‚¹
- â¬†ï¸ `uploading` - è“è‰²ä¸Šä¼ ç®­å¤´ï¼ˆå¸¦è¿›åº¦ç¯ï¼‰
- âœ… `uploaded` - ç»¿è‰²å¯¹å‹¾
- âš ï¸ `failed` - çº¢è‰²æ„Ÿå¹å·ï¼ˆå¯ç‚¹å‡»é‡è¯•ï¼‰

**äº¤äº’ï¼š**
- ç‚¹å‡»ç¼©ç•¥å›¾ â†’ å…¨å±æŸ¥çœ‹
- é•¿æŒ‰ç¼©ç•¥å›¾ â†’ å”¤èµ·è¯­éŸ³å¤‡æ³¨ï¼ˆPhase 1.5ï¼‰
- ç‚¹å‡»å¤±è´¥å›¾æ ‡ â†’ æ‰‹åŠ¨é‡è¯•ä¸Šä¼ 

---

### C. å•æ‰‹æ“ä½œä¼˜åŒ–

**åŸåˆ™ï¼š** å¸ˆå‚…åœ¨æ¢¯å­ä¸Šåªæœ‰ä¸€åªæ‰‹èƒ½ç”¨

**UIå¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚   [ç›¸æœºç”»é¢]         â”‚
â”‚                     â”‚
â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç¼©ç•¥æ¡]             â”‚ â† åº•éƒ¨20%
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    [å¤§å¿«é—¨æŒ‰é’®]      â”‚ â† æ‹‡æŒ‡åŒºï¼ˆå³ä¸‹ï¼‰
â”‚  [åˆ‡Job] [è®¾ç½®]      â”‚ â† æ¬¡è¦æ“ä½œï¼ˆå·¦ä¸‹ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å†³ç­–ï¼š**
- å¿«é—¨æŒ‰é’®ï¼šç›´å¾„â‰¥64px
- ä½ç½®ï¼šå³ä¸‹è§’ï¼ˆå³æ‰‹æ‹‡æŒ‡è‡ªç„¶è¦†ç›–ï¼‰
- åˆ‡æ¢Jobï¼šå·¦ä¸‹è§’ï¼ˆä¸å¸¸ç”¨ï¼Œé¿å…è¯¯è§¦ï¼‰

---

## ğŸ’¾ æ¨¡å—2ï¼šLocal Storeï¼ˆæœ¬åœ°æŒä¹…åŒ–ï¼‰

### A. IndexedDB Schemaè®¾è®¡

**Database: `jobsite_snap`**  
**Version: 1**

#### Object Store 1: `photo_items`

```typescript
interface PhotoItem {
  id: string;              // UUID
  job_id: string;          // å¿…é¡»ï¼Œå¤–é”®
  taken_at: string;        // ISO 8601 æœ¬åœ°æ—¶é—´
  stage: 'before' | 'during' | 'after';
  area_id?: string;        // å¯ç©º
  trade_id?: string;       // å¯ç©º
  
  // ä¸Šä¼ çŠ¶æ€
  status: 'pending' | 'uploading' | 'uploaded' | 'failed';
  attempts: number;        // é‡è¯•æ¬¡æ•°
  last_error?: string;     // æœ€åé”™è¯¯ä¿¡æ¯
  
  // æœåŠ¡å™¨å›æ‰§
  uploaded_at?: string;
  server_file_id?: string;
  
  // å…ƒæ•°æ®
  mime_type: string;
  byte_size: number;
  watermark_version?: string;
}
```

**ç´¢å¼•ï¼š**
```javascript
photo_items.createIndex('by_job', 'job_id');
photo_items.createIndex('by_status', 'status');
photo_items.createIndex('by_taken_at', 'taken_at');
```

---

#### Object Store 2: `photo_blobs`

```typescript
interface PhotoBlob {
  id: string;           // åŒphoto_items.id
  blob: Blob;           // åŸå›¾æˆ–å‹ç¼©å›¾
  thumbnail?: Blob;     // ç¼©ç•¥å›¾ï¼ˆå¯é€‰ï¼‰
}
```

**ä¸ºä»€ä¹ˆåˆ†å¼€å­˜ï¼š**
- `items`è½»é‡ï¼ŒæŸ¥è¯¢å¿«
- `blobs`å¤§ä½“ç§¯ï¼ŒæŒ‰éœ€è¯»å–
- é¿å…ä¸€æ¬¡åŠ è½½å¤§é‡äºŒè¿›åˆ¶æ•°æ®

---

### B. OPFSï¼ˆå¯é€‰ï¼ŒPhase 1.5ï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- å¦‚æœIndexedDBå­˜blobåœ¨æŸäº›æœºå‹ä¸ç¨³å®š
- éœ€è¦æ›´å¤§å­˜å‚¨ç©ºé—´ï¼ˆ>1GBï¼‰

**å®ç°æ€è·¯ï¼š**
```javascript
// photo_blobsæ”¹ä¸ºå­˜å¼•ç”¨
interface PhotoBlob {
  id: string;
  opfs_path: string;  // ä¾‹å¦‚ï¼š/photos/abc-123.jpg
}

// å®é™…æ–‡ä»¶åœ¨OPFS
const root = await navigator.storage.getDirectory();
const photoDir = await root.getDirectoryHandle('photos', { create: true });
```

**å†³ç­–ï¼š** Phase 1å…ˆç”¨IndexedDBï¼Œæœ‰é—®é¢˜å†ä¸ŠOPFS

---

### C. å´©æºƒæ¢å¤æœºåˆ¶

**é—®é¢˜åœºæ™¯ï¼š**
- æ‹ç…§è¿‡ç¨‹ä¸­æµè§ˆå™¨å´©æºƒ
- è®¾å¤‡çªç„¶å…³æœº
- å†…å­˜ä¸è¶³è¢«ç³»ç»Ÿæ€æ­»

**æ¢å¤ç­–ç•¥ï¼š**
```javascript
// Appå¯åŠ¨æ—¶æ‰§è¡Œ
async function recoverOrphanedPhotos() {
  // 1. æ‰«ææ‰€æœ‰status='uploading'çš„é¡¹
  const orphaned = await db.photo_items
    .where('status').equals('uploading')
    .toArray();
  
  // 2. é‡ç½®ä¸ºpendingï¼ˆé¿å…å¡æ­»ï¼‰
  for (const item of orphaned) {
    item.status = 'pending';
    item.attempts = 0;
    await db.photo_items.put(item);
  }
  
  // 3. è§¦å‘åŒæ­¥
  syncOrchestrator.trigger();
}
```

---

## â¬†ï¸ æ¨¡å—3ï¼šUpload Queueï¼ˆä¸Šä¼ é˜Ÿåˆ—ï¼‰

### A. çŠ¶æ€æœºï¼ˆä¸¥æ ¼æ‰§è¡Œï¼‰

```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ pending  â”‚ â† åˆå§‹çŠ¶æ€
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚ å¼€å§‹ä¸Šä¼ 
          â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚uploading â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚
    æˆåŠŸ  â”‚  å¤±è´¥
     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
     â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚uploaded â”‚ â”‚ failed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                â”‚ é‡è¯•
                â””â”€â”€â†’ pending
```

**çŠ¶æ€è½¬æ¢è§„åˆ™ï¼š**
```typescript
const validTransitions = {
  'pending': ['uploading'],
  'uploading': ['uploaded', 'failed'],
  'failed': ['pending'],
  'uploaded': [] // ç»ˆæ€
};
```

---

### B. å¹¶å‘æ§åˆ¶

**Phase 1é…ç½®ï¼š**
```javascript
const UPLOAD_CONFIG = {
  maxConcurrent: 2,      // ç§»åŠ¨ç«¯ä¸è¶…è¿‡2ä¸ªå¹¶å‘
  maxRetries: 3,         // å•å¼ æœ€å¤šé‡è¯•3æ¬¡
  retryDelays: [1000, 5000, 30000], // 1s, 5s, 30s
  timeout: 60000         // å•å¼ ä¸Šä¼ è¶…æ—¶60ç§’
};
```

**ä¸ºä»€ä¹ˆåª2ä¸ªå¹¶å‘ï¼Ÿ**
- ç§»åŠ¨ç«¯ç½‘ç»œä¸ç¨³å®š
- é¿å…æŠ¢å å¸¦å®½å¯¼è‡´å…¨éƒ¨æ…¢
- é™ä½æœåŠ¡å™¨å‹åŠ›

---

### C. ä¸Šä¼ å™¨å®ç°ï¼ˆä¼ªä»£ç ï¼‰

```typescript
class UploadQueue {
  private running: Set<string> = new Set();
  
  async processQueue() {
    // è·å–å¾…ä¸Šä¼ é¡¹
    const pending = await db.photo_items
      .where('status').equals('pending')
      .limit(10)
      .toArray();
    
    for (const item of pending) {
      // å¹¶å‘æ§åˆ¶
      if (this.running.size >= UPLOAD_CONFIG.maxConcurrent) {
        break;
      }
      
      this.running.add(item.id);
      this.uploadOne(item).finally(() => {
        this.running.delete(item.id);
        this.processQueue(); // ç»§ç»­å¤„ç†é˜Ÿåˆ—
      });
    }
  }
  
  async uploadOne(item: PhotoItem) {
    try {
      // 1. æ›´æ–°çŠ¶æ€
      item.status = 'uploading';
      await db.photo_items.put(item);
      
      // 2. è·å–blobï¼ˆå¯èƒ½éœ€è¦ç”Ÿæˆæ°´å°ï¼‰
      const blob = await this.prepareBlob(item);
      
      // 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
      const response = await this.uploadToServer(blob, item);
      
      // 4. æˆåŠŸï¼Œæ›´æ–°çŠ¶æ€
      item.status = 'uploaded';
      item.uploaded_at = new Date().toISOString();
      item.server_file_id = response.file_id;
      await db.photo_items.put(item);
      
    } catch (error) {
      // 5. å¤±è´¥ï¼Œé‡è¯•é€»è¾‘
      item.attempts += 1;
      
      if (item.attempts >= UPLOAD_CONFIG.maxRetries) {
        item.status = 'failed';
        item.last_error = error.message;
      } else {
        item.status = 'pending'; // é‡æ–°æ’é˜Ÿ
      }
      
      await db.photo_items.put(item);
    }
  }
  
  async prepareBlob(item: PhotoItem): Promise<Blob> {
    // è·å–åŸå›¾
    const blobRecord = await db.photo_blobs.get(item.id);
    const originalBlob = blobRecord.blob;
    
    // Phase 1: åå°ç”Ÿæˆæ°´å°
    if (!item.watermark_version) {
      return await this.addWatermark(originalBlob, item);
    }
    
    return originalBlob;
  }
  
  async addWatermark(blob: Blob, item: PhotoItem): Promise<Blob> {
    // åœ¨Web Workerä¸­ç”Ÿæˆæ°´å°ï¼ˆä¸é˜»å¡ä¸»çº¿ç¨‹ï¼‰
    const watermarkedBlob = await watermarkWorker.generate({
      image: blob,
      text: [
        item.job_name,
        formatDateTime(item.taken_at),
        'Vancouver, BC'
      ]
    });
    
    // æ›´æ–°è®°å½•
    item.watermark_version = 'v1';
    await db.photo_items.put(item);
    
    return watermarkedBlob;
  }
}
```

---

## ğŸ”„ æ¨¡å—4ï¼šSync Orchestratorï¼ˆåŒæ­¥è°ƒåº¦ï¼‰

### A. è§¦å‘æ—¶æœºï¼ˆPhase 1å¿…å¤‡ï¼‰

**4ä¸ªå…³é”®è§¦å‘ç‚¹ï¼š**

```typescript
class SyncOrchestrator {
  constructor() {
    // 1. ç½‘ç»œçŠ¶æ€å˜åŒ–
    window.addEventListener('online', () => {
      this.trigger('network_online');
    });
    
    // 2. Appå¯è§æ€§å˜åŒ–
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        this.trigger('app_visible');
      }
    });
    
    // 3. ç”¨æˆ·è¿›å…¥æ—¶é—´çº¿é¡µé¢
    router.on('/jobs/:id/photos', () => {
      this.trigger('photos_page_enter');
    });
    
    // 4. æ‹ç…§åè½»è§¦å‘ï¼ˆå»¶è¿Ÿ5ç§’ï¼‰
    this.onPhotoTaken = debounce(() => {
      this.trigger('photo_taken');
    }, 5000);
  }
  
  trigger(reason: string) {
    // èŠ‚æµï¼šåŒä¸€åŸå› 5åˆ†é’Ÿå†…åªè§¦å‘ä¸€æ¬¡
    if (this.recentTriggers.has(reason)) return;
    
    this.recentTriggers.add(reason);
    setTimeout(() => this.recentTriggers.delete(reason), 300000);
    
    // æ‰§è¡ŒåŒæ­¥
    uploadQueue.processQueue();
  }
}
```

---

### B. Service Workerï¼ˆå¯é€‰å¢å¼ºï¼‰

**Phase 1ä¸å¼ºä¾èµ–ï¼Œä½†å¯ä»¥åšï¼š**

```javascript
// sw.js
self.addEventListener('sync', event => {
  if (event.tag === 'upload-photos') {
    event.waitUntil(
      // å°è¯•ä¸Šä¼ pendingçš„ç…§ç‰‡
      uploadQueue.processQueue()
    );
  }
});

// æ³¨å†ŒBackground Syncï¼ˆå¦‚æœæ”¯æŒï¼‰
if ('sync' in registration) {
  await registration.sync.register('upload-photos');
}
```

**é—®é¢˜ï¼š**
- iOS Safariä¸æ”¯æŒBackground Sync
- ä¸èƒ½ä½œä¸ºPhase 1æˆåŠŸæ¡ä»¶

**å†³ç­–ï¼š** å…ˆç”¨Appå”¤é†’è§¦å‘ï¼ŒPhase 2å†ä¼˜åŒ–

---

## ğŸ“¸ æ°´å°ç”Ÿæˆè§„èŒƒ

### A. Phase 1æ°´å°å†…å®¹ï¼ˆåªè¿™3é¡¹ï¼‰

```
[Job Name or ID]
2026-02-18 14:32:08 PST
Vancouver, BC
```

**ç¤ºä¾‹ï¼š**
```
Cambie St â€“ Unit 3
2026-02-18 14:32:08 PST
Vancouver, BC
```

---

### B. è§†è§‰è§„èŒƒï¼ˆä¸å¯éšæ„ä¿®æ”¹ï¼‰

| å±æ€§ | è§„æ ¼ |
|------|------|
| **ä½ç½®** | å³ä¸‹è§’ï¼Œè·è¾¹ç¼˜â‰¥16px |
| **å­—ä½“** | System font (iOS/Androidé»˜è®¤) |
| **å¤§å°** | 10-12ptï¼ˆè‡ªé€‚åº”åˆ†è¾¨ç‡ï¼‰ |
| **é¢œè‰²** | ç™½è‰² + 1pxé»‘è‰²æè¾¹ï¼ˆé˜²äº®èƒŒæ™¯ï¼‰ |
| **é€æ˜åº¦** | 60-70% |
| **å¯¹é½** | å³å¯¹é½ |

**CSSå‚è€ƒï¼š**
```css
.watermark {
  position: absolute;
  bottom: 16px;
  right: 16px;
  
  font-family: system-ui;
  font-size: 10pt;
  line-height: 1.4;
  text-align: right;
  
  color: white;
  text-shadow: 
    -1px -1px 0 #000,
     1px -1px 0 #000,
    -1px  1px 0 #000,
     1px  1px 0 #000;
  
  opacity: 0.65;
}
```

---

### C. ç”Ÿæˆæ—¶æœºï¼ˆåå°å¼‚æ­¥ï¼‰

**æµç¨‹ï¼š**
```
å¿«é—¨ â†’ ä¿å­˜åŸå›¾ â†’ æ˜¾ç¤ºç¼©ç•¥å›¾
         â†“
    åå°Web Worker
         â†“
    ç”Ÿæˆæ°´å°å›¾ â†’ æ›¿æ¢ä¸Šä¼ ç‰ˆæœ¬
```

**Web Workerå®ç°ï¼š**
```javascript
// watermark.worker.js
self.onmessage = async (e) => {
  const { imageBlob, text } = e.data;
  
  // 1. åŠ è½½åŸå›¾
  const bitmap = await createImageBitmap(imageBlob);
  
  // 2. åˆ›å»ºCanvas
  const canvas = new OffscreenCanvas(bitmap.width, bitmap.height);
  const ctx = canvas.getContext('2d');
  
  // 3. ç»˜åˆ¶åŸå›¾
  ctx.drawImage(bitmap, 0, 0);
  
  // 4. ç»˜åˆ¶æ°´å°
  ctx.font = '12pt system-ui';
  ctx.fillStyle = 'rgba(255, 255, 255, 0.65)';
  ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
  ctx.textAlign = 'right';
  
  const x = bitmap.width - 16;
  let y = bitmap.height - 16;
  
  text.forEach(line => {
    ctx.strokeText(line, x, y);
    ctx.fillText(line, x, y);
    y -= 18; // è¡Œé—´è·
  });
  
  // 5. è½¬å›Blob
  const watermarkedBlob = await canvas.convertToBlob({
    type: 'image/jpeg',
    quality: 0.9
  });
  
  self.postMessage({ watermarkedBlob });
};
```

---

### D. Phase 1æ˜ç¡®ä¸åšï¼ˆå†™è¿›ä»£ç æ³¨é‡Šï¼‰

```typescript
// Phase 1 Watermark Guardrails:
// âŒ No weather data (requires external API)
// âŒ No temperature/humidity
// âŒ No user-editable watermark content
// âŒ No toggle to disable watermark
// âŒ No legal disclaimer text
// âŒ No QR codes

// Phase 2+ Features (ç•™æ¥å£ï¼Œä¸å®ç°):
interface WatermarkConfig {
  version: string;           // v1
  fields: string[];          // ['job', 'time', 'location']
  include_weather?: boolean; // Phase 2
  geo_precision?: 'city' | 'latlng'; // Phase 2
}
```

---

## ğŸ¯ Jobå½’å±ç­–ç•¥ï¼ˆé›¶é”™æ–¹æ¡ˆï¼‰

### A. Phase 1ï¼šç”¨æˆ·é¢„é€‰æ¨¡å¼

**åŸåˆ™ï¼š** ç…§ç‰‡å½’å±100%ç”±ç”¨æˆ·æ§åˆ¶ï¼ŒGPSåªåšæç¤º

**æµç¨‹ï¼š**
```
1. ç”¨æˆ·è¿›å…¥ç›¸æœºå‰ â†’ é€‰æ‹©"Current Job"
2. ç›¸æœºæ‰“å¼€ â†’ æ˜¾ç¤ºå½“å‰Jobåç§°ï¼ˆé¡¶éƒ¨ï¼‰
3. GPSæ£€æµ‹ â†’ å¦‚æœåœ¨å…¶ä»–JobèŒƒå›´å†… â†’ æ˜¾ç¤ºåˆ‡æ¢æç¤º
4. æ‹ç…§ â†’ è‡ªåŠ¨å½’å±åˆ°"Current Job"
```

**UIç¤ºä¾‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Cambie St â€“ Unit 3   â”‚ â† å½“å‰Job
â”‚    [Switch Job â–¾]       â”‚ â† ç‚¹å‡»å¿«é€Ÿåˆ‡æ¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   [ç›¸æœºç”»é¢]             â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### B. GPSæç¤ºï¼ˆä¸è‡ªåŠ¨æ›´æ”¹ï¼‰

**æ£€æµ‹é€»è¾‘ï¼š**
```typescript
async function checkJobProximity() {
  const currentLocation = await getCurrentPosition();
  const nearbyJobs = await findJobsNear(currentLocation, 200); // 200ç±³
  
  if (nearbyJobs.length > 0 && nearbyJobs[0].id !== currentJob.id) {
    // æ˜¾ç¤ºæç¤ºï¼Œä½†ä¸è‡ªåŠ¨åˆ‡æ¢
    showJobSwitchSuggestion(nearbyJobs[0]);
  }
}

function showJobSwitchSuggestion(suggestedJob) {
  // éé˜»å¡å¼æç¤ºï¼ˆSnackbar/Toastï¼‰
  toast.show({
    message: `Looks like you're at ${suggestedJob.name}`,
    action: 'Switch',
    onAction: () => switchToJob(suggestedJob.id)
  });
}
```

**ä¸ºä»€ä¹ˆä¸è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ**
- âœ… GPSå¯èƒ½è¯¯å·®å‡ åç±³
- âœ… é¿å…"ç…§ç‰‡è·‘é”™å·¥åœ°"ä¿¡ä»»äº‹æ•…
- âœ… å¸ˆå‚…å¯èƒ½åœ¨å·¥åœ°è¾¹ç¼˜æ‹è¿œå¤„

---

### C. è¾¹ç•Œæƒ…å†µå¤„ç†

**åœºæ™¯1ï¼šæœªé€‰Jobå°±æƒ³æ‹ç…§**
```
è¿›å…¥ç›¸æœº â†’ æ£€æµ‹currentJob
if (!currentJob) {
  æ˜¾ç¤ºï¼š"Please select a job first"
  æä¾›ï¼š[Select Job] æŒ‰é’®
  ç¦ç”¨ï¼šå¿«é—¨æŒ‰é’®
}
```

**åœºæ™¯2ï¼šGPSå®šä½å¤±è´¥**
```
// ä¸å½±å“æ‹ç…§ï¼Œåªæ˜¯æ²¡æœ‰ä½ç½®æç¤º
// æ°´å°ä¸­çš„"Vancouver, BC"ä»ç”¨æˆ·è®¾ç½®æˆ–é»˜è®¤å€¼è·å–
```

**åœºæ™¯3ï¼šåŒæ—¶åœ¨å¤šä¸ªJobèŒƒå›´å†…ï¼ˆç½•è§ï¼‰**
```
// åªæç¤ºç¬¬ä¸€ä¸ªï¼Œä¸æ˜¾ç¤ºåˆ—è¡¨ï¼ˆé¿å…å¹²æ‰°ï¼‰
// ç”¨æˆ·å¯ä»¥é€šè¿‡[Switch Job]æ‰‹åŠ¨é€‰æ‹©
```

---

## ğŸ” éªŒæ”¶æµ‹è¯•æ¸…å•

### Phase 1å¿…é¡»é€šè¿‡çš„æµ‹è¯•ï¼ˆå…±12é¡¹ï¼‰

#### 1. è¿æ‹æ€§èƒ½æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. æ‰“å¼€ç›¸æœº
2. è¿ç»­ç‚¹å‡»å¿«é—¨10æ¬¡
3. è§‚å¯ŸUIæµç•…åº¦

éªŒæ”¶æ ‡å‡†ï¼š
âœ… æ¯æ¬¡å¿«é—¨å“åº” < 100ms
âœ… UIä¸æ‰å¸§ã€ä¸å¡é¡¿
âœ… ç¼©ç•¥å›¾å³æ—¶æ˜¾ç¤º
```

---

#### 2. ç¦»çº¿æ‹ç…§æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. å…³é—­ç½‘ç»œï¼ˆé£è¡Œæ¨¡å¼ï¼‰
2. æ‹æ‘„20å¼ ç…§ç‰‡
3. å…³é—­App
4. é‡æ–°æ‰“å¼€App

éªŒæ”¶æ ‡å‡†ï¼š
âœ… èƒ½çœ‹åˆ°20å¼ ç¼©ç•¥å›¾
âœ… çŠ¶æ€æ˜¾ç¤ºä¸ºğŸ•’ pending
âœ… å¯ä»¥å…¨å±æŸ¥çœ‹
```

---

#### 3. è‡ªåŠ¨ä¸Šä¼ æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. ç¦»çº¿æ‹æ‘„10å¼ 
2. æ¢å¤ç½‘ç»œ
3. ç­‰å¾…10åˆ†é’Ÿ

éªŒæ”¶æ ‡å‡†ï¼š
âœ… 10å¼ å…¨éƒ¨å˜ä¸ºâœ… uploaded
âœ… æœåŠ¡å™¨æœ‰å¯¹åº”æ–‡ä»¶
âœ… æœ¬åœ°çŠ¶æ€æ­£ç¡®æ›´æ–°
```

---

#### 4. ä¸Šä¼ å¤±è´¥é‡è¯•æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. æ¨¡æ‹ŸæœåŠ¡å™¨é”™è¯¯ï¼ˆ500ï¼‰
2. æ‹æ‘„1å¼ ç…§ç‰‡
3. è§‚å¯Ÿé‡è¯•è¡Œä¸º

éªŒæ”¶æ ‡å‡†ï¼š
âœ… æ˜¾ç¤ºâš ï¸ failedçŠ¶æ€
âœ… è‡ªåŠ¨é‡è¯•3æ¬¡
âœ… å¯ä»¥æ‰‹åŠ¨ç‚¹å‡»é‡è¯•
âœ… è®°å½•é”™è¯¯ä¿¡æ¯
```

---

#### 5. å´©æºƒæ¢å¤æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. æ‹æ‘„5å¼ ç…§ç‰‡
2. ä¸Šä¼ è¿‡ç¨‹ä¸­å¼ºåˆ¶å…³é—­æµè§ˆå™¨
3. é‡æ–°æ‰“å¼€App

éªŒæ”¶æ ‡å‡†ï¼š
âœ… 5å¼ ç…§ç‰‡ä»åœ¨
âœ… status='uploading'çš„é‡ç½®ä¸ºpending
âœ… è‡ªåŠ¨ç»§ç»­ä¸Šä¼ 
```

---

#### 6. æ°´å°ç”Ÿæˆæµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. æ‹æ‘„ç…§ç‰‡
2. ç­‰å¾…ä¸Šä¼ å®Œæˆ
3. ä¸‹è½½æŸ¥çœ‹

éªŒæ”¶æ ‡å‡†ï¼š
âœ… å³ä¸‹è§’æœ‰æ°´å°
âœ… åŒ…å«Jobåç§°ã€æ—¶é—´ã€åœ°ç‚¹
âœ… å­—ä½“æ¸…æ™°å¯è¯»
âœ… ä¸é®æŒ¡å…³é”®ç”»é¢
```

---

#### 7. Jobå½’å±æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. é€‰æ‹©Job A
2. æ‹æ‘„3å¼ ç…§ç‰‡
3. åˆ‡æ¢åˆ°Job B
4. æ‹æ‘„2å¼ ç…§ç‰‡
5. æŸ¥çœ‹æ—¶é—´çº¿

éªŒæ”¶æ ‡å‡†ï¼š
âœ… Job Aæœ‰3å¼ ç…§ç‰‡
âœ… Job Bæœ‰2å¼ ç…§ç‰‡
âœ… æ²¡æœ‰ç…§ç‰‡è·‘é”™å·¥åœ°
```

---

#### 8. GPSæç¤ºæµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. é€‰æ‹©Job A
2. ç‰©ç†ç§»åŠ¨åˆ°Job Bä½ç½®ï¼ˆæˆ–æ¨¡æ‹ŸGPSï¼‰
3. è§‚å¯ŸUI

éªŒæ”¶æ ‡å‡†ï¼š
âœ… æ˜¾ç¤ºåˆ‡æ¢æç¤º
âœ… ä¸è‡ªåŠ¨åˆ‡æ¢
âœ… ç‚¹å‡»"Switch"å¯åˆ‡æ¢
âœ… æ‹ç…§ä»å½’å±åˆ°å½“å‰é€‰ä¸­çš„Job
```

---

#### 9. å•æ‰‹æ“ä½œæµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. åªç”¨å³æ‰‹æ‹‡æŒ‡æ“ä½œ
2. å®Œæˆï¼šæ‰“å¼€ç›¸æœºâ†’æ‹ç…§â†’åˆ‡æ¢Jobâ†’å†æ‹ç…§

éªŒæ”¶æ ‡å‡†ï¼š
âœ… æ‰€æœ‰å…³é”®æŒ‰é’®åœ¨æ‹‡æŒ‡å¯è¾¾èŒƒå›´
âœ… ä¸éœ€è¦åŒæ‰‹æ‰èƒ½æ“ä½œ
âœ… å¿«é—¨æŒ‰é’®å¤Ÿå¤§ï¼ˆâ‰¥64pxï¼‰
```

---

#### 10. å¼±ç½‘æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. æ¨¡æ‹Ÿ3G/2Gç½‘ç»œ
2. æ‹æ‘„10å¼ ç…§ç‰‡
3. è§‚å¯Ÿä¸Šä¼ è¡Œä¸º

éªŒæ”¶æ ‡å‡†ï¼š
âœ… ä¸Šä¼ ä¸é˜»å¡æ‹ç…§
âœ… è‡ªåŠ¨é™ä½å¹¶å‘ï¼ˆ1ä¸ªï¼‰
âœ… è¶…æ—¶æ­£ç¡®å¤„ç†
âœ… ä¸è€—å°½ç”µé‡
```

---

#### 11. å­˜å‚¨ç©ºé—´æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. è¿ç»­æ‹æ‘„100å¼ ç…§ç‰‡
2. æ£€æŸ¥IndexedDBå¤§å°
3. ä¸Šä¼ å®Œæˆåå†æ‹50å¼ 

éªŒæ”¶æ ‡å‡†ï¼š
âœ… æœ¬åœ°å­˜å‚¨ä¸è¶…è¿‡500MB
âœ… ä¸Šä¼ æˆåŠŸçš„ä¸ç«‹å³åˆ é™¤ï¼ˆPhase 1ä¿ç•™ï¼‰
âœ… æŸ¥è¯¢æ€§èƒ½ä¸ä¸‹é™
```

---

#### 12. ç¼©ç•¥å›¾çŠ¶æ€æµ‹è¯•

```
æµ‹è¯•æ­¥éª¤ï¼š
1. æ‹æ‘„ç…§ç‰‡
2. è§‚å¯ŸçŠ¶æ€å˜åŒ–ï¼špending â†’ uploading â†’ uploaded
3. æ¨¡æ‹Ÿå¤±è´¥æƒ…å†µ

éªŒæ”¶æ ‡å‡†ï¼š
âœ… çŠ¶æ€è§’æ ‡æ­£ç¡®æ˜¾ç¤º
âœ… ä¸Šä¼ ä¸­æœ‰è¿›åº¦åé¦ˆ
âœ… å¤±è´¥å¯ç‚¹å‡»é‡è¯•
âœ… æˆåŠŸåè§’æ ‡æ¶ˆå¤±æˆ–å˜ç»¿
```

---

## ğŸš§ å·²çŸ¥é™åˆ¶ä¸Phase 2æ”¹è¿›æ–¹å‘

### Phase 1çš„é™åˆ¶ï¼ˆæ˜ç¡®å‘ŠçŸ¥ï¼‰

| é™åˆ¶ | å½±å“ | Phase 2æ–¹æ¡ˆ |
|------|------|------------|
| æ— çœŸåå°ä¸Šä¼  | iOSé”å±ååœæ­¢ä¸Šä¼  | åŸç”ŸApp |
| å•çº¿ç¨‹æ°´å°ç”Ÿæˆ | å¤§é‡ç…§ç‰‡æ—¶è¾ƒæ…¢ | å¤šWorkerå¹¶è¡Œ |
| æ— è‡ªåŠ¨æ¸…ç† | æœ¬åœ°å­˜å‚¨æŒç»­å¢é•¿ | ä¸Šä¼ å7å¤©è‡ªåŠ¨åˆ é™¤ |
| GPSä»…æç¤º | éœ€è¦æ‰‹åŠ¨åˆ‡Job | æ™ºèƒ½å›´æ  + å†å²å­¦ä¹  |

---

### Phase 2åŠŸèƒ½å±•æœ›ï¼ˆä¸æ‰¿è¯ºæ—¶é—´ï¼‰

**2.1 æ™ºèƒ½å›´æ ï¼ˆSmart Geofencingï¼‰**
- å†å²å­¦ä¹ ï¼šè®°ä½"æ¯å¤©æ—©ä¸Š9ç‚¹åœ¨Job A"
- å¤šJobå†²çªå¤„ç†
- æ—¶é—´+ä½ç½®åŒå› å­åˆ¤æ–­

**2.2 é«˜çº§æ°´å°**
- å¤©æ°”æ•°æ®ï¼ˆOpenWeather APIï¼‰
- å¯é…ç½®å­—æ®µ
- å¤šè¯­è¨€æ”¯æŒ

**2.3 è¯­éŸ³å¤‡æ³¨å¢å¼º**
- Whisperè½¬å†™ï¼ˆæ›´å‡†ç¡®ï¼‰
- å®æ—¶å­—å¹•
- å…³é”®è¯è‡ªåŠ¨æå–

**2.4 åŸç”ŸAppä¼˜åŒ–**
- çœŸåå°ä¸Šä¼ 
- æ›´é«˜å¸§ç‡è¿æ‹
- æ·±åº¦ç³»ç»Ÿç›¸æœºæ§åˆ¶
- ç”µé‡ä¼˜åŒ–

---

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•ï¼ˆCTOéœ€è¦å®Œæˆï¼‰

### Week 1-2ï¼šæ ¸å¿ƒæ¶æ„

- [ ] **Local Storeå®ç°**
  - IndexedDB schemaåˆ›å»º
  - CRUDæ“ä½œå°è£…
  - å´©æºƒæ¢å¤é€»è¾‘

- [ ] **Upload Queueå®ç°**
  - çŠ¶æ€æœº
  - é‡è¯•ç­–ç•¥
  - å¹¶å‘æ§åˆ¶

- [ ] **Sync Orchestrator**
  - äº‹ä»¶ç›‘å¬
  - è§¦å‘è°ƒåº¦
  - èŠ‚æµæœºåˆ¶

---

### Week 2-3ï¼šç›¸æœºUI

- [ ] **Cameraç»„ä»¶**
  - å¿«é—¨æ§åˆ¶
  - ç¼©ç•¥æ¡æ˜¾ç¤º
  - çŠ¶æ€åé¦ˆ

- [ ] **Jobé€‰æ‹©å™¨**
  - ä¸‹æ‹‰åˆ—è¡¨
  - GPSæç¤º
  - å¿«é€Ÿåˆ‡æ¢

---

### Week 3ï¼šæ°´å°ç³»ç»Ÿ

- [ ] **Watermark Worker**
  - Canvasç»˜åˆ¶
  - æ–‡æœ¬æ¸²æŸ“
  - Blobè½¬æ¢

- [ ] **æ°´å°é›†æˆ**
  - ä¸Šä¼ å‰ç”Ÿæˆ
  - ç‰ˆæœ¬è®°å½•
  - æ€§èƒ½ä¼˜åŒ–

---

### Week 4ï¼šæµ‹è¯•ä¸ä¼˜åŒ–

- [ ] **12é¡¹éªŒæ”¶æµ‹è¯•**
- [ ] **æ€§èƒ½è°ƒä¼˜**
- [ ] **è¾¹ç•Œæƒ…å†µå¤„ç†**
- [ ] **æ–‡æ¡£å®Œå–„**

---

## ğŸ“ ç»™CTOçš„æŠ€æœ¯å†³ç­–æ¸…å•

**è¯·åœ¨å¼€å‘å‰ç¡®è®¤ä»¥ä¸‹å†³ç­–ï¼š**

### å†³ç­–1ï¼šIndexedDB vs OPFS

**é—®é¢˜ï¼š** IndexedDBå­˜blobåœ¨æŸäº›å®‰å“æœºå‹å¯èƒ½ä¸ç¨³å®š

**é€‰é¡¹ï¼š**
- A) Phase 1å…ˆç”¨IndexedDBï¼Œæœ‰é—®é¢˜å†ä¸ŠOPFS âœ…
- B) ç›´æ¥ä¸ŠOPFSï¼ˆå¢åŠ å¤æ‚åº¦ï¼‰

**å»ºè®®ï¼š** A

---

### å†³ç­–2ï¼šæ°´å°ç”Ÿæˆç­–ç•¥

**é—®é¢˜ï¼š** Web Worker vs OffscreenCanvas

**é€‰é¡¹ï¼š**
- A) Web Worker + OffscreenCanvasï¼ˆæ€§èƒ½æœ€ä¼˜ï¼Œå…¼å®¹æ€§ç¨å¼±ï¼‰
- B) Web Worker + æ™®é€šCanvasï¼ˆå…¼å®¹æ€§æœ€ä¼˜ï¼‰
- C) ä¸»çº¿ç¨‹ç”Ÿæˆï¼ˆç®€å•ä½†å¯èƒ½é˜»å¡ï¼‰

**å»ºè®®ï¼š** Aï¼ˆiOS/Androidç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒï¼‰

---

### å†³ç­–3ï¼šService Workerä½¿ç”¨èŒƒå›´

**é—®é¢˜ï¼š** æ˜¯å¦ä¾èµ–Background Sync

**é€‰é¡¹ï¼š**
- A) ä¸ä¾èµ–ï¼Œåªç”¨SWåšç¼“å­˜ âœ…
- B) å°è¯•ä½¿ç”¨ï¼Œé™çº§å¤„ç†

**å»ºè®®ï¼š** Aï¼ˆiOSä¸æ”¯æŒï¼Œä¸ä½œä¸ºæˆåŠŸæ¡ä»¶ï¼‰

---

### å†³ç­–4ï¼šç…§ç‰‡å‹ç¼©ç­–ç•¥

**é—®é¢˜ï¼š** ä¸Šä¼ å‰æ˜¯å¦å‹ç¼©

**é€‰é¡¹ï¼š**
- A) Phase 1ä¸å‹ç¼©ï¼Œä¿ç•™åŸå›¾è´¨é‡ âœ…
- B) æ™ºèƒ½å‹ç¼©ï¼ˆâ‰¥2MBå‹åˆ°1MBï¼Œè´¨é‡0.9ï¼‰

**å»ºè®®ï¼š** Aï¼ˆPhase 1ä¼˜å…ˆç¨³å®šï¼Œå‹ç¼©å¯Phase 2ï¼‰

---

### å†³ç­–5ï¼šæœ¬åœ°å­˜å‚¨ä¸Šé™

**é—®é¢˜ï¼š** å¦‚ä½•å¤„ç†å­˜å‚¨æ»¡

**é€‰é¡¹ï¼š**
- A) Phase 1åªç›‘æ§ï¼Œä¸è‡ªåŠ¨åˆ é™¤ âœ…
- B) è‡ªåŠ¨åˆ é™¤å·²ä¸Šä¼ ä¸”>7å¤©çš„ç…§ç‰‡

**å»ºè®®ï¼š** Aï¼ˆé¿å…è¯¯åˆ é£é™©ï¼‰

---

## ğŸ“ æŠ€æœ¯æ”¯æŒä¸æ²Ÿé€š

### CTOé‡åˆ°é—®é¢˜æ—¶çš„è”ç³»æ¸ é“

**æŠ€æœ¯é—®é¢˜ï¼š**
- IndexedDBå…¼å®¹æ€§ â†’ æŸ¥MDN + Can I Use
- PWAé™åˆ¶ â†’ æŸ¥web.dev PWAæ–‡æ¡£
- æ€§èƒ½ä¼˜åŒ– â†’ ä½¿ç”¨Chrome DevTools Profiler

**äº§å“è¾¹ç•Œé—®é¢˜ï¼š**
- åŠŸèƒ½èŒƒå›´ä¸æ¸…æ¥š â†’ è”ç³»CPOç¡®è®¤
- ç”¨æˆ·ä½“éªŒå–èˆ â†’ è”ç³»CPOå†³ç­–

**APIæ¥å£é—®é¢˜ï¼š**
- ä¸Šä¼ æ¥å£è§„èŒƒ â†’ ä¸åç«¯å¯¹æ¥
- é”™è¯¯ç å®šä¹‰ â†’ å»ºç«‹ç»Ÿä¸€æ ‡å‡†

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡ï¼ˆPhase 1ä¸Šçº¿åï¼‰

### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|-------|
| å¿«é—¨å“åº”æ—¶é—´ | < 100ms (p95) |
| è¿æ‹é—´éš” | < 200ms (p95) |
| ç…§ç‰‡ä¸¢å¤±ç‡ | < 0.1% |
| ä¸Šä¼ æˆåŠŸç‡ | > 99% |
| å´©æºƒç‡ | < 0.5% |

### ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡

| æŒ‡æ ‡ | å¥åº·å€¼ |
|------|-------|
| æ¯Jobå¹³å‡ç…§ç‰‡æ•° | 10-30å¼  |
| ç…§ç‰‡å›çœ‹ç‡ | > 30% |
| è¿ç»­æ‹æ‘„ç‡ | > 60% |

---

## ğŸ’¬ CPOæœ€åçš„è¯

### ç»™CTOçš„ä¸‰å¥è¯

1. **ä¼˜å…ˆçº§æ°¸è¿œæ˜¯ï¼šä¸ä¸¢ > ä¸æ…¢ > å¥½çœ‹**

2. **PWAä¸æ˜¯å¦¥åï¼Œæ˜¯Phase 1çš„æ­£ç¡®é€‰æ‹©**  
   åŸç”ŸAppæ˜¯Phase 2çš„æ€§èƒ½å‡çº§ï¼Œä¸æ˜¯ç°åœ¨çš„é˜»å¡æ¡ä»¶

3. **è¿™ä¸ªæ¨¡å—æ˜¯Jobsite Snapçš„"ä¿¡ä»»åŸºçŸ³"**  
   åšå¥½å®ƒï¼Œæ•´ä¸ªäº§å“çš„æŠ¤åŸæ²³å°±æœ‰äº†

---

### å…³é”®æŠ€æœ¯å“²å­¦

**æˆ‘ä»¬ä¸æ˜¯åœ¨åšï¼š**
- âŒ ä¸–ç•Œæœ€å¿«çš„ç›¸æœº
- âŒ æœ€ç‚«çš„AIç…§ç‰‡ç®¡ç†
- âŒ Nativeçº§çš„æ€§èƒ½ç«èµ›

**æˆ‘ä»¬åœ¨åšï¼š**
- âœ… ä¸–ç•Œæœ€ä¸å®¹æ˜“ä¸¢è¯æ®çš„å·¥åœ°ç›¸æœº
- âœ… å¸ˆå‚…åœ¨æ¢¯å­ä¸Šæœ€ä¿¡ä»»çš„å·¥å…·
- âœ… æ¯”Procore/CompanyCamæ›´å¯é çš„å­˜è¯ç³»ç»Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºäººï¼š** CPO  
**å®¡æ ¸äººï¼š** COO  
**æ‰§è¡Œäººï¼š** CTO  
**ç”Ÿæ•ˆæ—¥æœŸï¼š** 2026-02-07  
**é¢„è®¡å®Œæˆï¼š** 4å‘¨

---

ä¸ä¸¢ã€ä¸ä¹±ã€å¯ä¿¡ â€”â€” è¿™å°±æ˜¯æˆ‘ä»¬çš„æŠ¤åŸæ²³ï¼ğŸš€
