# PlanSnap SketchUpé£æ ¼ç”»çº¿ä½“éªŒè®¾è®¡è§„èŒƒ v1.0

> **ä¼šè®®æ—¶é—´ï¼š** 2026-02-04 07:30  
> **æ–‡æ¡£ç±»å‹ï¼š** CPOå®šå‹æ–‡æ¡£ï¼ˆç”»çº¿ä½“éªŒå®ªæ³•ï¼‰  
> **ä¼˜å…ˆçº§ï¼š** ğŸ”´ P0 - æ ¸å¿ƒæ‰‹æ„ŸåŸºç¡€  
> **çŠ¶æ€ï¼š** å·²å®šå‹ï¼Œå¾…æ‰§è¡Œ

---

## ğŸ“‹ èƒŒæ™¯ï¼ˆWhyï¼‰

### CEOéœ€æ±‚

æƒ³å¤åˆ»SketchUpçš„2Dç»˜å›¾æ–¹å¼ï¼š
1. **é¢œè‰²è¯­ä¹‰ï¼š** ç»¿è‰²=å‚ç›´ï¼Œçº¢è‰²=æ°´å¹³ï¼Œè“è‰²=æ·±åº¦
2. **å®å¿ƒçº¢æ–¹å—ï¼š** æ¥è§¦å¦ä¸€æ ¹çº¿æ—¶çš„æ˜ç¡®æç¤º
3. **å¼ºç£åŠ›ï¼š** ä¸åº”è¯¥è®©é¼ æ ‡åœ¨ç»¿è‰²å¼•å¯¼çº¿é™„è¿‘ç§»åŠ¨
4. **ä¸“ä¸šæ‰‹æ„Ÿï¼š** "é¼ æ ‡è¢«æ‹½ä½"ï¼Œè€Œä¸æ˜¯"æœ‰ç‚¹å¸ï¼Œä½†è¿˜èƒ½é£˜"

### æ ¸å¿ƒé—®é¢˜

å½“å‰Snapæ˜¯"å¼±å¸é™„ + å…è®¸é€ƒé€¸"ï¼š
- é¼ æ ‡çœ‹èµ·æ¥åœ¨å¼•å¯¼çº¿ä¸Šï¼Œå®é™…åæ ‡å·²ç»åç¦»
- æœ€ç»ˆå¯¼è‡´çº¿æ®µä¸å…±ç‚¹ï¼Œé—­åˆå¤±è´¥
- Contractorå®Œå…¨ä¸çŸ¥é“å“ªé‡Œç”»é”™äº†

---

## ğŸ¯ è®¾è®¡å“²å­¦

### SketchUp 2Dç”»çº¿çš„æœ¬è´¨

**ç”»çº¿ä¸æ˜¯"è·Ÿç€é¼ æ ‡"ï¼Œè€Œæ˜¯è¢«ç³»ç»Ÿè§£é‡Šã€‚**

åœ¨SketchUpé‡Œï¼š
- é¼ æ ‡åªæ˜¯"æ„å›¾è¾“å…¥"
- çœŸæ­£å†³å®šç‚¹åœ¨å“ªçš„æ˜¯ï¼šæ–¹å‘æ¨æ–­ã€å‚è€ƒå‡ ä½•ã€å½“å‰è¯­å¢ƒ
- ğŸ‘‰ **cursor â‰  å‡ ä½•ç‚¹**

### é¢œè‰²ä¸æ˜¯è£…é¥°ï¼Œæ˜¯"å‡ ä½•è¯­ä¹‰"

- ğŸŸ¥ **çº¢è‰²ï¼š** è½´å‘ / æ°´å¹³
- ğŸŸ© **ç»¿è‰²ï¼š** å‚ç›´
- ğŸŸ¦ **è“è‰²ï¼š** æ·±åº¦ / å¦ä¸€ä¸ªæ­£äº¤æ–¹å‘
- ğŸ”´ **å®å¿ƒçº¢è‰²æ–¹å—ï¼š** On Edge / On Endpointï¼ˆäº‹å®æ¥è§¦ï¼‰

è¿™äº›ä¸æ˜¯UIï¼Œè€Œæ˜¯è¯­è¨€ã€‚SketchUpåœ¨ä¸åœå¯¹ç”¨æˆ·è¯´ï¼š"æˆ‘çŸ¥é“ä½ ç°åœ¨æ˜¯åœ¨å¹²å˜›ã€‚"

### ä¸€æ—¦ç³»ç»Ÿ"ç¡®ä¿¡"ï¼Œä½ å°±ä¸èƒ½å†éšä¾¿é£˜äº†

ä¸€æ—¦è¿›å…¥ï¼š
- On Edge
- On Endpoint
- On Axis

ä½ æ˜¯è¢«é”ä½çš„ã€‚æƒ³è„±ç¦»ï¼Ÿä½ å¾—"æ˜æ˜¾åœ°"ç¦»å¼€ã€‚

---

## ğŸ’¬ CPOæ ¸å¿ƒè£å†³

> **PlanSnapçš„ç”»çº¿ä¸æ˜¯"ä½ ç”»å“ªï¼Œæˆ‘å°±ç”»å“ª"ï¼Œè€Œæ˜¯"æˆ‘çŸ¥é“ä½ æƒ³ç”»ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘æ›¿ä½ ç”»å‡†"ã€‚**
> 
> **ç”»çº¿ä¸æ˜¯è¿ç»­è‡ªç”±ï¼Œè€Œæ˜¯"çŠ¶æ€é©±åŠ¨"ã€‚**
> 
> **ç”»çº¿ä¸æ˜¯è¿ç»­è¾“å…¥ï¼Œè€Œæ˜¯ç¦»æ•£çŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ã€‚æ¯ä¸€ä¸ªçŠ¶æ€ï¼Œéƒ½å¿…é¡»æœ‰"é”ä½çš„å‹‡æ°”"ã€‚**

---

# Part 1ï¼šç”»çº¿çŠ¶æ€æœºè®¾è®¡

## æ ¸å¿ƒçŠ¶æ€å®šä¹‰

### çŠ¶æ€æšä¸¾

```typescript
enum DrawingState {
  FREE = 'FREE',                    // ç©ºé—²
  DRAWING_ACTIVE = 'DRAWING_ACTIVE', // å·²ç¡®å®šèµ·ç‚¹
  AXIS_LOCK = 'AXIS_LOCK',          // è½´å‘æ¨æ–­é”å®š
  ON_GUIDE = 'ON_GUIDE',            // å¼•å¯¼çº¿é”å®š
  ON_EDGE = 'ON_EDGE',              // åœ¨çº¿ä¸Š
  ON_ENDPOINT = 'ON_ENDPOINT',      // åœ¨ç«¯ç‚¹
  COMMIT_POINT = 'COMMIT_POINT'     // ç¡®è®¤ç»ˆç‚¹
}
```

---

## å®Œæ•´çŠ¶æ€æœºå›¾

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    FREE      â”‚
                â”‚ (No intent)  â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ start drawing
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  DRAWING_ACTIVE   â”‚
              â”‚ (Start point set) â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AXIS_LOCK  â”‚ â”‚  ON_GUIDE    â”‚ â”‚  ON_EDGE   â”‚
â”‚ (X/Y/Blue) â”‚ â”‚ (Inference)  â”‚ â”‚ /ENDPOINT  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚              â”‚                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   COMMIT_POINT     â”‚
         â”‚ (click / release) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
                FREE
```

**æ ¸å¿ƒåŸåˆ™ï¼š**
- ä»»æ„æ—¶åˆ»**åªæœ‰ä¸€ä¸ªActive State**
- Stateå†³å®šï¼šcursoråæ ‡ã€é¢œè‰²ã€æ˜¯å¦é”æ–¹å‘ã€æ˜¯å¦å…è®¸è„±ç¦»

---

## çŠ¶æ€è¯¦ç»†å®šä¹‰

### 1ï¸âƒ£ FREEï¼ˆç©ºé—²ï¼‰

**å«ä¹‰ï¼š**
- æœªå¼€å§‹ç”»çº¿
- cursoråªæ˜¯hover

**å…è®¸è¿›å…¥ï¼š**
- Appå¯åŠ¨
- ä¸€æ¡çº¿å®Œæˆå

**å¯è½¬ç§»ï¼š**
- mousedown / click â†’ DRAWING_ACTIVE

**UIï¼š**
- æ™®é€šcursor
- æ— é¢œè‰²è¯­ä¹‰

---

### 2ï¸âƒ£ DRAWING_ACTIVEï¼ˆå·²ç¡®å®šèµ·ç‚¹ï¼‰

**ä»è¿™ä¸€åˆ»å¼€å§‹ï¼Œcursorä¸å†è‡ªç”±ã€‚**

**è¿›å…¥æ¡ä»¶ï¼š**
- ç”¨æˆ·ç‚¹å‡»ç¡®å®šèµ·ç‚¹

**èµ·ç‚¹å¯èƒ½æ˜¯ï¼š**
- Endpoint
- On Edge
- Grid point
- Free spaceï¼ˆå…è®¸ï¼‰

**å†…éƒ¨çŠ¶æ€ï¼š**
- startPointå›ºå®š
- å¼€å§‹è®¡ç®—Î”x / Î”y

**å¯è½¬ç§»ï¼š**
- æ»¡è¶³Axisæ¨æ–­ â†’ AXIS_LOCK
- å‘½ä¸­Guide â†’ ON_GUIDE
- å‘½ä¸­Edge / Endpoint â†’ ON_EDGE

---

### 3ï¸âƒ£ AXIS_LOCKï¼ˆè½´å‘æ¨æ–­ï¼‰ã€SketchUpçµé­‚ã€‘

**è¿›å…¥æ¡ä»¶ï¼š**

```typescript
if (|Î”x| > |Î”y| * axisBias) {
  // HORIZONTAL (RED)
} else if (|Î”y| > |Î”x| * axisBias) {
  // VERTICAL (GREEN)
}
```

**axisBiaså»ºè®®ï¼š** 1.2ï½1.5

**è¡Œä¸ºï¼ˆå®šå‹ï¼‰ï¼š**
- âœ… cursoråæ ‡ï¼šé”å®šåœ¨å¯¹åº”è½´
- âœ… åªå…è®¸æ²¿è½´å‘ç§»åŠ¨
- âœ… æ˜¾ç¤ºé¢œè‰²ï¼š
  - çº¢ = æ°´å¹³
  - ç»¿ = å‚ç›´
  - è“ = ç¬¬ä¸‰æ­£äº¤æ–¹å‘ï¼ˆé¢„ç•™ï¼‰

**å…è®¸è½¬ç§»ï¼š**
- å‘½ä¸­Guide â†’ ON_GUIDE
- å‘½ä¸­Edge / Endpoint â†’ ON_EDGE
- æ˜æ˜¾åå‘ç§»åŠ¨ â†’ å›DRAWING_ACTIVE

**âŒ ä¸å…è®¸ï¼š**
- å¾®å°æ™ƒåŠ¨è„±ç¦»axis

---

### 4ï¸âƒ£ ON_GUIDEï¼ˆå¼•å¯¼çº¿é”å®šï¼‰

**è¿›å…¥æ¡ä»¶ï¼š**
```
distance(cursor, guideLine) â‰¤ guideThreshold
```

**è¡Œä¸ºï¼ˆå¼ºåˆ¶ï¼‰ï¼š**
- âœ… cursoråœ¨æ³•å‘æ–¹å‘**é”æ­»**
- âœ… åªèƒ½æ²¿guideæ–¹å‘æ»‘åŠ¨
- âœ… æ˜¾ç¤ºguideå¯¹åº”é¢œè‰²ï¼ˆç»¿ / çº¢ï¼‰

**ä¼˜å…ˆçº§ï¼š**
```
ON_EDGE > ON_GUIDE > AXIS_LOCK
```

**å…è®¸è½¬ç§»ï¼š**
- å‘½ä¸­Edge / Endpoint â†’ ON_EDGE
- æ˜æ˜¾ç¦»å¼€guideåŒºåŸŸ â†’ å›DRAWING_ACTIVE

---

### 5ï¸âƒ£ ON_EDGE / ON_ENDPOINTï¼ˆäº‹å®æ¥è§¦æ€ï¼‰

**è¿™æ˜¯å®å¿ƒçº¢è‰²æ–¹å—çš„çŠ¶æ€ã€‚**

**è¿›å…¥æ¡ä»¶ï¼š**
```typescript
distance(cursor, existingLine) â‰¤ edgeThreshold
distance(cursor, endpoint) â‰¤ endpointThreshold
```

**è¡Œä¸ºï¼ˆä¸å¯å¦¥åï¼‰ï¼š**
- âœ… cursoråæ ‡ = æŠ•å½±ç‚¹ / endpoint
- âœ… å®Œå…¨é”æ­»
- âœ… æ˜¾ç¤ºï¼šğŸ”´ **å®å¿ƒçº¢è‰²æ–¹å—**
- âŒ ç¦æ­¢jitter

**ä¼˜å…ˆçº§ï¼š**
- æœ€é«˜ï¼ˆé™¤äº†Closureï¼‰

**å…è®¸è½¬ç§»ï¼š**
- cursoræ˜æ˜¾ç¦»å¼€ï¼ˆâ‰¥ 2Ã—thresholdï¼‰
- æˆ–commit

---

### 6ï¸âƒ£ COMMIT_POINTï¼ˆç¡®è®¤ç»ˆç‚¹ï¼‰

**è§¦å‘ï¼š**
- mouseup / click

**è¡Œä¸ºï¼š**
- å½“å‰snap stateå†³å®šæœ€ç»ˆç‚¹
- åˆ›å»ºline segment
- æ£€æŸ¥ï¼š
  - æ˜¯å¦é—­åˆï¼ˆClosure Biasï¼‰
  - æ˜¯å¦å…±çº¿ / å…±ç‚¹

**è½¬ç§»ï¼š**
- å›åˆ°FREE

---

## çŠ¶æ€ä¼˜å…ˆçº§æ€»è¡¨ï¼ˆå†™è¿›ä»£ç ï¼‰

```
P0  ON_ENDPOINT
P1  ON_EDGE
P2  ON_GUIDE
P3  AXIS_LOCK
P4  DRAWING_ACTIVE
P5  FREE
```

ğŸ‘‰ **æ¯ä¸€å¸§ä»ä¸Šåˆ°ä¸‹åˆ¤æ–­ï¼Œå‘½ä¸­å³é”**

---

# Part 2ï¼šå†²çªä¼˜å…ˆçº§è§„èŒƒ

## å¯¹è±¡åˆ†ç±»

### Aç±»ï¼šäº‹å®ï¼ˆFact Anchorsï¼‰â€” ä¸å¯è®¨è®º

- **Endpoint** - ç«¯ç‚¹
- **On Edge** - æŠ•å½±ç‚¹
- **Closure Target** - é—­åˆç‚¹
- **Grid Point** - äº¤ç‚¹

ğŸ‘‰ è¿™äº›æ˜¯"ä½ å·²ç»ç¢°åˆ°ä¸œè¥¿äº†"ï¼Œå¿…é¡»å¼ºåˆ¶ã€‚

---

### Bç±»ï¼šæ„å›¾ï¼ˆIntent Inferenceï¼‰â€” å¯è¢«äº‹å®æ‰“æ–­

- **Axis inference** - çº¢/ç»¿/è“
- **Guide line inference** - ç»¿è‰²/çº¢è‰²å¼•å¯¼çº¿
- **Grid line** - ç½‘æ ¼çº¿

ğŸ‘‰ è¿™äº›æ˜¯"ç³»ç»ŸçŒœä½ æƒ³å¯¹é½"ï¼Œä½†ä¸å¦‚äº‹å®ç¡¬ã€‚

---

## æ€»è£å†³ï¼šç»ˆæä¼˜å…ˆçº§ï¼ˆå†™æ­»ï¼‰

ä»å¼ºåˆ°å¼±ï¼ˆåŒä¸€å¸§åªå–ä¸€ä¸ªï¼‰ï¼š

```
P0  Closure Targetï¼ˆé—­åˆç‚¹ï¼‰   â† æ„å›¾æå¼ºï¼Œå¿…é¡»å¸®ç”¨æˆ·é—­åˆ
P1  Endpointï¼ˆç«¯ç‚¹ï¼‰
P2  On Edgeï¼ˆåœ¨çº¿ä¸Šï¼‰
P3  Grid Pointï¼ˆäº¤ç‚¹ï¼‰
P4  Guide Lineï¼ˆå¼•å¯¼çº¿ï¼‰
P5  Axis Inferenceï¼ˆçº¢/ç»¿/è“ï¼‰
P6  Grid Lineï¼ˆç½‘æ ¼çº¿ï¼‰
P7  Freeï¼ˆè‡ªç”±ï¼‰
```

**å…³é”®ç‚¹ï¼š**
- âœ… Guideè¦æ›´å¼ºã€æ›´ç¡¬ï¼ˆP4ç›–è¿‡Axisï¼‰
- âœ… Gridäº¤ç‚¹è¦å¾ˆå¼ºï¼ˆP3ï¼Œé«˜äºGuide / Axisï¼‰

---

## å†²çªåœºæ™¯è£å†³è¡¨ï¼ˆå·¥ç¨‹ç›´æ¥ç…§æŠ„ï¼‰

### åœºæ™¯1ï¼šAxisï¼ˆçº¢/ç»¿ï¼‰ + Guide åŒæ—¶å‘½ä¸­

**âœ… Guideèµ¢ï¼ˆP4 > P5ï¼‰**

**è¡Œä¸ºï¼š**
- é”åˆ°Guide
- é¢œè‰²ï¼šç”¨Guideçš„é¢œè‰²
- è„±ç¦»ï¼šå¿…é¡»ç¦»å¼€ â‰¥ 2Ã— guideThreshold

**ç†ç”±ï¼š** Guideæ˜¯"å‡ ä½•å‚è€ƒ"ï¼Œæ¯”çº¯æ–¹å‘æ¨æ–­æ›´ç¡®å®šã€‚

---

### åœºæ™¯2ï¼šGuide + Edge åŒæ—¶å‘½ä¸­

**âœ… Edgeèµ¢ï¼ˆP2 > P4ï¼‰**

**è¡Œä¸ºï¼š**
- æŠ•å½±åˆ°Edgeï¼ˆOn Edgeï¼‰
- æŒ‡ç¤ºï¼šå®å¿ƒçº¢æ–¹å—
- å…è®¸ï¼šæ²¿Edgeæ»‘åŠ¨ï¼ˆå¦‚æœä½ æƒ³æ”¯æŒï¼‰

**ç†ç”±ï¼š** ä½ å·²ç»"ç¢°åˆ°äº‹å®çº¿"ï¼Œä¸è¯¥å†è¢«æ¨æ–­çº¿ç»‘æ¶ã€‚

---

### åœºæ™¯3ï¼šAxis + Edge åŒæ—¶å‘½ä¸­

**âœ… Edgeèµ¢ï¼ˆP2 > P5ï¼‰**

**ç†ç”±åŒä¸Šï¼š** äº‹å® > æ„å›¾ã€‚

---

### åœºæ™¯4ï¼šGrid Point + Guide åŒæ—¶å‘½ä¸­

**âœ… Grid Pointèµ¢ï¼ˆP3 > P4ï¼‰**

**è¡Œä¸ºï¼š**
- è·³åˆ°äº¤ç‚¹ï¼Œå®Œå…¨é”æ­»
- UIï¼šäº¤ç‚¹é«˜äº®1å¸§

**ç†ç”±ï¼š** äº¤ç‚¹æ˜¯"ç»å¯¹è½ç‚¹"ï¼Œguideæ˜¯"å¯¹é½æ„å›¾"ã€‚

---

### åœºæ™¯5ï¼šGrid Point + Edge åŒæ—¶å‘½ä¸­

**âœ… Endpoint/Edgeä¼˜å…ˆï¼ˆP1/P2 > P3ï¼‰**

**ç»†åˆ†ï¼š**
- å¦‚æœäº¤ç‚¹åˆšå¥½æ˜¯endpoint â†’ Endpoint
- å¦åˆ™ï¼Œå¦‚æœcursoræ›´æ¥è¿‘edgeæŠ•å½±ç‚¹ â†’ Edge
- åªæœ‰åœ¨ç¦»edge/endpointæ›´è¿œæ—¶æ‰ç”¨Grid Point

**ç†ç”±ï¼š** å·²æœ‰å‡ ä½•çš„ç«¯ç‚¹/è¾¹æ˜¯æ›´çœŸå®çš„çº¦æŸæ¥æºã€‚

---

### åœºæ™¯6ï¼šClosure Target + ä»»ä½•ä¸œè¥¿

**âœ… Closureæ°¸è¿œèµ¢ï¼ˆP0æœ€é«˜ï¼‰**

**æ¡ä»¶ï¼š** ç»ˆç‚¹è¿›å…¥closureThreshold

**è¡Œä¸ºï¼š**
- å¼ºåˆ¶å¸åˆ°é—­åˆç‚¹
- UIï¼šé—­åˆç‚¹é—ªä¸€ä¸‹

**ç†ç”±ï¼š** ç”¨æˆ·æ„å›¾ææ˜ç¡®ï¼š"æˆ‘è¦é—­åˆ"ã€‚ç³»ç»Ÿå¿…é¡»å¸®ä»–å®Œæˆã€‚

---

## é”å®šå¼ºåº¦è¡¨

| Winner | é”å®šå¼ºåº¦ | å…è®¸ç§»åŠ¨æ–¹å‘ |
|--------|---------|-------------|
| **Closure** | è¶…å¼ºé”æ­» | ä¸å…è®¸ |
| **Endpoint** | è¶…å¼ºé”æ­» | ä¸å…è®¸ |
| **On Edge** | å¼ºé” | æ²¿edgeå¯æ»‘ï¼ˆå¯é€‰ï¼‰ |
| **Grid Point** | è¶…å¼ºé”æ­» | ä¸å…è®¸ |
| **Guide** | å¼ºé” | æ²¿guideæ–¹å‘ |
| **Axis** | ä¸­å¼ºé” | æ²¿è½´ |
| **Grid Line** | å¼±é” | æ²¿çº¿ï¼ˆå¯é€‰ï¼‰ |
| **Free** | æ—  | è‡ªç”± |

---

## è„±ç¦»è§„åˆ™ï¼ˆé˜²æŠ–åŠ¨ / é˜²"å¸ä½å‡ºä¸æ¥"ï¼‰

**SketchUpæ‰‹æ„Ÿå¾ˆå¤§ä¸€éƒ¨åˆ†æ¥è‡ªè¿™æ¡ï¼šè¿›å…¥å®¹æ˜“ï¼Œé€€å‡ºè¦"æ˜æ˜¾åŠ¨ä½œ"ã€‚**

### å®šå‹è§„åˆ™

- **è¿›å…¥ï¼š** è·ç¦» â‰¤ threshold
- **é€€å‡ºï¼š** è·ç¦» â‰¥ 2Ã—thresholdï¼ˆhysteresisï¼‰

### å¦å¤–

- **Endpoint / Closure / Grid Pointï¼š** åªèƒ½é "æ˜æ˜¾ç¦»å¼€"æˆ–å–æ¶ˆ
- **Guide / Axisï¼š** åå‘ç§»åŠ¨ä¹Ÿå¯è§£é™¤ï¼ˆå¯é€‰ï¼‰

---

# Part 3ï¼šå†²çªä¼˜å…ˆçº§æµç¨‹å›¾

## æ€»æµç¨‹ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼Œå‘½ä¸­å³åœï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cursor Frame Update (mousemove)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘  æ˜¯å¦è¿›å…¥ Closure Threshold? â”‚
â”‚   (é è¿‘èµ·ç‚¹ / é—­åˆç‚¹)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = CLOSURE (P0)          â”‚
â”‚ - å¼ºåˆ¶å¸åˆ°é—­åˆç‚¹               â”‚
â”‚ - å®Œå…¨é”æ­»                     â”‚
â”‚ - é—­åˆç‚¹é—ªä¸€ä¸‹                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘¡ æ˜¯å¦å‘½ä¸­ Endpoint?           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = ENDPOINT (P1)         â”‚
â”‚ - å¸åˆ°ç«¯ç‚¹                     â”‚
â”‚ - å®å¿ƒçº¢æ–¹å—                   â”‚
â”‚ - å®Œå…¨é”æ­»                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘¢ æ˜¯å¦å‘½ä¸­ Edge?               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = ON_EDGE (P2)          â”‚
â”‚ - æŠ•å½±åˆ°çº¿æ®µ                   â”‚
â”‚ - å®å¿ƒçº¢æ–¹å—                   â”‚
â”‚ - å¯é€‰ï¼šæ²¿ edge æ»‘åŠ¨           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘£ æ˜¯å¦å‘½ä¸­ Grid Point?         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = GRID_POINT (P3)       â”‚
â”‚ - è·³åˆ°äº¤ç‚¹                     â”‚
â”‚ - å®Œå…¨é”æ­»                     â”‚
â”‚ - é«˜äº® 1 å¸§                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘¤ æ˜¯å¦å‘½ä¸­ Guide Line?         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = GUIDE (P4)            â”‚
â”‚ - æ³•å‘é”æ­»                     â”‚
â”‚ - åªèƒ½æ²¿ guide ç§»åŠ¨            â”‚
â”‚ - é¢œè‰² = guide é¢œè‰²            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘¥ æ˜¯å¦æ»¡è¶³ Axis Inference?     â”‚
â”‚ (Î”x / Î”y æ¯”ä¾‹)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = AXIS_LOCK (P5)        â”‚
â”‚ - é” X / Y / Blue              â”‚
â”‚ - çº¢ / ç»¿ / è“                 â”‚
â”‚ - æ²¿è½´ç§»åŠ¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘¦ æ˜¯å¦å‘½ä¸­ Grid Line?          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ YES
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = GRID_LINE (P6)        â”‚
â”‚ - å¼±é”                         â”‚
â”‚ - æ²¿çº¿ç§»åŠ¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ STOP
                â–¼
           [Final Cursor]

        NO
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINNER = FREE (P7)             â”‚
â”‚ - cursor è·Ÿéšé¼ æ ‡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æµç¨‹å›¾èƒŒåçš„ä¸‰ä¸ªç¡¬è§„åˆ™

### è§„åˆ™1ï¼šå‘½ä¸­å³åœï¼ˆFirst-hit winsï¼‰

ä¸€æ—¦æŸä¸€å±‚å‘½ä¸­ï¼Œä¸‹é¢çš„å…¨éƒ¨ä¸å†è®¡ç®—ã€‚

ğŸ‘‰ é˜²æ­¢"å¸äº†åˆè¢«æ‹‰èµ°"

### è§„åˆ™2ï¼šäº‹å® > æ¨æ–­

Endpoint / Edge / Grid Pointæ°¸è¿œå‹è¿‡Axis / Guide

ğŸ‘‰ è¿™æ˜¯SketchUpæ‰‹æ„Ÿçš„çµé­‚

### è§„åˆ™3ï¼šé”å®šæ˜¯çŠ¶æ€ï¼Œä¸æ˜¯åŠ›åº¦

winnerå†³å®šï¼š
- åæ ‡æ€ä¹ˆç®—
- èƒ½ä¸èƒ½åŠ¨
- UIç”¨ä»€ä¹ˆå½¢æ€

ğŸ‘‰ ä¸å­˜åœ¨"å¸ä¸€ç‚¹ç‚¹"

---

## å·¥ç¨‹å®ç°å»ºè®®

### æ¨èç»“æ„ï¼ˆä¼ªä»£ç ï¼‰

```typescript
function resolveCursor(frame: CursorFrame): SnapResult {
  const candidates = collectCandidates(frame);

  if (candidates.closure)    return applyClosure();
  if (candidates.endpoint)   return applyEndpoint();
  if (candidates.edge)       return applyEdge();
  if (candidates.gridPoint)  return applyGridPoint();
  if (candidates.guide)      return applyGuide();
  if (candidates.axis)       return applyAxis();
  if (candidates.gridLine)   return applyGridLine();

  return applyFree();
}
```

**ğŸ“Œ é‡è¦ï¼š**
- ä¸è¦åœ¨applyXé‡Œå†åˆ¤æ–­åˆ«çš„ä¸œè¥¿
- æ‰€æœ‰å†²çªå¿…é¡»åœ¨è¿™é‡Œè§£å†³

---

# Part 4ï¼šå•å…ƒæµ‹è¯•ç”¨ä¾‹æ¸…å•

## æµ‹è¯•å‰ç»Ÿä¸€çº¦å®šï¼ˆFixtureï¼‰

### Geometry Fixture

**å·²æœ‰çŸ©å½¢ï¼š**
```
A(0,0) â†’ B(4000,0) â†’ C(4000,3000) â†’ D(0,3000) â†’ A
```

**ç«¯ç‚¹ï¼š** A, B, C, D  
**è¾¹ï¼š** AB, BC, CD, DA

**Guideï¼š**
- gVï¼šx = 2000ï¼ˆç»¿è‰²å‚ç›´å¼•å¯¼çº¿ï¼‰
- gHï¼šy = 1500ï¼ˆçº¢è‰²æ°´å¹³å¼•å¯¼çº¿ï¼‰

**Gridï¼š**
- gridStep = 500
- gridPointsåŒ…å«(2000,1500)ç­‰äº¤ç‚¹

---

### Thresholdsï¼ˆå˜é‡åï¼‰

```typescript
closureT
endpointT
edgeT
gridPointT
guideT
axisBiasï¼ˆä¾‹å¦‚ 1.3ï¼‰
exitHysteresis = 2x threshold
```

---

### è¾“å‡ºç»“æ„

```typescript
interface SnapResult {
  winner: SnapWinner;
  finalPoint: {x: number, y: number};
  uiToken?: {color: string, marker: string};
  lock?: {type: string, dir: string};
}
```

---

## A. Closureï¼ˆP0ï¼‰æµ‹è¯•

### A1ï½œè¿›å…¥é—­åˆåŒºï¼ŒClosureæ°¸è¿œèµ¢

**Arrangeï¼š**
- startPoint = A(0,0)
- cursor = (0+0.5*closureT, 0)

**Actï¼š** resolve()

**Assertï¼š**
- winner == CLOSURE
- finalPoint == Aï¼ˆç²¾ç¡®ç›¸ç­‰ï¼‰
- marker == closure highlightï¼ˆå¦‚æœ‰ï¼‰

---

### A2ï½œClosureå‹è¿‡Endpoint/Edge/Grid/Guide/Axis

**Arrangeï¼š**
- startPoint = A(0,0)
- cursoræ”¾åœ¨æ—¢æ¥è¿‘Aåˆåœ¨guideä¸Šåˆæ¥è¿‘gridpointçš„ä½ç½®

**Assertï¼š**
- winner == CLOSUREï¼ˆåªè¦æ»¡è¶³closureæ¡ä»¶å°±å¿…é¡»èµ¢ï¼‰

---

### A3ï½œè¶…å‡ºé—­åˆåŒºï¼Œä¸èƒ½è¯¯è§¦Closure

**Arrangeï¼š**
- cursor = (closureT*1.01, 0)

**Assertï¼š**
- winner != CLOSURE

---

## B. Endpointï¼ˆP1ï¼‰æµ‹è¯•

### B1ï½œæ¥è¿‘ç«¯ç‚¹å¿…å¸é™„åˆ°ç«¯ç‚¹

**Arrangeï¼š**
- cursor = B + (endpointT*0.5, 0)

**Assertï¼š**
- winner == ENDPOINT
- finalPoint == B

---

### B2ï½œEndpointå‹è¿‡Edge

**Arrangeï¼š**
- cursoråœ¨Bé™„è¿‘ï¼ŒåŒæ—¶è·ç¦»AB/BCä¹Ÿå°äºedgeT

**Assertï¼š**
- winner == ENDPOINTï¼ˆä¸å…è®¸ON_EDGEæŠ¢ï¼‰

---

### B3ï½œEndpointå‹è¿‡GridPoint

**Arrangeï¼š**
- æŠŠBè®¾ç½®åœ¨gridpointä¸Š

**Assertï¼š**
- winner == ENDPOINT

---

## C. On Edgeï¼ˆP2ï¼‰æµ‹è¯•

### C1ï½œæ¥è¿‘è¾¹ä½†ä¸åœ¨ç«¯ç‚¹èŒƒå›´ â†’ ON_EDGE

**Arrangeï¼š**
- cursor = æŠ•å½±åˆ°ABä¸­ç‚¹é™„è¿‘
- è·ç¦»AB < edgeT
- ä¸”è·ç¦»A/B > endpointT

**Assertï¼š**
- winner == ON_EDGE
- finalPointè½åœ¨ABä¸Šï¼ˆy==0 ä¸” xåœ¨(0,4000)ï¼‰

---

### C2ï½œON_EDGEå‹è¿‡Guide/Axes

**Arrangeï¼š**
- cursoråŒæ—¶æ»¡è¶³ï¼š
  - è·ç¦»AB < edgeT
  - ä¹Ÿåœ¨gVçš„guideTå†…ï¼ˆæ¯”å¦‚ABä¸Šé€‰x=2000ï¼‰
  - Axisæ¨æ–­ä¹Ÿæˆç«‹

**Assertï¼š**
- winner == ON_EDGE

---

### C3ï½œON_EDGEçš„finalPointå¿…é¡»æ˜¯"æŠ•å½±ç‚¹"

**Arrangeï¼š**
- cursor = (2000, edgeT*0.5)ï¼ˆåœ¨ABä¸Šæ–¹ä¸€ç‚¹ï¼‰

**Assertï¼š**
- winner == ON_EDGE
- finalPoint == (2000,0)ï¼ˆæŠ•å½±ï¼‰

---

### C4ï½œEdgeæ»‘åŠ¨ï¼ˆå¦‚æœæ”¯æŒæ²¿è¾¹æ»‘åŠ¨ï¼‰

**Arrangeï¼š**
- è¿ç»­cursoræ²¿ABç§»åŠ¨ï¼Œå‡åœ¨edgeTå†…

**Assertï¼š**
- winnerè¿ç»­ä¸ºON_EDGE
- finalPointæ²¿ABå•è°ƒå˜åŒ–
- æ— æŠ–åŠ¨è·³ç¦»

---

## D. Grid Pointï¼ˆP3ï¼‰æµ‹è¯•

### D1ï½œè¿›å…¥gridPointèŒƒå›´ â†’ GRID_POINT

**Arrangeï¼š**
- cursor = (2000,1500) + (gridPointT*0.5, 0)

**Assertï¼š**
- winner == GRID_POINT
- finalPoint == (2000,1500)

---

### D2ï½œGridPointå‹è¿‡Guide/Axes/GridLine

**Arrangeï¼š**
- cursoråŒæ—¶åœ¨ï¼š
  - gridPointTå†…
  - guideTå†…ï¼ˆ(2000,1500)æ­£åœ¨gV/gHä¸Šï¼‰
  - axisæ¨æ–­æˆç«‹

**Assertï¼š**
- winner == GRID_POINT

---

### D3ï½œGridPointä¸èƒ½å‹è¿‡Edge/Endpoint

**Arrangeï¼š**
- cursoråŒæ—¶æ»¡è¶³ï¼š
  - è·ç¦»æŸæ¡å·²æœ‰edge < edgeT
  - åˆåœ¨gridPointTå†…

**Assertï¼š**
- winner == ON_EDGEï¼ˆæˆ–ENDPOINTè‹¥æ›´è¿‘ç«¯ç‚¹ï¼‰

---

## E. Guideï¼ˆP4ï¼‰æµ‹è¯•

### E1ï½œè¿›å…¥guideèŒƒå›´ â†’ GUIDE

**Arrangeï¼š**
- cursor = (2000 + guideT*0.5, 1200)ï¼ˆé è¿‘gVï¼‰

**Assertï¼š**
- winner == GUIDE
- finalPoint.x == 2000ï¼ˆæ³•å‘é”æ­»ï¼‰

---

### E2ï½œGuideå‹è¿‡Axis / GridLine

**Arrangeï¼š**
- cursoråŒæ—¶æ»¡è¶³guideTä¸axisæ¨æ–­

**Assertï¼š**
- winner == GUIDE

---

### E3ï½œGuideé€€å‡ºå¿…é¡»æœ‰hysteresisï¼ˆé˜²æŠ–ï¼‰

**Arrangeï¼š**
1. cursorè¿›å…¥guideTå†…ï¼Œwinner == GUIDE
2. cursorå¾®å°ç§»å‡ºåˆ°guideT*1.1ï¼ˆä»å°äº2x guideTï¼‰

**Assertï¼š**
- ä»winner == GUIDE

3. å†ç§»åŠ¨åˆ° > 2x guideT

**Assertï¼š**
- winner != GUIDE

---

## F. Axis Inferenceï¼ˆP5ï¼‰æµ‹è¯•

### F1ï½œæ°´å¹³Axisè§¦å‘ï¼šÎ”xæ˜æ˜¾å¤§äºÎ”y

**Arrangeï¼š**
- startPoint = (1000,1000)
- cursor = (1000 + 1000, 1000 + 1000/axisBias/2)
- æ»¡è¶³|Î”x| > |Î”y|*axisBias

**Assertï¼š**
- winner == AXIS_LOCK
- finalPoint.y == startPoint.yï¼ˆé”æ°´å¹³ï¼‰
- ui color == RED

---

### F2ï½œå‚ç›´Axisè§¦å‘ï¼šÎ”yæ˜æ˜¾å¤§äºÎ”x

**Assertï¼š**
- winner == AXIS_LOCK
- finalPoint.x == startPoint.x
- color == GREEN

---

### F3ï½œAxisä¸èƒ½æŠ¢è¿‡Guide

**Arrangeï¼š**
- åŒæ—¶æ»¡è¶³axis & guide

**Assertï¼š**
- winner == GUIDE

---

### F4ï½œAxisé€€å‡ºè§„åˆ™ï¼šåå‘æ˜æ˜¾ç§»åŠ¨è§£é™¤

**Arrangeï¼š**
- å…ˆé”æ°´å¹³
- å†æŠŠcursoræ”¹æˆæ˜æ˜¾å‚ç›´æ„å›¾

**Assertï¼š**
- ä»AXIS_LOCK â†’ DRAWING_ACTIVE/å¦ä¸€ä¸ªAXIS_LOCK

---

## G. Grid Lineï¼ˆP6ï¼‰æµ‹è¯•

### G1ï½œé è¿‘gridçº¿ä½†ä¸é è¿‘gridç‚¹ â†’ GRID_LINE

**Arrangeï¼š**
- cursorè·ç¦»æŸæ¡gridçº¿ < gridLineT
- ä¸”è·ç¦»æœ€è¿‘gridç‚¹ > gridPointT

**Assertï¼š**
- winner == GRID_LINEï¼ˆè‹¥å¯ç”¨ï¼‰

---

### G2ï½œGridLineå¿…é¡»è¾“ç»™Axis / Guide / GridPoint

**Arrangeï¼š**
- åŒæ—¶æ»¡è¶³gridLine + axis

**Assertï¼š**
- winner == AXIS_LOCK

åŒç†ï¼š
- gridLine + guide â†’ GUIDE
- gridLine + gridPoint â†’ GRID_POINT

---

## H. Freeï¼ˆP7ï¼‰æµ‹è¯•

### H1ï½œæ— ä»»ä½•å€™é€‰å‘½ä¸­ â†’ FREE

**Arrangeï¼š**
- cursorè¿œç¦»æ‰€æœ‰edge/endpoint/grid/guide
- ä¸”axisä¸æˆç«‹

**Assertï¼š**
- winner == FREE
- finalPoint == cursor

---

## I. "é—­åˆå¤±è´¥"å›å½’æµ‹è¯•ï¼ˆCEOç—›ç‚¹ï¼‰

### I1ï½œç”»çŸ©å½¢æœ€åä¸€æ®µå¿…é¡»é—­åˆï¼ˆClosure Biasï¼‰

**Arrangeï¼š**
- æ¨¡æ‹Ÿç»˜åˆ¶å››æ®µ
- æœ€åä¸€æ®µç»ˆç‚¹è½åœ¨Aé™„è¿‘ä½†ä¸ç²¾ç¡®

**Actï¼š** commitç»ˆç‚¹

**Assertï¼š**
- æœ€åä¸€æ®µç»ˆç‚¹ == Aï¼ˆç²¾ç¡®ï¼‰
- è½®å»“åˆ¤å®šclosed == true
- æ— ç¼éš™ï¼ˆæ‰€æœ‰ç«¯ç‚¹åœ¨coincidence toleranceå†…ï¼‰

---

### I2ï½œé—­åˆç‚¹å‡ºç°æ—¶ä¸å…è®¸è¢«Guide/Axesæ‹‰èµ°

**Arrangeï¼š**
- æœ€åä¸€æ®µåŒæ—¶æ»¡è¶³guide/axis

**Assertï¼š**
- winner == CLOSURE

---

## J. UI TokenéªŒæ”¶ï¼ˆå¯é€‰ä½†å¼ºçƒˆå»ºè®®ï¼‰

### J1ï½œON_EDGE/ENDPOINTå¿…é¡»æ˜¾ç¤º"å®å¿ƒçº¢æ–¹å—"

**Assertï¼š**
- marker == SOLID_RED_SQUARE

---

### J2ï½œAXIS_LOCKå¿…é¡»æ˜¾ç¤ºå¯¹åº”é¢œè‰²çº¿/æç¤º

**Assertï¼š**
- color == RED/GREEN/BLUE

---

### J3ï½œGRID_POINTé«˜äº®1å¸§ï¼ˆå¦‚æœå®ç°ï¼‰

**Assertï¼š**
- uiToken.flash == trueï¼ˆæˆ–frameCount==1ï¼‰

---

# âœ… éªŒæ”¶æ ‡å‡†ï¼ˆDefinition of Doneï¼‰

## åŠŸèƒ½éªŒæ”¶

- [ ] çŠ¶æ€æœºå®Œæ•´å®ç°ï¼ˆ7ä¸ªçŠ¶æ€ï¼‰
- [ ] ä¼˜å…ˆçº§ä¸¥æ ¼æŒ‰P0â†’P7
- [ ] é¢œè‰²è¯­ä¹‰æ­£ç¡®ï¼ˆçº¢=æ°´å¹³ï¼Œç»¿=å‚ç›´ï¼Œè“=æ·±åº¦ï¼‰
- [ ] å®å¿ƒçº¢æ–¹å—åœ¨ON_EDGE/ENDPOINTæ—¶æ˜¾ç¤º
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆA-Jå…¨éƒ¨åœºæ™¯ï¼‰

---

## æ‰‹æ„ŸéªŒæ”¶ï¼ˆå…³é”®ï¼ï¼‰

### å¿…é¡»é€šè¿‡çš„5ä¸ªä½“éªŒæµ‹è¯•

- [ ] **æ²¿ç»¿è‰²å¼•å¯¼çº¿ç§»åŠ¨æ—¶ï¼š** cursorä¸èƒ½åœ¨é™„è¿‘é£˜ç§»ï¼ˆæ³•å‘é”æ­»ï¼‰
- [ ] **æ¥è¿‘å·²æœ‰çº¿æ—¶ï¼š** å‡ºç°å®å¿ƒçº¢æ–¹å—å¹¶å¼ºå¸é™„ï¼ˆOn Edgeï¼‰
- [ ] **æ¥è¿‘ç«¯ç‚¹æ—¶ï¼š** ä¼˜å…ˆç«¯ç‚¹ï¼ˆä¸è¢«guideæŠ¢èµ°ï¼‰
- [ ] **æ¥è¿‘gridäº¤ç‚¹æ—¶ï¼š** è·³åˆ°äº¤ç‚¹ï¼ˆä¸æŠ–ï¼‰
- [ ] **ç”»é—­åˆè½®å»“æ—¶ï¼š** æœ€åä¸€æ®µæ°¸è¿œèƒ½è‡ªåŠ¨é—­åˆï¼ˆClosure Biasï¼‰

---

## ä½“æ„Ÿç›®æ ‡

- [ ] **å¼•å¯¼çº¿ä½“æ„Ÿï¼š** "é¼ æ ‡è¢«æ‹½ä½"ï¼Œä¸æ˜¯"æœ‰ç‚¹å¸"
- [ ] **ç«¯ç‚¹ä½“æ„Ÿï¼š** "ç›´æ¥è·³è¿‡å»"ï¼Œä¸æ˜¯"æ…¢æ…¢å¸"
- [ ] **é—­åˆä½“æ„Ÿï¼š** "ç³»ç»Ÿå¸®æˆ‘å®Œæˆ"ï¼Œä¸æ˜¯"è€ƒéªŒæˆ‘æ‰‹ç¨³"
- [ ] **æ— æ€è€ƒï¼š** Contractorç”¨0ç§’ç†è§£å½“å‰å¸é™„çŠ¶æ€

---

## ä»£ç éªŒæ”¶

- [ ] ä½¿ç”¨çŠ¶æ€æœºï¼Œä¸æ˜¯if-elseå †å 
- [ ] å†²çªè§£å†³åœ¨å•ä¸€å‡½æ•°ï¼ˆresolveCursorï¼‰
- [ ] é…ç½®æ–‡ä»¶æ¸…æ™°å¯è°ƒ
- [ ] æ€§èƒ½ï¼š60fpsæ— å¡é¡¿
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%

---

# ğŸ“… æ‰§è¡Œè®¡åˆ’

## Phase 1ï¼šçŠ¶æ€æœºåŸºç¡€ï¼ˆDay 1-2ï¼Œ8-12å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
1. å®ç°DrawingStateæšä¸¾
2. å®ç°çŠ¶æ€è½¬ç§»é€»è¾‘
3. åŸºç¡€çŠ¶æ€æµ‹è¯•

**äº§å‡ºï¼š**
- `DrawingStateMachine.ts`
- 7ä¸ªçŠ¶æ€éƒ½èƒ½æ­£ç¡®è½¬ç§»

---

## Phase 2ï¼šAxis Inferenceï¼ˆDay 3ï¼Œ4-6å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
1. å®ç°Î”x/Î”yè®¡ç®—
2. å®ç°axisBiasæ¨æ–­
3. é¢œè‰²è¯­ä¹‰ï¼ˆçº¢/ç»¿/è“ï¼‰
4. è½´å‘é”å®š

**äº§å‡ºï¼š**
- Axisæ¨æ–­å·¥ä½œ
- é¢œè‰²æ­£ç¡®

---

## Phase 3ï¼šå†²çªä¼˜å…ˆçº§ï¼ˆDay 4-5ï¼Œ8-12å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
1. å®ç°resolveCursorå‡½æ•°
2. å®ç°P0â†’P7ä¼˜å…ˆçº§
3. æ‰€æœ‰å†²çªåœºæ™¯æµ‹è¯•

**äº§å‡ºï¼š**
- `SnapResolver.ts`
- å†²çªä¼˜å…ˆçº§æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## Phase 4ï¼šUIåé¦ˆï¼ˆDay 6ï¼Œ4-6å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
1. å®å¿ƒçº¢æ–¹å—æ˜¾ç¤º
2. é¢œè‰²çº¿æ˜¾ç¤º
3. é—­åˆç‚¹é—ªçƒ
4. Gridäº¤ç‚¹é«˜äº®

**äº§å‡ºï¼š**
- è§†è§‰åé¦ˆå®Œæ•´
- æ‰‹æ„Ÿè¾¾åˆ°SketchUpæ ‡å‡†

---

## Phase 5ï¼šå•å…ƒæµ‹è¯•ä¸éªŒæ”¶ï¼ˆDay 7-8ï¼Œ8-12å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
1. å®ç°A-Jå…¨éƒ¨æµ‹è¯•ç”¨ä¾‹
2. å›å½’æµ‹è¯•
3. æ‰‹æ„Ÿè°ƒä¼˜
4. æ€§èƒ½ä¼˜åŒ–

**äº§å‡ºï¼š**
- æµ‹è¯•è¦†ç›–ç‡ > 90%
- æ‰€æœ‰DoDé€šè¿‡
- ä½“æ£€æŠ¥å‘Š

---

## æ€»è®¡æ—¶é—´

**é¢„è®¡ï¼š** 7-8å¤©ï¼ˆçº¦40-60å°æ—¶ï¼‰

---

# ğŸš¨ å…³é”®æ³¨æ„äº‹é¡¹

## ä¸ºä»€ä¹ˆè¿™å¥—è®¾è®¡ä¸å¯å¦¥å

1. **è‚Œè‚‰è®°å¿†çº§åˆ«ä½“éªŒ**
   - åé¢æ”¹ = ç”¨æˆ·é‡æ–°å­¦ä¹ 

2. **Contractorè¯„ä»·åªæœ‰ä¸€å¥è¯ï¼š**
   - "è¿™ä¸ªç”»çº¿å‡†ä¸å‡†ï¼Œä¼šä¸ä¼šè€æ˜¯é—­åˆä¸äº†"
   - ä¸æ˜¯"åŠŸèƒ½å¤šä¸å¤š"

3. **SketchUpæ˜¯2Dç”»çº¿çš„é»„é‡‘æ ‡å‡†**
   - å¤åˆ»å®ƒ = ç«™åœ¨å·¨äººè‚©è†€ä¸Š
   - è‡ªåˆ› = 99%ä¼šæ›´å·®

---

## å·¥ç¨‹è½åœ°çš„ä¸‰ä¸ªå»ºè®®

### 1. æ¯å¸§è®¡ç®—åªåšä¸‰æ­¥

```typescript
function onMouseMove(e) {
  // 1. æ”¶é›†å€™é€‰
  const candidates = collectCandidates(e);
  
  // 2. æŒ‰ä¼˜å…ˆçº§é€‰winner
  const result = resolveCursor(candidates);
  
  // 3. åº”ç”¨ç»“æœ
  applySnapResult(result);
}
```

### 2. ä¸è¦åœ¨åŒä¸€å¸§é‡Œ"æ··åˆåæ ‡"

è¿™å°±æ˜¯"çœ‹èµ·æ¥å¸äº†ä½†å®é™…åäº†"çš„æ ¹æºã€‚

### 3. å…ˆå®ç°æœ€å°é›†ï¼Œå†æ‰©å±•

**æœ€å°é›†ï¼ˆMVPï¼‰ï¼š**
- Endpoint
- Edge
- Axis
- Closure

**æ‰©å±•ï¼ˆv1.1ï¼‰ï¼š**
- Guide
- Grid Point
- Grid Line

---

# ğŸ’¬ CPOæ€»ç»“

> **è¿™å¥—å•å…ƒæµ‹è¯•çš„"æ„ä¹‰ä¸€å¥è¯"ï¼š**
> 
> **ä»»ä½•äººåªè¦æ”¹åŠ¨snap / inferenceï¼Œè·‘å®Œè¿™å¥—æµ‹è¯•å°±çŸ¥é“æ‰‹æ„Ÿæœ‰æ²¡æœ‰è¢«ç ´åã€‚è¿™å°±æ˜¯æŠŠ"SketchUp feel"å˜æˆå¯ç»´æŠ¤çš„å·¥ç¨‹èµ„äº§ã€‚**
> 
> **PlanSnapçš„ç”»çº¿ä¸æ˜¯"é¼ æ ‡äº‹ä»¶"ï¼Œè€Œæ˜¯"å‡ ä½•è£å†³æµç¨‹"ã€‚è¿™å¼ æµç¨‹å›¾ï¼Œå°±æ˜¯ä½ ä»¬çš„å‡ ä½•æ³•å®˜ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**å®šå‹äººï¼š** CPO  
**ç”Ÿæ•ˆæ—¥æœŸï¼š** 2026-02-04  
**æ‰§è¡Œäººï¼š** CTO  
**é¢„è®¡å‘¨æœŸï¼š** 7-8å¤©å®Œæ•´å®ç°

---

SketchUpé£æ ¼ç”»çº¿ = PlanSnapçš„æ‰‹æ„ŸåŸºç¡€ï¼ğŸš€
