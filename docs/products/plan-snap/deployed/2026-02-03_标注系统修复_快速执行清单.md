# æ ‡æ³¨ç³»ç»Ÿç²¾åº¦å’Œäº¤äº’ä¿®å¤ - å¿«é€Ÿæ‰§è¡Œæ¸…å•

> **CTO 5åˆ†é’Ÿé€ŸæŸ¥å¡**  
> **é¢„è®¡å·¥ä½œé‡ï¼š** 3å¤©  
> **ä¼˜å…ˆçº§ï¼š** ğŸ”´ P0 - Criticalï¼ˆç”¨æˆ·ä¿¡ä»»åº¦ï¼‰

---

## âš¡ ä¸€å¥è¯é—®é¢˜

**36-1/4" æ˜¾ç¤ºæˆ 3'-0"ï¼Œæ ‡æ³¨ä¸èƒ½åƒSketchUpé‚£æ ·é€‰æ–¹å‘å’Œæ‹‰ä¼¸**

**CPOæ˜ç¡®è¦æ±‚ï¼š**
> "æ ‡æ³¨åº”è¯¥åƒSketchUpé‚£æ ·æ˜¯å¯ä»¥é€‰æ‹©æ–¹å‘å’Œæ‹‰ä¼¸çš„ã€‚"

---

## ğŸ¯ ä¸¤ä¸ªç‹¬ç«‹é—®é¢˜

### é—®é¢˜1ï¼šç²¾åº¦ä¸¢å¤±
```
36-1/4" = 36.25" = 3'-0 1/4"
ä½†æ˜¾ç¤ºï¼š3'-0" (åˆ†æ•°ä¸¢å¤±)

æ ¹å› ï¼š
- formatterå››èˆäº”å…¥åˆ°æ•´è‹±å¯¸
- æˆ–ä»grid/pixelåç®—è·ç¦»
```

### é—®é¢˜2ï¼šäº¤äº’ä¸ä¸“ä¸š
```
ä¸èƒ½é€‰æ‹©æ–¹å‘ï¼ˆä¸Š/ä¸‹/å·¦/å³ï¼‰
ä¸èƒ½æ‹–åŠ¨åç§»è·ç¦»
æ”¾ç½®åä¸å¯è°ƒæ•´
```

---

## ğŸ”§ æ ¸å¿ƒä¿®å¤ï¼ˆCopy & Pasteï¼‰

### 1. å”¯ä¸€çœŸç›¸æ¥æºï¼ˆé“å¾‹ï¼‰

```typescript
// âœ… æ­£ç¡®
const lenMm = distance(dim.A_world, dim.B_world)
const text = formatLength(lenMm, unitSystem, precision)

// âŒ é”™è¯¯
const lenMm = pixelDist * mmPerPixel         // ä¸ä»åƒç´ 
const lenMm = gridCount * gridStepMm         // ä¸ä»grid
const lenMm = parseDisplayText(dim.text)     // ä¸ä»æ˜¾ç¤ºæ–‡æœ¬
```

**é“å¾‹ï¼š**
```
æ ‡æ³¨å€¼æ°¸è¿œæ¥è‡ªï¼šä¸–ç•Œåæ ‡çœŸå®è·ç¦»ï¼ˆmmï¼‰
ä»…åœ¨UIå±‚æ ¼å¼åŒ–æˆè‹±åˆ¶/å…¬åˆ¶
```

---

### 2. æ ¼å¼åŒ–å‡½æ•°ï¼ˆå®Œæ•´å®ç°ï¼‰

```typescript
type Precision = 1 | 0.5 | 0.25 | 0.125 | 0.0625

function formatLength(
  lenMm: number,
  unitSystem: 'imperial' | 'metric',
  precision: Precision
): string {
  if (unitSystem === 'metric') {
    return `${Math.round(lenMm)} mm`
  }
  
  const inches = lenMm / 25.4
  const feet = Math.floor(inches / 12)
  const remainingInches = inches - feet * 12
  
  // åœ†æ•´åˆ°precision
  const rounded = Math.round(remainingInches / precision) * precision
  const whole = Math.floor(rounded)
  const frac = rounded - whole
  
  // è½¬æ¢ä¸ºåˆ†æ•°
  const fraction = frac < 0.001 ? null : 
    decimalToFraction(frac, precision)
  
  // æ ¼å¼åŒ–
  if (feet > 0) {
    if (fraction) {
      return `${feet}'-${whole} ${fraction}"`
    } else if (whole > 0) {
      return `${feet}'-${whole}"`
    } else {
      return `${feet}'-0"`
    }
  } else {
    if (fraction) {
      return `${whole} ${fraction}"`
    } else {
      return `${whole}"`
    }
  }
}

function decimalToFraction(decimal: number, precision: Precision): string {
  const denominator = Math.round(1 / precision)
  const numerator = Math.round(decimal * denominator)
  
  // ç®€åŒ–åˆ†æ•°
  const gcd = (a, b) => b ? gcd(b, a % b) : a
  const g = gcd(numerator, denominator)
  
  return `${numerator / g}/${denominator / g}`
}
```

---

### 3. æ•°æ®ç»“æ„

```typescript
type Dimension = {
  id: string
  kind: 'dimension'
  
  // Source of truthï¼ˆä¸–ç•Œåæ ‡ï¼‰
  A_world: Pt
  B_world: Pt
  offsetMm: number
  
  orientationMode: 'auto' | 'horizontal' | 'vertical'
  flipSide?: boolean
}
```

**ä¸è¦å­˜å‚¨ï¼š**
```
âŒ displayText: "3'-0 1/4""  // ä¼šè¿‡æ—¶
âŒ screenCoords: {x, y}      // ä¼šå¤±æ•ˆ
âŒ gridIndex: number         // ä¸å‡†ç¡®
```

---

### 4. ä¸‰æ®µå¼çŠ¶æ€æœº

```typescript
type DimensionToolState =
  | { phase: 'IDLE' }
  | { phase: 'PICK_A' }
  | { phase: 'PICK_B'; a: Pt }
  | { 
      phase: 'PLACE'
      a: Pt
      b: Pt
      offsetMm: number
      flipSide: boolean
    }
  | { phase: 'COMMITTED' }
```

**äº¤äº’æµç¨‹ï¼š**
```
Dé”® â†’ PICK_A
ç‚¹å‡»A â†’ PICK_B
ç‚¹å‡»B â†’ PLACE
ç§»åŠ¨é¼ æ ‡ â†’ é€‰æ‹©æ–¹å‘+åç§»
ç‚¹å‡» â†’ COMMITTED
```

---

### 5. æ¸²æŸ“ç®—æ³•

```typescript
function renderDimension(dim: Dimension) {
  const dir = normalize(sub(dim.B_world, dim.A_world))
  const normal = perp(dir)
  if (dim.flipSide) normal = mul(normal, -1)
  
  const offset = mul(normal, dim.offsetMm)
  const dimLineA = add(dim.A_world, offset)
  const dimLineB = add(dim.B_world, offset)
  
  // Extension lines
  drawLine(dim.A_world, dimLineA, { dash: true })
  drawLine(dim.B_world, dimLineB, { dash: true })
  
  // Dimension line
  drawLine(dimLineA, dimLineB, { arrows: true })
  
  // Text
  const lenMm = distance(dim.A_world, dim.B_world)
  const text = formatLength(lenMm, unitSystem, precision)
  drawText(text, midpoint(dimLineA, dimLineB))
}
```

---

## ğŸ“‹ 3å¤©è®¡åˆ’

### Day 1: ç²¾åº¦ä¿®å¤ï¼ˆ6å°æ—¶ï¼‰ğŸ”´ ç´§æ€¥

**ä»»åŠ¡ï¼š**
- [ ] æ£€æŸ¥formatteré€»è¾‘
- [ ] ä¿®å¤decimalToFractionå‡½æ•°
- [ ] ç¡®ä¿ä»worldåæ ‡è®¡ç®—
- [ ] æ·»åŠ precisionè®¾ç½®UIï¼ˆ1", 1/2", 1/4", 1/8", 1/16"ï¼‰
- [ ] é»˜è®¤precision = 1/8" æˆ– 1/16"

**éªŒæ”¶ï¼š**
```
åˆ›å»º36-1/4"æ ‡æ³¨
æœŸæœ›ï¼šæ˜¾ç¤º "3'-0 1/4"" æˆ– "36 1/4""
ä¸æ˜¯ï¼šæ˜¾ç¤º "3'" æˆ– "3'-0""
```

---

### Day 2: ä¸‰æ®µå¼äº¤äº’ï¼ˆ6å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
- [ ] DimensionToolçŠ¶æ€æœº
- [ ] PICK_A, PICK_B, PLACEçŠ¶æ€
- [ ] é¼ æ ‡ç§»åŠ¨æ—¶é¢„è§ˆæ ‡æ³¨
- [ ] é¢„è§ˆåˆ‡æ¢ä¾§è¾¹ï¼ˆä¸Š/ä¸‹ï¼‰

**éªŒæ”¶ï¼š**
```
Dé”® â†’ ç‚¹A â†’ ç‚¹B â†’ ç§»åŠ¨é¼ æ ‡
æœŸæœ›ï¼šæ ‡æ³¨é¢„è§ˆè·Ÿéšé¼ æ ‡ï¼Œä¾§è¾¹å¯åˆ‡æ¢
```

---

### Day 3: æ‹–åŠ¨å’Œå¢å¼ºï¼ˆ6å°æ—¶ï¼‰

**ä»»åŠ¡ï¼š**
- [ ] æ”¾ç½®åå¯æ‹–åŠ¨æ ‡æ³¨çº¿
- [ ] offsetMmå®æ—¶æ›´æ–°
- [ ] A/Bç‚¹ä¸å˜
- [ ] å¿«æ·é”®F/Xç¿»è½¬
- [ ] è¾“å…¥åç§»å€¼ï¼ˆå¤ç”¨parseLengthToMMï¼‰

**éªŒæ”¶ï¼š**
```
åˆ›å»ºæ ‡æ³¨ â†’ æ‹–åŠ¨æ ‡æ³¨çº¿
æœŸæœ›ï¼šåç§»æ”¹å˜ï¼Œæµ‹é‡é•¿åº¦ä¸å˜
```

---

## âœ… éªŒæ”¶æ¸…å•

### ç²¾åº¦éªŒæ”¶ï¼ˆDay 1ï¼‰

- [ ] **36-1/4" æ­£ç¡®æ˜¾ç¤º**
  - ä¸æ˜¯ "3'"
  - ä¸æ˜¯ "3'-0""
  - æ˜¯ "3'-0 1/4"" æˆ– "36 1/4""

- [ ] **ç²¾åº¦å¯è°ƒ**
  - UIæœ‰ä¸‹æ‹‰èœå•
  - 1", 1/2", 1/4", 1/8", 1/16" å¯é€‰
  - é»˜è®¤ 1/8" æˆ– 1/16"

- [ ] **åˆ‡æ¢ç²¾åº¦ä¸æ”¹å‡ ä½•**
  - å†…éƒ¨ä»æ˜¯mm
  - åªæ˜¯æ˜¾ç¤ºæ–¹å¼ä¸åŒ

---

### äº¤äº’éªŒæ”¶ï¼ˆDay 2-3ï¼‰

- [ ] **ä¸‰æ®µå¼æµç•…**
  - Pick A â†’ Pick B â†’ Place
  - æ¯æ­¥éƒ½æœ‰åé¦ˆ

- [ ] **æ–¹å‘å¯é€‰**
  - é¼ æ ‡ä¸Šä¾§ï¼šæ ‡æ³¨åœ¨ä¸Š
  - é¼ æ ‡ä¸‹ä¾§ï¼šæ ‡æ³¨åœ¨ä¸‹
  - å®æ—¶é¢„è§ˆ

- [ ] **å¯æ‹–åŠ¨åç§»**
  - æ‹–åŠ¨æ ‡æ³¨çº¿
  - offsetMmæ”¹å˜
  - A/Bç‚¹ä¸å˜
  - æµ‹é‡å€¼ä¸å˜

- [ ] **å¯è¾“å…¥åç§»**
  - è¾“å…¥ "6""
  - Enterç¡®è®¤
  - æ ‡æ³¨çº¿ç§»åŠ¨

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•ç”¨ä¾‹

### TC-1: ç²¾åº¦æ˜¾ç¤º
```
è®¾ç½®precision=1/16" â†’ åˆ›å»º36-1/4"æ ‡æ³¨
æœŸæœ›ï¼šæ˜¾ç¤º "3'-0 1/4"" æˆ– "36 1/4""
```

### TC-2: ç²¾åº¦åˆ‡æ¢
```
æ ‡æ³¨36-1/4" â†’ åˆ‡æ¢åˆ°1/2" â†’ å†åˆ‡å›1/16"
æœŸæœ›ï¼š
  1/2"æ—¶ï¼š3'-0" (å››èˆäº”å…¥)
  1/16"æ—¶ï¼š3'-0 1/4" (åŸå€¼)
  å‡ ä½•ä¸å˜
```

### TC-3: ä¸‰æ®µå¼
```
Dé”® â†’ ç‚¹A â†’ ç‚¹B â†’ ç§»åŠ¨é¼ æ ‡ï¼ˆä¸ç‚¹å‡»ï¼‰
æœŸæœ›ï¼šé¢„è§ˆè·Ÿéšï¼Œä¾§è¾¹å¯åˆ‡æ¢
```

### TC-4: æ‹–åŠ¨åç§»
```
åˆ›å»ºæ ‡æ³¨ï¼ˆoffset=50mmï¼‰ â†’ æ‹–åŠ¨åˆ°100mm
æœŸæœ›ï¼šåç§»æ”¹å˜ï¼ŒA/Bä¸å˜ï¼Œæµ‹é‡å€¼ä¸å˜
```

---

## ğŸš¨ å…³é”®æ¥çº¿ç‚¹

### 1. Formatterä¿®å¤

**æ–‡ä»¶ï¼š** `src/utils/format-length.ts`

**æ£€æŸ¥å¹¶ä¿®å¤ï¼š**
```typescript
// âŒ å¯èƒ½çš„é”™è¯¯
if (fractionInch < 0.5) {
  return `${feet}'-${whole}"`  // ä¸¢å¤±1/4"
}

// âœ… æ­£ç¡®
const fraction = decimalToFraction(fractionInch, precision)
if (fraction) {
  return `${feet}'-${whole} ${fraction}"`
}
```

---

### 2. æ•°æ®æºæ£€æŸ¥

**æ–‡ä»¶ï¼š** `src/entities/dimension.ts`

**ç¡®ä¿ï¼š**
```typescript
// âœ… æ­£ç¡®
get length(): number {
  return distance(this.A_world, this.B_world)
}

// âŒ é”™è¯¯ï¼ˆåˆ é™¤ç±»ä¼¼ä»£ç ï¼‰
get length(): number {
  return this.pixelLength * this.worldScale
}
```

---

### 3. ç²¾åº¦è®¾ç½®UI

**æ–‡ä»¶ï¼š** `src/ui/toolbar.tsx`

**æ·»åŠ ï¼š**
```tsx
<div className="precision-selector">
  <label>Precision:</label>
  <select onChange={handlePrecisionChange} value={precision}>
    <option value="1">1"</option>
    <option value="0.5">1/2"</option>
    <option value="0.25">1/4"</option>
    <option value="0.125">1/8"</option>
    <option value="0.0625">1/16"</option>
  </select>
</div>
```

---

### 4. ä¸‰æ®µå¼å·¥å…·

**æ–‡ä»¶ï¼š** `src/tools/dimension-tool.ts`

**å®ç°ï¼š**
```typescript
class DimensionTool implements Tool {
  state: DimensionToolState = { phase: 'IDLE' }
  
  onPointerDown(world: Pt) {
    if (this.state.phase === 'PICK_A') {
      this.state = { phase: 'PICK_B', a: world }
    } else if (this.state.phase === 'PICK_B') {
      this.state = { 
        phase: 'PLACE', 
        a: this.state.a, 
        b: world,
        offsetMm: 0,
        flipSide: false
      }
    } else if (this.state.phase === 'PLACE') {
      this.commitDimension()
    }
  }
  
  onPointerMove(world: Pt) {
    if (this.state.phase === 'PLACE') {
      // è®¡ç®—offsetMmå’ŒflipSide
      const dir = normalize(sub(this.state.b, this.state.a))
      const normal = perp(dir)
      const toMouse = sub(world, this.state.a)
      const offsetSigned = dot(toMouse, normal)
      
      this.state.offsetMm = Math.abs(offsetSigned)
      this.state.flipSide = offsetSigned < 0
    }
  }
}
```

---

## ğŸ’¬ CPOå…³é”®å¼•ç”¨

### å…³äºç²¾åº¦
> "36-1/4" è¢«æ˜¾ç¤ºæˆ 3'-0"ï¼Œè¯´æ˜ä½ ä»¬çš„æ˜¾ç¤ºç²¾åº¦åœ¨å››èˆäº”å…¥åˆ°æ•´è‹±å¯¸ï¼Œ0.25" è¢«èˆæ‰äº†ã€‚"

### å…³äºæ•°æ®æº
> "æ ‡æ³¨æ•°å€¼å¿…é¡»æ°¸è¿œæ¥è‡ªä¸–ç•Œåæ ‡çš„çœŸå®å‡ ä½•è·ç¦»ï¼ˆmmï¼‰ï¼Œä»…åœ¨UIå±‚æ ¼å¼åŒ–æˆè‹±åˆ¶/å…¬åˆ¶ã€‚ç»å¯¹ä¸èƒ½ä»åƒç´ ã€grid indexã€æ˜¾ç¤ºæ–‡æœ¬åç®—ã€‚"

### å…³äºäº¤äº’
> "SketchUpçš„'Aligned Dimension'å¿ƒæ™ºæ¨¡å‹æ˜¯ï¼šé€‰ä¸¤ç‚¹ã€é¼ æ ‡ç§»åŠ¨å†³å®šæ ‡æ³¨æ”¾å“ªä¸€ä¾§ã€ç¬¬ä¸‰æ¬¡ç‚¹å‡»æ”¾ä¸‹ã€‚"

### å…³äºç²¾åº¦è®¾ç½®
> "æ—¢ç„¶ä½ è¦åšåˆ°æ–½å·¥çº§ï¼Œè‹±åˆ¶å¿…é¡»æ”¯æŒï¼š1/2"ã€1/4"ã€1/8"ã€1/16"ã€‚ä¸ç„¶æ°¸è¿œåµä¸å®Œã€‚"

---

## ğŸ“Š ç²¾åº¦å¯¹ç…§è¡¨

| å®é™…å€¼ | 1" | 1/2" | 1/4" | 1/8" | 1/16" |
|-------|-----|------|------|------|-------|
| 36.25" | 36" | 36" | 36 1/4" | 36 1/4" | 36 1/4" |
| 36.1875" | 36" | 36" | 36" | 36 1/4" | 36 3/16" |
| 36.125" | 36" | 36" | 36" | 36 1/8" | 36 1/8" |
| 36.5" | 37" | 36 1/2" | 36 1/2" | 36 1/2" | 36 1/2" |

---

## ğŸ¨ SketchUpå¼äº¤äº’ç¤ºæ„

```
Step 1: Pick A
  ğŸ”µ â† ç‚¹å‡»Aç‚¹

Step 2: Pick B
  ğŸ”µâ”€â”€â”€â”€â”€â”€â”€â”€ğŸ”µ â† ç‚¹å‡»Bç‚¹
      36"

Step 3: Placeï¼ˆé¼ æ ‡ç§»åŠ¨ï¼‰
  
  é¼ æ ‡åœ¨ä¸Šä¾§ï¼š
      36 1/4"
  â†‘â”€â”€â”€â”€â”€â”€â”€â”€â†‘
  ğŸ”µ        ğŸ”µ
  
  é¼ æ ‡åœ¨ä¸‹ä¾§ï¼š
  ğŸ”µ        ğŸ”µ
  â†“â”€â”€â”€â”€â”€â”€â”€â”€â†“
      36 1/4"

Step 4: Clickç¡®è®¤
```

---

## ğŸ“ æœ‰é—®é¢˜ï¼Ÿ

- formatteré€»è¾‘ â†’ çœ‹ä¼šè®®çºªè¦ "æ–‡æœ¬æ ¼å¼åŒ–" ç« èŠ‚
- ä¸‰æ®µå¼çŠ¶æ€æœº â†’ çœ‹ä¼šè®®çºªè¦ "æ ‡æ³¨äº¤äº’" ç« èŠ‚
- æ¸²æŸ“ç®—æ³• â†’ çœ‹ä¼šè®®çºªè¦ "æ¸²æŸ“é€»è¾‘" ç« èŠ‚

---

**å¼€å§‹ä¿®å¤ï¼** ğŸš€

å®Œæ•´æ–‡æ¡£ï¼š`2026-02-03_ä¼šè®®çºªè¦_æ ‡æ³¨ç³»ç»Ÿç²¾åº¦å’Œäº¤äº’ä¿®å¤.md`
