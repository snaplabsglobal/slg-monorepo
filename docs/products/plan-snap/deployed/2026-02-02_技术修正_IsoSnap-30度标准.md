# IsoSnap æŠ€æœ¯ä¿®æ­£ - 30Â° æ ‡å‡† Isometric

> **ä¿®æ­£æ—¶é—´ï¼š** 2026-02-02  
> **ä¿®æ­£äººï¼š** CPO  
> **å½±å“èŒƒå›´ï¼š** IsoSnap ç»˜åˆ¶é€»è¾‘ï¼ˆTask B2ï¼‰  
> **ä¼˜å…ˆçº§ï¼š** ğŸ”´ Critical - å¿…é¡»åœ¨å¼€å‘å‰ä¿®æ­£

---

## âš ï¸ é‡è¦ä¿®æ­£

### åŸè®¾è®¡ï¼ˆâŒ é”™è¯¯ï¼‰

```
ä½¿ç”¨ 45Â° è§’åº¦ï¼š
- Vertical (â†‘â†“)
- 45Â° left-down (â†™)
- 45Â° right-down (â†˜)
```

### æ–°è®¾è®¡ï¼ˆâœ… æ­£ç¡® - å·¥ç¨‹æ ‡å‡†ï¼‰

```
ä½¿ç”¨ 30Â° æ ‡å‡† isometricï¼š
- Vertical (90Â°)
- Isometric Left Axis (150Â° / -30Â°)
- Isometric Right Axis (30Â°)
```

---

## ğŸ“ ä¸ºä»€ä¹ˆæ˜¯ 30Â°ï¼Ÿ

### CPO çš„è¯´æ˜

> **"è¿™æ˜¯å·¥ç¨‹ isometricï¼Œä¸ä½¿ç”¨ 45Â°ã€‚"**

**å·¥ç¨‹åˆ¶å›¾æ ‡å‡†ï¼š**
- 30Â° isometric æ˜¯å›½é™…å·¥ç¨‹åˆ¶å›¾æ ‡å‡†
- ç¬¦åˆ ISO 5456ã€ASME Y14.3 ç­‰è§„èŒƒ
- ç®¡å·¥ã€å·¥ç¨‹å¸ˆã€Inspector éƒ½è®¤è¿™ä¸ªè§’åº¦
- 45Â° æ˜¯éæ ‡å‡†è§’åº¦ï¼Œä¸ä¸“ä¸š

**è§†è§‰æ•ˆæœï¼š**
- 30Â° çœ‹èµ·æ¥æ›´ç«‹ä½“
- æ›´æ¥è¿‘çœŸå®çš„ç®¡é“ç³»ç»Ÿ
- Inspector æ›´å®¹æ˜“è¯†åˆ«

---

## ğŸ”§ æŠ€æœ¯å®ç°ä¿®æ­£

### 1. Direction æšä¸¾æ›´æ–°

**ä¿®æ­£å‰ï¼š**
```typescript
enum Direction {
  VERTICAL = 'vertical',
  LEFT_DOWN = 'left-down',    // 45Â°
  RIGHT_DOWN = 'right-down'   // 45Â°
}
```

**ä¿®æ­£åï¼š**
```typescript
enum Direction {
  VERTICAL = 'vertical',           // 90Â°
  ISO_LEFT = 'iso-left',          // 150Â° (or -30Â°)
  ISO_RIGHT = 'iso-right'         // 30Â°
}
```

---

### 2. lockToDirection å‡½æ•°ä¿®æ­£

**å®Œæ•´çš„æ­£ç¡®å®ç°ï¼š**

```typescript
// /packages/iso-snap/src/utils/directionLock.ts

export enum Direction {
  VERTICAL = 'vertical',     // 90Â°
  ISO_LEFT = 'iso-left',    // 150Â° (or -30Â°)
  ISO_RIGHT = 'iso-right'   // 30Â°
}

export interface LockedPosition {
  endX: number;
  endY: number;
  direction: Direction;
}

/**
 * é”å®šåˆ°æœ€è¿‘çš„ 30Â° isometric æ–¹å‘
 * 
 * æ ‡å‡†å·¥ç¨‹ isometric è§’åº¦ï¼š
 * - Vertical: 90Â° (æ­£ä¸Š/æ­£ä¸‹)
 * - Isometric Right: 30Â° (å³ä¸Šæ–œ)
 * - Isometric Left: 150Â° (å·¦ä¸Šæ–œ) æˆ– -30Â° (å·¦ä¸‹æ–œ)
 */
export function lockToDirection(
  startX: number,
  startY: number,
  mouseX: number,
  mouseY: number
): LockedPosition {
  
  const dx = mouseX - startX;
  const dy = mouseY - startY;
  
  // è®¡ç®—è§’åº¦ï¼ˆä»¥ X è½´æ­£å‘ä¸º 0Â°ï¼Œé€†æ—¶é’ˆä¸ºæ­£ï¼‰
  // atan2 è¿”å› [-Ï€, Ï€]ï¼Œè½¬æ¢ä¸º [0, 360]
  let angle = Math.atan2(dy, dx) * (180 / Math.PI);
  if (angle < 0) angle += 360;
  
  // è®¡ç®—è·ç¦»
  const distance = Math.sqrt(dx * dx + dy * dy);
  
  // åˆ¤æ–­æœ€æ¥è¿‘çš„æ–¹å‘
  // Vertical: 90Â° Â±30Â° (60Â° - 120Â°)
  // ISO Right: 30Â° Â±30Â° (0Â° - 60Â° or 330Â° - 360Â°)
  // ISO Left: 150Â° Â±30Â° (120Â° - 180Â°)
  
  if (angle >= 60 && angle < 120) {
    // Vertical (90Â°)
    return {
      endX: startX,
      endY: startY + distance,
      direction: Direction.VERTICAL
    };
  } else if (angle >= 120 && angle < 180) {
    // ISO Left (150Â°)
    return lockToIsoLeft(startX, startY, distance);
  } else if (angle >= 0 && angle < 60) {
    // ISO Right (30Â°)
    return lockToIsoRight(startX, startY, distance);
  } else {
    // 270Â° - 330Â°: ä¹Ÿå½’åˆ° ISO Leftï¼ˆä½†æ˜¯å‘ä¸‹ï¼‰
    // æˆ–è€…æ ¹æ®å®é™…éœ€è¦åˆ¤æ–­
    // ç®€åŒ–ï¼šé»˜è®¤é”å®šåˆ°æœ€è¿‘çš„
    
    // è®¡ç®—åˆ°å„æ–¹å‘çš„è§’åº¦å·®
    const toVertical = Math.min(
      Math.abs(angle - 90),
      Math.abs(angle - 270)
    );
    const toIsoRight = Math.min(
      Math.abs(angle - 30),
      Math.abs(angle - 210)
    );
    const toIsoLeft = Math.min(
      Math.abs(angle - 150),
      Math.abs(angle - 330)
    );
    
    if (toVertical < toIsoRight && toVertical < toIsoLeft) {
      return {
        endX: startX,
        endY: mouseY, // ä½¿ç”¨é¼ æ ‡çš„ Y åæ ‡
        direction: Direction.VERTICAL
      };
    } else if (toIsoRight < toIsoLeft) {
      return lockToIsoRight(startX, startY, distance);
    } else {
      return lockToIsoLeft(startX, startY, distance);
    }
  }
}

/**
 * é”å®šåˆ° Isometric Right Axis (30Â°)
 * 
 * åœ¨ isometric åæ ‡ç³»ä¸­ï¼š
 * - X å¢åŠ ï¼ŒY ä¹Ÿå¢åŠ ï¼ˆå³ä¸Šæ–œï¼‰
 * - tan(30Â°) = 1/âˆš3 â‰ˆ 0.577
 * - æ‰€ä»¥ dy/dx = 0.577
 */
function lockToIsoRight(
  startX: number,
  startY: number,
  distance: number
): LockedPosition {
  
  // 30Â° çš„å•ä½å‘é‡
  // cos(30Â°) â‰ˆ 0.866
  // sin(30Â°) = 0.5
  const cos30 = Math.cos(30 * Math.PI / 180); // â‰ˆ 0.866
  const sin30 = Math.sin(30 * Math.PI / 180); // = 0.5
  
  return {
    endX: startX + distance * cos30,
    endY: startY + distance * sin30,
    direction: Direction.ISO_RIGHT
  };
}

/**
 * é”å®šåˆ° Isometric Left Axis (150Â°)
 * 
 * åœ¨ isometric åæ ‡ç³»ä¸­ï¼š
 * - X å‡å°‘ï¼ŒY å¢åŠ ï¼ˆå·¦ä¸Šæ–œï¼‰
 * - 150Â° = 180Â° - 30Â°
 * - cos(150Â°) = -cos(30Â°) â‰ˆ -0.866
 * - sin(150Â°) = sin(30Â°) = 0.5
 */
function lockToIsoLeft(
  startX: number,
  startY: number,
  distance: number
): LockedPosition {
  
  const cos150 = Math.cos(150 * Math.PI / 180); // â‰ˆ -0.866
  const sin150 = Math.sin(150 * Math.PI / 180); // = 0.5
  
  return {
    endX: startX + distance * cos150,
    endY: startY + distance * sin150,
    direction: Direction.ISO_LEFT
  };
}

/**
 * ç®€åŒ–ç‰ˆæœ¬ï¼ˆå¦‚æœé¼ æ ‡åœ¨ç‰¹å®šè±¡é™ï¼‰
 * 
 * è¿™ä¸ªç‰ˆæœ¬æ›´ç›´è§‚ï¼ŒåŸºäºé¼ æ ‡ç›¸å¯¹èµ·ç‚¹çš„ä½ç½®ï¼š
 * - ä¸»è¦å‘ä¸Š â†’ Vertical
 * - å³ä¸Š â†’ ISO Right (30Â°)
 * - å·¦ä¸Š â†’ ISO Left (150Â°)
 */
export function lockToDirectionSimplified(
  startX: number,
  startY: number,
  mouseX: number,
  mouseY: number
): LockedPosition {
  
  const dx = mouseX - startX;
  const dy = mouseY - startY;
  
  // è®¡ç®—ä¸ä¸‰ä¸ªæ–¹å‘çš„"äº²å’Œåº¦"
  const distance = Math.sqrt(dx * dx + dy * dy);
  
  // Vertical: åªçœ‹ Y åˆ†é‡
  const verticalScore = Math.abs(dy);
  
  // ISO Right (30Â°): åˆ†é‡æ¯”ä¾‹ dx:dy = âˆš3:1
  const isoRightDx = distance * Math.cos(30 * Math.PI / 180);
  const isoRightDy = distance * Math.sin(30 * Math.PI / 180);
  const isoRightScore = Math.abs(dx - isoRightDx) + Math.abs(dy - isoRightDy);
  
  // ISO Left (150Â°): åˆ†é‡æ¯”ä¾‹ dx:dy = -âˆš3:1
  const isoLeftDx = distance * Math.cos(150 * Math.PI / 180);
  const isoLeftDy = distance * Math.sin(150 * Math.PI / 180);
  const isoLeftScore = Math.abs(dx - isoLeftDx) + Math.abs(dy - isoLeftDy);
  
  // é€‰æ‹©å¾—åˆ†æœ€ä½çš„ï¼ˆæœ€æ¥è¿‘çš„ï¼‰
  if (verticalScore > isoRightScore && verticalScore > isoLeftScore) {
    return {
      endX: startX,
      endY: mouseY,
      direction: Direction.VERTICAL
    };
  } else if (isoRightScore < isoLeftScore) {
    return lockToIsoRight(startX, startY, distance);
  } else {
    return lockToIsoLeft(startX, startY, distance);
  }
}
```

---

### 3. æ•°æ®æ¨¡å‹æ›´æ–°

**Segment æ¥å£ï¼š**

```typescript
export interface Segment {
  id: string;
  fromNodeId: string;
  toNodeId: string;
  type: 'drain' | 'vent';
  diameter: '1-1/2"' | '2"' | '3"' | '4"';
  direction: 'vertical' | 'iso-left' | 'iso-right'; // ä¿®æ­£
}
```

---

### 4. æ¸²æŸ“æ›´æ–°

**ç»˜åˆ¶çº¿æ®µæ—¶ä½¿ç”¨æ­£ç¡®çš„è§’åº¦ï¼š**

```typescript
function renderSegment(segment: Segment): void {
  const fromNode = this.state.data.nodes.get(segment.fromNodeId)!;
  const toNode = this.state.data.nodes.get(segment.toNodeId)!;
  
  // ç»˜åˆ¶çº¿æ®µ
  this.ctx.beginPath();
  this.ctx.moveTo(fromNode.x, fromNode.y);
  this.ctx.lineTo(toNode.x, toNode.y);
  this.ctx.strokeStyle = segment.type === 'drain' ? '#60a5fa' : '#34d399';
  this.ctx.lineWidth = 3;
  this.ctx.stroke();
  
  // éªŒè¯è§’åº¦ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼Œç”Ÿäº§å¯ç§»é™¤ï¼‰
  if (process.env.NODE_ENV === 'development') {
    const dx = toNode.x - fromNode.x;
    const dy = toNode.y - fromNode.y;
    const angle = Math.atan2(dy, dx) * (180 / Math.PI);
    
    // æ£€æŸ¥æ˜¯å¦ç¬¦åˆæ ‡å‡†è§’åº¦
    const validAngles = [90, 30, 150, -30, -90, -150];
    const isValid = validAngles.some(validAngle => 
      Math.abs(angle - validAngle) < 1 // 1Â° å®¹å·®
    );
    
    if (!isValid) {
      console.warn(`Invalid segment angle: ${angle}Â°`);
    }
  }
}
```

---

## ğŸ“‹ CPO çš„å®Œæ•´è¦æ±‚

### 1. ä¸‰æ–¹å‘é”å®šï¼ˆ30Â° isometricï¼‰

```
âœ… Vertical (90Â°)
âœ… Isometric Left Axis (150Â° / -30Â°)
âœ… Isometric Right Axis (30Â°)
```

---

### 2. æ‹–åŠ¨æ—¶è‡ªåŠ¨å¸é™„

**è¦æ±‚ï¼š**
- ç”¨æˆ·æ‹–åŠ¨é¼ æ ‡æ—¶ï¼Œå®æ—¶è®¡ç®—æœ€è¿‘çš„åˆæ³•æ–¹å‘
- æ˜¾ç¤ºè™šçº¿é¢„è§ˆï¼ˆé”å®šåçš„ä½ç½®ï¼‰
- ä¸å…è®¸ç”¨æˆ·ç”»å‡ºéæ ‡å‡†è§’åº¦

**å®ç°ï¼š**
```typescript
handleMouseMove(e: MouseEvent): void {
  if (!this.drawingState.isDrawing) return;
  
  // é”å®šåˆ°æ ‡å‡†æ–¹å‘
  const locked = lockToDirection(
    this.drawingState.startNode!.x,
    this.drawingState.startNode!.y,
    e.offsetX,
    e.offsetY
  );
  
  // æ›´æ–°ä¸´æ—¶ç»ˆç‚¹ï¼ˆä½¿ç”¨é”å®šåçš„ä½ç½®ï¼‰
  this.drawingState.tempEndX = locked.endX;
  this.drawingState.tempEndY = locked.endY;
  this.drawingState.tempDirection = locked.direction;
  
  this.render();
}
```

---

### 3. ç¦æ­¢ä»»ä½•éæ ‡å‡†è§’åº¦

**éªŒè¯æœºåˆ¶ï¼š**

```typescript
function createSegment(from: Node, to: Node): void {
  const dx = to.x - from.x;
  const dy = to.y - from.y;
  const angle = Math.atan2(dy, dx) * (180 / Math.PI);
  
  // éªŒè¯è§’åº¦
  const validAngles = [90, 30, 150, -30, -90, -150, 210, 330];
  const isValid = validAngles.some(validAngle => 
    Math.abs(angle - validAngle) < 1
  );
  
  if (!isValid) {
    throw new Error(`Invalid isometric angle: ${angle}Â°. Only 30Â° standard isometric angles are allowed.`);
  }
  
  // åˆ›å»ºçº¿æ®µ
  const segment: Segment = {
    id: generateId(),
    fromNodeId: from.id,
    toNodeId: to.id,
    type: this.state.currentTool as 'drain' | 'vent',
    diameter: this.state.currentDiameter as any,
    direction: this.drawingState.tempDirection!
  };
  
  this.state.data.segments.set(segment.id, segment);
  // ...
}
```

---

### 4. æ‰€æœ‰å¹³ç§»/æ‹‰ä¼¸æ“ä½œä¿æŒåŸè½´å‘ä¸å˜

**æ‹–åŠ¨èŠ‚ç‚¹æ—¶ï¼š**

```typescript
function dragNode(node: Node, newX: number, newY: number): void {
  // å¯¹äºæ¯ä¸ªè¿æ¥çš„çº¿æ®µï¼Œä¿æŒå…¶åŸå§‹æ–¹å‘
  for (const edgeId of node.connectedEdges) {
    const segment = this.state.data.segments.get(edgeId)!;
    
    // ç¡®å®šè¿™ä¸ªèŠ‚ç‚¹æ˜¯èµ·ç‚¹è¿˜æ˜¯ç»ˆç‚¹
    const isStartNode = segment.fromNodeId === node.id;
    const otherNode = isStartNode
      ? this.state.data.nodes.get(segment.toNodeId)!
      : this.state.data.nodes.get(segment.fromNodeId)!;
    
    // æ ¹æ®åŸå§‹æ–¹å‘ï¼Œè°ƒæ•´å¦ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®
    // ä¿æŒçº¿æ®µçš„æ–¹å‘ä¸å˜
    if (segment.direction === 'vertical') {
      // å‚ç›´çº¿æ®µï¼šåªèƒ½æ”¹å˜ Y åæ ‡
      if (isStartNode) {
        // ç§»åŠ¨èµ·ç‚¹ï¼šç»ˆç‚¹çš„ X ä¸å˜
        otherNode.x = node.x;
      } else {
        // ç§»åŠ¨ç»ˆç‚¹ï¼šèµ·ç‚¹çš„ X ä¸å˜
        otherNode.x = node.x;
      }
    } else if (segment.direction === 'iso-right') {
      // 30Â° çº¿æ®µï¼šä¿æŒ 30Â° è§’åº¦
      const dx = isStartNode ? (otherNode.x - newX) : (newX - otherNode.x);
      const dy = dx * Math.tan(30 * Math.PI / 180);
      
      if (isStartNode) {
        otherNode.y = newY + dy;
      } else {
        otherNode.y = newY - dy;
      }
    } else if (segment.direction === 'iso-left') {
      // 150Â° çº¿æ®µï¼šä¿æŒ 150Â° è§’åº¦
      const dx = isStartNode ? (otherNode.x - newX) : (newX - otherNode.x);
      const dy = dx * Math.tan(150 * Math.PI / 180);
      
      if (isStartNode) {
        otherNode.y = newY + dy;
      } else {
        otherNode.y = newY - dy;
      }
    }
  }
  
  // æ›´æ–°èŠ‚ç‚¹ä½ç½®
  node.x = newX;
  node.y = newY;
  
  this.render();
}
```

**è¿™ä¸ªå®ç°ç¡®ä¿ï¼š**
- æ‹–åŠ¨èŠ‚ç‚¹æ—¶ï¼Œè¿æ¥çš„çº¿æ®µä¿æŒåŸæ–¹å‘
- ä¸ä¼šå‡ºç°éæ ‡å‡†è§’åº¦
- ç®¡é“ç³»ç»Ÿçš„å‡ ä½•å…³ç³»ä¿æŒæ­£ç¡®

---

## ğŸ¨ è§†è§‰å‚è€ƒ

### æ ‡å‡† 30Â° Isometric è§†å›¾

```
        â†‘ Vertical (90Â°)
        |
        |
  â†–    |    â†—
150Â°   |   30Â°  (Isometric axes)
       |
       â€¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ 
    (èµ·ç‚¹)
```

**ä¸‰ä¸ªè½´ï¼š**
```
1. Vertical: æ­£ä¸Š/æ­£ä¸‹ (90Â° / 270Â°)
2. ISO Right: å³ä¸Šæ–œ 30Â°
3. ISO Left: å·¦ä¸Šæ–œ 150Â°
```

---

## ğŸ“ å·¥ç¨‹æ ‡å‡†å‚è€ƒ

### ä¸ºä»€ä¹ˆ 30Â° æ˜¯æ ‡å‡†ï¼Ÿ

**å›½é™…æ ‡å‡†ï¼š**
- ISO 5456-3: Technical drawings - Projection methods - Axonometric representations
- ASME Y14.3: Multiview and Sectional View Drawings
- BS 308: Engineering drawing practice

**ç‰¹ç‚¹ï¼š**
- 120Â° ç­‰é—´è·ï¼ˆ360Â° / 3 = 120Â°ï¼‰
- å¯¹ç§°æ€§å¥½
- ç«‹ä½“æ„Ÿå¼º
- æ˜“äºæ‰‹ç»˜å’ŒCAD

**vs 45Â°ï¼š**
- 45Â° ä¸æ˜¯å·¥ç¨‹æ ‡å‡†
- è§†è§‰æ•ˆæœä¸å¦‚ 30Â°
- Inspector ä¸è®¤å¯

---

## âœ… æ›´æ–°åçš„éªŒæ”¶æ ‡å‡†

### IsoSnap ç»˜åˆ¶é€»è¾‘éªŒæ”¶

**å¿…é¡»é€šè¿‡ï¼š**

1. **è§’åº¦éªŒè¯**
   ```typescript
   æµ‹è¯•ç”¨ä¾‹ï¼š
   - ç”»ä¸€æ¡ vertical çº¿ â†’ è§’åº¦å¿…é¡»æ˜¯ 90Â° Â±1Â°
   - ç”»ä¸€æ¡ ISO right çº¿ â†’ è§’åº¦å¿…é¡»æ˜¯ 30Â° Â±1Â°
   - ç”»ä¸€æ¡ ISO left çº¿ â†’ è§’åº¦å¿…é¡»æ˜¯ 150Â° Â±1Â°
   - ä»»ä½•å…¶ä»–è§’åº¦ â†’ è‡ªåŠ¨ä¿®æ­£åˆ°æœ€è¿‘çš„æ ‡å‡†è§’åº¦
   ```

2. **æ‹–åŠ¨ä¿æŒæ–¹å‘**
   ```typescript
   æµ‹è¯•ç”¨ä¾‹ï¼š
   - ç”»ä¸€æ¡ 30Â° çš„çº¿
   - æ‹–åŠ¨å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹
   - éªŒè¯ï¼šçº¿æ®µä»ç„¶æ˜¯ 30Â°ï¼ˆè¯¯å·® < 1Â°ï¼‰
   ```

3. **æ— éæ ‡å‡†è§’åº¦**
   ```typescript
   æµ‹è¯•ç”¨ä¾‹ï¼š
   - åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨è§’åº¦éªŒè¯
   - ç”»å¤šæ¡çº¿æ®µ
   - éªŒè¯ï¼šconsole æ—  warning
   ```

---

## ğŸš¨ ç»™ CTO çš„æé†’

### è¿™æ˜¯å…³é”®çš„äº§å“å†³ç­–

**ä¸æ˜¯æŠ€æœ¯é€‰æ‹©ï¼Œæ˜¯äº§å“å®šä½ï¼š**

```
IsoSnap æ˜¯"ä¸“ä¸šå·¥å…·"
â†’ å¿…é¡»ç¬¦åˆå·¥ç¨‹æ ‡å‡†
â†’ å¿…é¡»æ˜¯ 30Â° isometric
â†’ Inspector æ‰ä¼šè®¤å¯
```

**å¦‚æœç”¨ 45Â°ï¼š**
```
â†’ çœ‹èµ·æ¥åƒ"ç©å…·"
â†’ Inspector ä¼šè´¨ç–‘ä¸“ä¸šæ€§
â†’ äº§å“ä»·å€¼å¤§æ‰“æŠ˜æ‰£
```

---

## ğŸ“‹ ä¿®æ­£åçš„ Task B2

### Task B2: ç»˜åˆ¶é€»è¾‘ï¼ˆ2å¤©ï¼‰

**ä¿®æ­£å†…å®¹ï¼š**

1. **ä¸‰æ–¹å‘é”å®šç®—æ³•**
   - âŒ ~~45Â° left-down å’Œ right-down~~
   - âœ… 30Â° ISO left (150Â°) å’Œ ISO right (30Â°)
   - âœ… Vertical (90Â°)

2. **lockToDirection å‡½æ•°**
   - ä½¿ç”¨ä¸Šé¢æä¾›çš„æ­£ç¡®å®ç°
   - æµ‹è¯•æ‰€æœ‰è§’åº¦éƒ½æ­£ç¡®

3. **æ•°æ®æ¨¡å‹**
   - direction: 'vertical' | 'iso-left' | 'iso-right'

4. **éªŒè¯æœºåˆ¶**
   - å¼€å‘æ¨¡å¼ä¸‹éªŒè¯æ‰€æœ‰çº¿æ®µè§’åº¦
   - ç¦æ­¢åˆ›å»ºéæ ‡å‡†è§’åº¦çš„çº¿æ®µ

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] ç”»çº¿æ—¶åªèƒ½ç”» 3 ç§æ ‡å‡†è§’åº¦ï¼ˆ90Â°, 30Â°, 150Â°ï¼‰
- [ ] æ‹–åŠ¨æ—¶è‡ªåŠ¨å¸é™„åˆ°æœ€è¿‘çš„æ ‡å‡†æ–¹å‘
- [ ] è™šçº¿é¢„è§ˆæ˜¾ç¤ºé”å®šåçš„ä½ç½®
- [ ] æ‰€æœ‰çº¿æ®µéƒ½æ˜¯æ ‡å‡† 30Â° isometric

---

## ğŸ“ ç›¸å…³æ–‡ä»¶éœ€è¦æ›´æ–°

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

1. **Sprint 1 æŠ€æœ¯ä»»åŠ¡æ¸…å•**
   - Task B2 çš„å®ç°ä»£ç 
   - éªŒæ”¶æ ‡å‡†

2. **æ•°æ®æ¨¡å‹å®šä¹‰**
   ```typescript
   // /packages/iso-snap/src/types/index.ts
   direction: 'vertical' | 'iso-left' | 'iso-right'
   ```

3. **å·¥å…·å‡½æ•°**
   ```typescript
   // /packages/iso-snap/src/utils/directionLock.ts
   // å®Œæ•´æ›¿æ¢ä¸ºä¸Šé¢æä¾›çš„ä»£ç 
   ```

4. **æ¸²æŸ“é€»è¾‘**
   ```typescript
   // /packages/iso-snap/src/canvas/IsoCanvas.ts
   // ä½¿ç”¨æ­£ç¡®çš„è§’åº¦è®¡ç®—
   ```

---

## ğŸ’¡ å®ç°å»ºè®®

### æ¨èå®ç°é¡ºåº

**Day 1: æ ¸å¿ƒç®—æ³•**
1. å®ç° lockToDirectionï¼ˆ30Â° ç‰ˆæœ¬ï¼‰
2. å†™å•å…ƒæµ‹è¯•éªŒè¯è§’åº¦
3. åœ¨ç®€å• demo é‡Œæµ‹è¯•

**Day 2: é›†æˆåˆ°ç”»å¸ƒ**
1. æ›´æ–° handleMouseMove
2. æ›´æ–°è™šçº¿é¢„è§ˆ
3. æ›´æ–°åˆ›å»ºçº¿æ®µé€»è¾‘
4. å…¨é¢æµ‹è¯•

---

## âœ… æœ€ç»ˆéªŒæ”¶ï¼ˆ30Â° æ ‡å‡†ï¼‰

### è§†è§‰æµ‹è¯•

```
ç”»ä¸€ä¸ªç®€å•çš„ bathroom groupï¼š
1. Vertical vent (åº”è¯¥å®Œå…¨å‚ç›´)
2. ISO right drain (åº”è¯¥æ˜¯ 30Â° å³ä¸Š)
3. ISO left drain (åº”è¯¥æ˜¯ 150Â° å·¦ä¸Š)

ç”¨é‡è§’å™¨æµ‹é‡å¯¼å‡ºçš„ PDFï¼š
â†’ æ‰€æœ‰è§’åº¦éƒ½åº”è¯¥ç²¾ç¡®æ˜¯ 30Â° / 90Â° / 150Â°
```

---

**ç‰ˆæœ¬ï¼š** v1.1ï¼ˆä¿®æ­£ç‰ˆï¼‰  
**ä¿®æ­£æ—¶é—´ï¼š** 2026-02-02  
**çŠ¶æ€ï¼š** âœ… å·²ä¿®æ­£ï¼Œå¾…å®æ–½  
**å½±å“ï¼š** Task B2 ç»˜åˆ¶é€»è¾‘

---

**CTOï¼Œè¿™æ˜¯ä¸€ä¸ªå…³é”®çš„ä¿®æ­£ï¼30Â° isometric æ˜¯å·¥ç¨‹æ ‡å‡†ï¼Œè¿™å†³å®šäº† IsoSnap çš„ä¸“ä¸šæ€§ã€‚è¯·åœ¨å¼€å‘ Task B2 å‰ä»”ç»†é˜…è¯»è¿™ä»½æ–‡æ¡£ï¼Œå¹¶ä½¿ç”¨æä¾›çš„æ­£ç¡®ä»£ç å®ç°ã€‚** ğŸ¯
