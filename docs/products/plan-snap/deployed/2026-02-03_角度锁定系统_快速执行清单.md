# è§’åº¦é”å®šç³»ç»Ÿ - å¿«é€Ÿæ‰§è¡Œæ¸…å•

> **CTO 5åˆ†é’Ÿé€ŸæŸ¥å¡**  
> **é¢„è®¡å·¥ä½œé‡ï¼š** 4å¤©  
> **ä¼˜å…ˆçº§ï¼š** ğŸ”´ P0 - Critical

---

## âš¡ ä¸€å¥è¯éœ€æ±‚

**è§£å†³é—®é¢˜ï¼š** ç”¨æˆ·ç”»"ç«–çº¿"å®é™…æ˜¯89Â°/91Â°ï¼Œä¸“ä¸šç”»å›¾é›¶å®¹å¿  
**è§£å†³æ–¹æ¡ˆï¼š** æ™ºèƒ½è§’åº¦å¸é™„ï¼Œé»˜è®¤å°±å¥½ç”¨ï¼Œä¸ç”¨ç‚¹èœå•

---

## ğŸ¯ æ ¸å¿ƒè¦æ±‚ï¼ˆå¿…é¡»è®°ä½ï¼‰

### é»˜è®¤è§’åº¦é›†ï¼ˆarchitecturalï¼‰
```
0Â° / 30Â° / 45Â° / 60Â° / 90Â°
å®¹å·®ï¼šÂ±3Â°
22.5Â° ä¸é»˜è®¤ï¼ˆä»… Advanced æ¨¡å¼ï¼‰
```

### ä¼˜å…ˆçº§é¡ºåºï¼ˆé“å¾‹ï¼‰
```
Typed Length
  â†“
Explicit Angle Lock (Aé”®)
  â†“
Inference (parallel/perpendicular)
  â†“
Smart Angle Snap (30/45/60/90)
  â†“
Shift Ortho
  â†“
Free Angle
```

### å…³é”®è§„åˆ™
```
âœ… Angle Snap ä¼˜å…ˆäº Grid
âœ… Grid æ°¸è¿œä¸å†³å®šè§’åº¦
âœ… è§’åº¦è¢«é”å¿…é¡»å‘Šè¯‰ç”¨æˆ·ï¼ˆUIåé¦ˆï¼‰
âŒ 22.5Â° ä¸é»˜è®¤å¯ç”¨
```

---

## ğŸ”§ æ ¸å¿ƒä»£ç ï¼ˆCopy & Pasteï¼‰

### 1. è§’åº¦å¸é™„å‡½æ•°

```typescript
function snapAngle(
  theta: number, 
  toleranceDeg: number = 3
): { snappedAngle: number | null; distance: number } {
  const tol = toleranceDeg * Math.PI / 180
  let bestAngle: number | null = null
  let minDistance = Infinity

  const SNAP_ANGLES_RAD = [
    0, Math.PI/6, Math.PI/4, Math.PI/3, Math.PI/2,
    2*Math.PI/3, 3*Math.PI/4, 5*Math.PI/6, Math.PI, 3*Math.PI/2
  ]

  for (const snapAngle of SNAP_ANGLES_RAD) {
    const d = Math.min(
      Math.abs(theta - snapAngle),
      Math.abs(theta - snapAngle + 2 * Math.PI),
      Math.abs(theta - snapAngle - 2 * Math.PI)
    )
    
    if (d < minDistance && d <= tol) {
      minDistance = d
      bestAngle = snapAngle
    }
  }

  return { snappedAngle: bestAngle, distance: minDistance }
}
```

### 2. åº”ç”¨è§’åº¦é”å®š

```typescript
function applyAngleSnap(
  start: Vec2, 
  end: Vec2, 
  options: {
    shiftPressed: boolean
    currentAngleLock?: number
    tolerance?: number
  }
): Vec2 {
  const v = { x: end.x - start.x, y: end.y - start.y }
  const len = Math.sqrt(v.x * v.x + v.y * v.y)
  const angle = Math.atan2(v.y, v.x)
  
  let finalAngle = angle
  
  // Shift å¼ºåˆ¶æ­£äº¤
  if (options.shiftPressed) {
    const angles = [0, Math.PI/2, Math.PI, 3*Math.PI/2]
    const closest = angles.reduce((prev, curr) => 
      Math.abs(curr - angle) < Math.abs(prev - angle) ? curr : prev
    )
    finalAngle = closest
  }
  // æ˜¾å¼è§’åº¦é”å®š
  else if (options.currentAngleLock !== undefined) {
    finalAngle = options.currentAngleLock
  }
  // æ™ºèƒ½å¸é™„
  else {
    const { snappedAngle } = snapAngle(angle, options.tolerance ?? 3)
    if (snappedAngle !== null) {
      finalAngle = snappedAngle
    }
  }
  
  return {
    x: start.x + len * Math.cos(finalAngle),
    y: start.y + len * Math.sin(finalAngle)
  }
}
```

### 3. è§’åº¦é›†é…ç½®

```typescript
const ANGLE_SETS = {
  basic: { angles: [0, 90] },
  standard: { angles: [0, 45, 90] },
  architectural: { angles: [0, 30, 45, 60, 90] },  // é»˜è®¤
  advanced: { angles: [0, 22.5, 30, 45, 60, 90] }
}
```

---

## ğŸ“‹ 4å¤©è®¡åˆ’

### Day 1: æ ¸å¿ƒå‡ ä½•
- [ ] `snapAngle()` å‡½æ•°
- [ ] `applyAngleSnap()` å‡½æ•°
- [ ] 10ä¸ªå•å…ƒæµ‹è¯•

### Day 2: è§’åº¦é›† + UIåé¦ˆ
- [ ] è§’åº¦é›†é…ç½®ç³»ç»Ÿ
- [ ] è§’åº¦æ–‡å­—æç¤ºç»„ä»¶
- [ ] çŠ¶æ€æ é›†æˆ

### Day 3: é›†æˆ
- [ ] ä¸ Inference Engine é›†æˆ
- [ ] ä¸ Typed Length é›†æˆ
- [ ] Shift æ­£äº¤æ¨¡å¼

### Day 4: æµ‹è¯• + ä¼˜åŒ–
- [ ] è¾¹ç•Œæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ< 1msï¼‰
- [ ] CPO éªŒæ”¶

---

## âœ… éªŒæ”¶æ ‡å‡†ï¼ˆ3ä¸ªåœºæ™¯ï¼‰

### åœºæ™¯ 1: ç”»ç«–çº¿
```
æ“ä½œï¼šä» (0,0) æ‹‰åˆ° (100, 2)
æœŸæœ›ï¼šè‡ªåŠ¨å¸é™„åˆ° (100, 0)ï¼Œæ˜¾ç¤º "â†’ 0Â°"
```

### åœºæ™¯ 2: Shift æ­£äº¤
```
æ“ä½œï¼šæŒ‰ä½ Shiftï¼Œæ‹‰ä»»æ„æ–¹å‘
æœŸæœ›ï¼šåªèƒ½ç”»æ°´å¹³æˆ–å‚ç›´
```

### åœºæ™¯ 3: ä¸è¯¯å¸ 22.5Â°
```
æ“ä½œï¼šé»˜è®¤æ¨¡å¼ï¼Œæ‹‰ 22.5Â° å·¦å³çš„çº¿
æœŸæœ›ï¼šä¸å¸é™„ï¼ˆå› ä¸ºä¸åœ¨ architectural é›†åˆï¼‰
```

---

## ğŸš¨ å¸¸è§é™·é˜±

### âŒ é™·é˜± 1: è®© Grid å†³å®šè§’åº¦
```typescript
// é”™è¯¯
const snapped = snapToGrid(end)

// æ­£ç¡®
const angleSnapped = applyAngleSnap(start, end, options)
const final = snapToGrid(angleSnapped)  // Grid æ˜¯æœ€åä¸€æ­¥
```

### âŒ é™·é˜± 2: å¿˜è®°å‘¨æœŸæ€§
```typescript
// é”™è¯¯
const d = Math.abs(theta - snapAngle)

// æ­£ç¡®
const d = Math.min(
  Math.abs(theta - snapAngle),
  Math.abs(theta - snapAngle + 2*Math.PI),
  Math.abs(theta - snapAngle - 2*Math.PI)
)
```

### âŒ é™·é˜± 3: ä¼˜å…ˆçº§é”™è¯¯
```
å¿…é¡»æ˜¯ï¼š
Typed Length > Angle Lock > Inference > Angle Snap
è€Œä¸æ˜¯ï¼š
Angle Snap > Inference > Typed Length  // é”™è¯¯ï¼
```

---

## ğŸ’¬ CPO ä¸€å¥è¯

> "æˆ‘ä¸å¸Œæœ›ä»»ä½•çº¿åœ¨æ²¡æœ‰æ˜ç¡®æ„å›¾çš„æƒ…å†µä¸‹å‡ºç° 89Â° æˆ– 91Â°ã€‚é»˜è®¤å¿…é¡»å¸é™„åˆ° 30/45/60/90ï¼ŒShift å¼ºåˆ¶æ­£äº¤ã€‚"

---

## ğŸ“ æœ‰é—®é¢˜ï¼Ÿ

- ä¼˜å…ˆçº§é—®é¢˜ â†’ çœ‹å®Œæ•´æ–‡æ¡£ç¬¬äºŒèŠ‚
- å®ç°ç»†èŠ‚ â†’ çœ‹å®Œæ•´æ–‡æ¡£ç¬¬ä¸‰èŠ‚
- æµ‹è¯•ç”¨ä¾‹ â†’ çœ‹å®Œæ•´æ–‡æ¡£ç¬¬å…­èŠ‚

---

**å¼€å§‹å¹²æ´»ï¼** ğŸš€

å®Œæ•´æ–‡æ¡£ï¼š`2026-02-03_æŠ€æœ¯æ–¹æ¡ˆ_è§’åº¦é”å®šç³»ç»Ÿ_CTOæ‰§è¡Œç‰ˆ.md`
