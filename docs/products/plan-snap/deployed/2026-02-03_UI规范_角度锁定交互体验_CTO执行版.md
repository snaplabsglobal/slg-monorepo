# PlanSnap è§’åº¦é”å®š UI/UX æŠ€æœ¯è§„èŒƒ

> **æ–‡æ¡£ç±»å‹ï¼š** UI/UXæŠ€æœ¯è§„èŒƒ - CTOæ‰§è¡Œç‰ˆ  
> **åˆ›å»ºæ—¥æœŸï¼š** 2026-02-03  
> **ä¼˜å…ˆçº§ï¼š** ğŸ”´ P0 - Criticalï¼ˆç”¨æˆ·ä½“éªŒæ ¸å¿ƒï¼‰  
> **é¢„è®¡å·¥ä½œé‡ï¼š** 1.5å¤©  
> **çŠ¶æ€ï¼š** â³ å¾…å¼€å§‹

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### é—®é¢˜æœ¬è´¨

**å½“å‰çŠ¶æ€ï¼š**
- è§’åº¦é”å®šç®—æ³•å·²ç»æ­£ç¡®
- ä½†ç”¨æˆ·"æ„Ÿè§‰ä¸åˆ°"è¢«é”å®š
- ç¼ºå°‘æ˜ç¡®çš„è§†è§‰å’Œäº¤äº’åé¦ˆ

**CPOæ˜ç¡®è¦æ±‚ï¼š**
> "ç®—æ³•å·²ç»é€šè¿‡ï¼Œç°åœ¨è¿™ä¸æ˜¯'æŠ€æœ¯é—®é¢˜'ï¼Œæ˜¯'ä¿¡ä»»æ„Ÿé—®é¢˜'ã€‚æˆ‘ä»¬éœ€è¦æŠŠ Angle Lock åšåˆ°åƒ SketchUp ä¸€æ ·è®©äººå®‰å¿ƒã€‚"

---

### è§£å†³æ–¹æ¡ˆæ ¸å¿ƒ

**ä¸‰ä¸ªå…³é”®è¦ç´ ï¼š**
1. **å…‰æ ‡é™„è¿‘è§’åº¦æç¤º** - ç”¨æˆ·ç¬¬ä¸€æ—¶é—´çœ‹åˆ°çš„åé¦ˆ
2. **çº¿æ¡é¢œè‰²å˜åŒ–** - è¢«æ§åˆ¶çš„çº¿çœ‹èµ·æ¥å°±ä¸ä¸€æ ·
3. **çŠ¶æ€æ æ–‡å­—** - ä¸“ä¸šç”¨æˆ·çš„å®‰å…¨æ„Ÿ

**è®¾è®¡åŸåˆ™ï¼ˆCPOè¦æ±‚ï¼‰ï¼š**
```
âœ… çŠ¶æ€å¿…é¡»"è¯´è¯" - ä¸é æ„Ÿè§‰ï¼Œä¸é æ•™ç¨‹
âœ… æ–‡å­— > å›¾æ ‡ - å›¾æ ‡å¯ä»¥æ²¡æœ‰ï¼Œä½†æ–‡å­—å¿…é¡»æœ‰
âœ… çŸ­ã€ç¡¬ã€å·¥ç¨‹æ„Ÿ - ä¸è¦è¥é”€æ–‡æ¡ˆï¼Œåªè¦å·¥ç¨‹è¯­è¨€
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. çŠ¶æ€å¿…é¡»å¯¹å¤–æš´éœ²

**å”¯ä¸€æƒå¨çŠ¶æ€ï¼š**
```typescript
type AngleMode = 
  | 'FREE'        // è‡ªç”±
  | 'SNAP'        // æ™ºèƒ½å¸é™„ï¼ˆ30/45/60/90ï¼‰
  | 'SHIFT_ORTHO' // Shift å¼ºåˆ¶æ­£äº¤
  | 'LOCKED'      // æ˜¾å¼è§’åº¦é”å®šï¼ˆå¦‚ 30Â°ï¼‰
```

**å…³é”®è§„åˆ™ï¼š**
```
âš ï¸ UIã€Cursorã€Overlayã€Hint å…¨éƒ¨åªçœ‹è¿™ä¸ªçŠ¶æ€
âŒ ä¸å…è®¸"ç®—æ³•ä¸€ä¸ªçŠ¶æ€ï¼ŒUI è‡ªå·±çŒœ"
```

---

### 2. æ˜ç¡®ã€éœ¸é“ã€ä¸å¯å¿½è§†

**è®¾è®¡ç›®æ ‡ï¼š**
- 0.5ç§’å†…è®©ç”¨æˆ·"çœ‹æ‡‚ + ç›¸ä¿¡"çº¿æ¡è¢«é”ä½
- å½•å±ç»™åˆ«äººçœ‹ï¼Œç«‹åˆ»æ˜ç™½å‘ç”Ÿäº†ä»€ä¹ˆ
- ä¸éœ€è¦æ•™ç¨‹å°±èƒ½ç†è§£å½“å‰çŠ¶æ€

---

## ğŸ¨ UIç»„ä»¶è§„èŒƒ

### ä¸€ã€å…‰æ ‡é™„è¿‘è§’åº¦æç¤ºï¼ˆæœ€é‡è¦ï¼‰â­â­â­

#### æ˜¾ç¤ºè§„åˆ™

**è§¦å‘æ¡ä»¶ï¼š**
```
å½“ AngleMode !== FREE æ—¶æ˜¾ç¤º
```

**ä½ç½®ï¼š**
- è·Ÿéšé¼ æ ‡
- è·ç¦»é¼ æ ‡ 12-16px
- ä¸é®æŒ¡çº¿æ¡

---

#### æ–‡æ¡ˆè§„èŒƒï¼ˆå¿…é¡»åŸæ ·ï¼‰

**1. è‡ªç”±æ€ï¼ˆFREEï¼‰**
```
ä¸æ˜¾ç¤ºä»»ä½•è§’åº¦æç¤º
```

**ç†ç”±ï¼š** è‡ªç”±å°±æ˜¯è‡ªç”±ï¼Œä¸åµç”¨æˆ·

---

**2. Smart Snapï¼ˆæ™ºèƒ½å¸é™„ï¼‰**
```
45Â°
90Â°
30Â°
```

**æ ·å¼ï¼š**
- å­—ä½“ï¼šSemi-bold
- é¢œè‰²ï¼š`#2A7FFF`ï¼ˆå·¥ç¨‹è“ï¼‰
- å¤§å°ï¼šæ™®é€šæ ‡æ³¨çš„ 1.2Ã—
- ä¸åŠ å¤šä½™æ–‡å­—

**ç†ç”±ï¼š** è®©ç”¨æˆ·è‡ªå·±ç†è§£"è¿™æ˜¯å¸ä½äº†"

---

**3. Shift æ­£äº¤ï¼ˆORTHOï¼‰**
```
ORTHO 90Â°
ORTHO 0Â°
```

**æ ·å¼ï¼š**
- å­—ä½“ï¼šBold
- é¢œè‰²ï¼š`#1F5EFF`ï¼ˆæ›´æ·±çš„è“ï¼‰
- å¯åŠ å°é”å›¾æ ‡ï¼ˆå¯é€‰ï¼‰

**å…³é”®ï¼š** "ORTHO" æ˜¯å·¥ç¨‹è½¯ä»¶çš„æƒå¨è¯

---

**4. æ˜¾å¼è§’åº¦é”å®šï¼ˆLOCKEDï¼‰**
```
LOCKED 30Â°
LOCKED 45Â°
```

**æ ·å¼ï¼š**
- å­—ä½“ï¼šBold
- é¢œè‰²ï¼š`#0B5ED7`ï¼ˆæœ€æ·±ï¼‰
- å¯è½»å¾®åŠ ç²—èƒŒæ™¯ï¼ˆ10-15% é€æ˜ï¼‰

**å…³é”®ï¼š** å¿…é¡»å‡ºç° "LOCKED" å­—æ ·ï¼Œä¸å…è®¸åªæ˜¾ç¤ºè§’åº¦

---

#### å®Œæ•´æ–‡æ¡ˆæ±‡æ€»è¡¨

| çŠ¶æ€ | æ˜¾ç¤ºæ–‡æ¡ˆ | å­—ä½“ | é¢œè‰² | å¤‡æ³¨ |
|------|---------|------|------|------|
| FREE | ï¼ˆæ— ï¼‰ | - | - | ä¸æ˜¾ç¤º |
| SNAP | `45Â°` | Semi-bold | `#2A7FFF` | ç®€æ´ |
| SHIFT_ORTHO | `ORTHO 90Â°` | Bold | `#1F5EFF` | å¿…é¡»æœ‰ORTHO |
| LOCKED | `LOCKED 30Â°` | Bold | `#0B5ED7` | å¿…é¡»æœ‰LOCKED |

---

### äºŒã€çº¿æ¡è§†è§‰åé¦ˆï¼ˆä½æˆæœ¬é«˜æ”¶ç›Šï¼‰

#### é¢œè‰²è§„åˆ™

| çŠ¶æ€ | çº¿æ¡è¡¨ç° | è¯´æ˜ |
|------|---------|------|
| FREE | é»˜è®¤çº¿è‰² | æ™®é€šé»‘è‰²æˆ–æ·±ç° |
| SNAP | æµ…è“ | `#4A9EFF` |
| SHIFT_ORTHO | æ·±è“ | `#2A7FFF` |
| LOCKED | æ·±è“ + åŠ ç²—10-15% | `#1F5EFF` + `lineWidth * 1.15` |

---

#### ç”¨æˆ·è§†è§‰æ¡ä»¶åå°„

**è®¾è®¡æ„å›¾ï¼š**
```
è“è‰²çº¿ = è¢«æ§åˆ¶çš„çº¿
ç”¨æˆ·ä¼šç«‹åˆ»å½¢æˆè‚Œè‚‰è®°å¿†
```

**å®ç°è¦ç‚¹ï¼š**
- Previewçº¿å’ŒCommittedçº¿éƒ½åº”ç”¨ç›¸åŒè§„åˆ™
- é¢œè‰²å˜åŒ–è¦å³æ—¶ï¼ˆæ¯æ¬¡pointer-moveï¼‰
- ä¸éœ€è¦åŠ¨ç”»ï¼Œç›´æ¥åˆ‡æ¢

---

### ä¸‰ã€Shift çš„"æƒå¨æ„Ÿ"ï¼ˆå¿…é¡»ï¼‰

#### ShiftæŒ‰ä¸‹ç¬é—´çš„3ä»¶äº‹

**1. æ˜¾ç¤ºåå­—è½´ï¼ˆå¯é€‰ï¼‰**
```
åœ¨å±å¹•ä¸­å¿ƒæˆ–å…‰æ ‡ä½ç½®æ˜¾ç¤ºåå­—è½´ï¼ˆ+ï¼‰
```

**2. Toastæç¤ºï¼ˆå¿…é¡»ï¼‰**
```
ORTHO MODE
```

**æ ·å¼ï¼š**
- å±…ä¸­æˆ–å…‰æ ‡é™„è¿‘
- å°å·ã€å¤§å†™
- 0.8ç§’è‡ªåŠ¨æ·¡å‡º

**3. å…‰æ ‡è§’åº¦é™åˆ¶**
```
å…‰æ ‡é™„è¿‘è§’åº¦åªå¯èƒ½æ˜¯ï¼š
  ORTHO 0Â°
  ORTHO 90Â°
```

---

#### ShiftæœŸé—´çš„ç¡¬æ€§è§„åˆ™

```
âœ… Shift = ç”¨æˆ·è¯´äº†ç®—
âŒ ç¦æ­¢ Smart Snap
âŒ ç¦æ­¢ 30/45/60
âŒ ç¦æ­¢ grid æ‰­è§’
```

**ç†ç”±ï¼š** è¿™æ˜¯CADçš„åŸºæœ¬å°Šé‡

---

### å››ã€Smart Snapçš„"ç²˜æ€§"ï¼ˆHysteresisï¼‰

#### é—®é¢˜

**å½“å‰ï¼š** é¼ æ ‡è½»å¾®æ™ƒåŠ¨ï¼Œè§’åº¦æ¥å›è·³  
**ç›®æ ‡ï¼š** ä¸€æ—¦å¸ä½ï¼Œä¸è½»æ˜“æ”¾æ‰‹

---

#### è§„åˆ™ï¼ˆæ•°å€¼å»ºè®®ï¼‰

```
è¿›å…¥ snapï¼šÂ±3Â°
è„±ç¦» snapï¼šÂ±6Â°
```

**ä¹Ÿå°±æ˜¯è¯´ï¼š**
- åŸå§‹è§’åº¦åœ¨ 87Â°-93Â° æ—¶ â†’ å¸é™„åˆ° 90Â°
- å¸é™„åï¼Œå¿…é¡»åç¦»åˆ° 84Â° æˆ– 96Â° æ‰é‡Šæ”¾

---

#### UIè¡¨ç°

**å¸é™„ç¬é—´ï¼š**
```
è§’åº¦æ–‡æœ¬è½»å¾®é—ªä¸€ä¸‹
opacity: 0.6 â†’ 1.0
æˆ– scale: 1.0 â†’ 1.05 â†’ 1.0 (80ms)
```

**è„±ç¦»ç¬é—´ï¼š**
```
è§’åº¦æ–‡æœ¬ç›´æ¥æ¶ˆå¤±
ä¸éœ€è¦åŠ¨ç”»
```

**ç”¨æˆ·æ„ŸçŸ¥ï¼š**
```
"å®ƒæŠ“ä½æˆ‘äº†"ï¼ˆè¿›å…¥ï¼‰
"ç°åœ¨æ”¾å¼€äº†"ï¼ˆè„±ç¦»ï¼‰
```

---

### äº”ã€çŠ¶æ€æ æ–‡å­—ï¼ˆå¯é€‰ä½†æ¨èï¼‰

#### ä½ç½®

åº•éƒ¨çŠ¶æ€æ ï¼Œä½è°ƒä½†å¯é 

---

#### æ–‡æ¡ˆè§„èŒƒ

| çŠ¶æ€ | çŠ¶æ€æ æ–‡å­— |
|------|-----------|
| FREE | `Angle: Free` |
| SNAP | `Angle: Snap 45Â°` |
| SHIFT_ORTHO | `Angle: Ortho` |
| LOCKED | `Angle: Locked 30Â°` |

---

#### ç”¨é€”

ä¸“ä¸šç”¨æˆ·æœ€çˆ±çœ‹çš„åœ°æ–¹ï¼Œæä¾›æŒç»­çš„çŠ¶æ€ç¡®è®¤

---

### å…­ã€é”™è¯¯/å†²çªæç¤ºï¼ˆå¯é€‰ä½†é«˜çº§ï¼‰

#### åœºæ™¯

å½“ç”¨æˆ·ï¼š
1. å·²ç»é”å®š30Â°
2. åˆå°è¯•æŒ‰Shift

---

#### æç¤º

**çŸ­æç¤ºï¼ˆ0.6ç§’ï¼‰ï¼š**
```
Angle Locked
```

**å…³é”®ï¼š**
- ä¸æŠ¥é”™
- ä¸å¼¹çª—
- åªå‘ŠçŸ¥çŠ¶æ€

---

## ğŸ—ï¸ æŠ€æœ¯å®ç°

### ä¸€ã€çŠ¶æ€æšä¸¾å®šä¹‰

```typescript
// angle/angle-mode.ts

/**
 * è§’åº¦æ¨¡å¼ - UIçš„å”¯ä¸€æƒå¨çŠ¶æ€æ¥æº
 */
export type AngleMode = 
  | 'FREE'        // è‡ªç”±ç»˜åˆ¶
  | 'SNAP'        // æ™ºèƒ½å¸é™„ï¼ˆ30/45/60/90ï¼‰
  | 'SHIFT_ORTHO' // Shift å¼ºåˆ¶æ­£äº¤
  | 'LOCKED'      // æ˜¾å¼è§’åº¦é”å®š

/**
 * è§’åº¦æ¥æº - ç”¨äºdebugå’Œæ—¥å¿—
 */
export type AngleSource =
  | 'none'    // æ— çº¦æŸ
  | 'smart'   // smart angle snap
  | 'shift'   // shift ortho
  | 'lock'    // explicit lock
  | 'typed'   // typed length (doesn't imply angle mode)
  | 'infer'   // parallel/perp etc (future)
```

---

### äºŒã€HUDè¾“å‡ºæ¨¡å‹

```typescript
// angle/hud-model.ts

import type { AngleMode, AngleSource } from './angle-mode'

/**
 * è§’åº¦HUDæ•°æ®æ¨¡å‹
 * 
 * è¿™æ˜¯UIå±‚éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯çš„å”¯ä¸€æ¥æº
 * UIç»„ä»¶ä¸åº”è¯¥è‡ªå·±æ¨æ–­çŠ¶æ€
 */
export interface AngleHUDModel {
  // æ ¸å¿ƒçŠ¶æ€
  mode: AngleMode
  source: AngleSource
  snappedDeg: number | null     // é”å®šè§’åº¦ï¼Œnullè¡¨ç¤ºFREE
  
  // UIæ–‡æ¡ˆ
  textNearCursor: string | null // "45Â°" | "ORTHO 90Â°" | "LOCKED 30Â°" | null
  statusBarText: string         // "Angle: Free" | "Angle: Snap 45Â°"...
  
  // è§†è§‰æ ·å¼token
  styleToken: 'free' | 'snap' | 'ortho' | 'locked'
  
  // ä¸´æ—¶Toastï¼ˆä¾‹å¦‚"ORTHO MODE"ï¼Œ0.8ç§’ï¼‰
  toast?: { 
    text: string
    ttlMs: number 
  } | null
}
```

---

### ä¸‰ã€HUDæ´¾ç”Ÿå‡½æ•°ï¼ˆæ–‡æ¡ˆæ˜ å°„ï¼‰

```typescript
// angle/derive-hud.ts

import type { AngleHUDModel } from './hud-model'
import type { AngleMode, AngleSource } from './angle-mode'

/**
 * å¼•æ“è§’åº¦ä¿¡æ¯ï¼ˆä»inferDrawè¿”å›ï¼‰
 */
interface EngineAngleInfo {
  mode: 'free' | 'snap' | 'shift' | 'lock'
  angleDeg?: number
  isSnapped?: boolean
}

/**
 * åœ†æ•´è§’åº¦åˆ°æ•´æ•°ï¼ˆHUDæ˜¾ç¤ºæ›´"ç¡¬"ï¼‰
 */
function roundDeg(d: number): number {
  return Math.round(d)
}

/**
 * ä»å¼•æ“è§’åº¦ä¿¡æ¯æ´¾ç”ŸHUDæ¨¡å‹
 * 
 * è¿™æ˜¯æ–‡æ¡ˆæ˜ å°„çš„å”¯ä¸€å‡ºå£
 * ä»¥åæ”¹æ–‡æ¡ˆ/è§„åˆ™ï¼Œåªæ”¹è¿™ä¸ªå‡½æ•°
 * 
 * @param angleInfo - å¼•æ“è¿”å›çš„è§’åº¦ä¿¡æ¯
 * @param opts - å¯é€‰å‚æ•°ï¼ˆå¦‚ShiftåˆšæŒ‰ä¸‹ï¼‰
 * @returns HUDæ•°æ®æ¨¡å‹
 */
export function deriveAngleHUD(
  angleInfo: EngineAngleInfo | undefined,
  opts?: { 
    justPressedShift?: boolean
    justLocked?: boolean 
  }
): AngleHUDModel {
  // 1. ç¡®å®šAngleMode
  const mode: AngleMode =
    angleInfo?.mode === 'shift' ? 'SHIFT_ORTHO' :
    angleInfo?.mode === 'lock'  ? 'LOCKED' :
    angleInfo?.mode === 'snap'  ? 'SNAP' :
    'FREE'

  // 2. æå–é”å®šè§’åº¦
  const snappedDeg =
    mode === 'FREE' ? null :
    angleInfo?.angleDeg != null ? roundDeg(angleInfo.angleDeg) : null

  // 3. ç”Ÿæˆå…‰æ ‡é™„è¿‘æ–‡æ¡ˆ
  const textNearCursor =
    mode === 'FREE' ? null :
    mode === 'SHIFT_ORTHO' ? `ORTHO ${snappedDeg ?? ''}Â°`.trim() :
    mode === 'LOCKED' ? `LOCKED ${snappedDeg ?? ''}Â°`.trim() :
    `${snappedDeg ?? ''}Â°`.trim()  // SNAPæ¨¡å¼

  // 4. ç”ŸæˆçŠ¶æ€æ æ–‡æ¡ˆ
  const statusBarText =
    mode === 'FREE' ? 'Angle: Free' :
    mode === 'SHIFT_ORTHO' ? 'Angle: Ortho' :
    mode === 'LOCKED' ? `Angle: Locked ${snappedDeg ?? ''}Â°`.trim() :
    `Angle: Snap ${snappedDeg ?? ''}Â°`.trim()

  // 5. ç¡®å®šæ ·å¼token
  const styleToken =
    mode === 'FREE' ? 'free' :
    mode === 'SNAP' ? 'snap' :
    mode === 'SHIFT_ORTHO' ? 'ortho' :
    'locked'

  // 6. Toastæç¤ºï¼ˆShiftåˆšæŒ‰ä¸‹æ—¶ï¼‰
  const toast =
    opts?.justPressedShift ? { text: 'ORTHO MODE', ttlMs: 800 } :
    null

  // 7. ç¡®å®šsource
  const source: AngleSource =
    mode === 'SHIFT_ORTHO' ? 'shift' :
    mode === 'LOCKED' ? 'lock' :
    mode === 'SNAP' ? 'smart' : 
    'none'

  return {
    mode,
    source,
    snappedDeg,
    textNearCursor,
    statusBarText,
    styleToken,
    toast,
  }
}
```

---

### å››ã€UIç»„ä»¶ç»“æ„

#### 1. AngleHUDç»„ä»¶ï¼ˆå…‰æ ‡æç¤º + Toastï¼‰

```typescript
// ui/AngleHUD.tsx

import React, { useEffect, useState } from 'react'
import type { AngleHUDModel } from '../angle/hud-model'

interface AngleHUDProps {
  hud: AngleHUDModel
  cursorScreen: { x: number; y: number } // å±å¹•åæ ‡
}

/**
 * è§’åº¦HUDç»„ä»¶
 * 
 * æ˜¾ç¤ºï¼š
 * 1. å…‰æ ‡é™„è¿‘çš„è§’åº¦æ–‡å­—
 * 2. Toastæç¤ºï¼ˆå¦‚"ORTHO MODE"ï¼‰
 */
export function AngleHUD(props: AngleHUDProps) {
  const { hud, cursorScreen } = props
  const [toastVisible, setToastVisible] = useState(false)

  // Toastè‡ªåŠ¨æ¶ˆå¤±
  useEffect(() => {
    if (hud.toast) {
      setToastVisible(true)
      const timer = setTimeout(() => {
        setToastVisible(false)
      }, hud.toast.ttlMs)
      return () => clearTimeout(timer)
    }
  }, [hud.toast])

  // ä¸æ˜¾ç¤ºè§’åº¦æ–‡å­—æ—¶è¿”å›null
  if (!hud.textNearCursor && !toastVisible) return null

  // æ–‡å­—ä½ç½®ï¼šé¼ æ ‡å³ä¸‹è§’ 14px
  const textLeft = cursorScreen.x + 14
  const textTop = cursorScreen.y + 14

  // Toastä½ç½®ï¼šé¼ æ ‡ä¸Šæ–¹
  const toastLeft = cursorScreen.x - 30
  const toastTop = cursorScreen.y - 40

  // æ ·å¼ç±»å
  const className =
    hud.styleToken === 'locked' ? 'angle-hud angle-hud-locked' :
    hud.styleToken === 'ortho'  ? 'angle-hud angle-hud-ortho' :
    hud.styleToken === 'snap'   ? 'angle-hud angle-hud-snap' :
    'angle-hud'

  return (
    <>
      {/* å…‰æ ‡é™„è¿‘è§’åº¦æ–‡å­— */}
      {hud.textNearCursor && (
        <div
          className={className}
          style={{
            position: 'fixed',
            left: textLeft,
            top: textTop,
            pointerEvents: 'none',
            userSelect: 'none',
            zIndex: 9999,
          }}
        >
          {hud.textNearCursor}
        </div>
      )}

      {/* Toastæç¤º */}
      {toastVisible && hud.toast && (
        <div
          className="angle-hud-toast"
          style={{
            position: 'fixed',
            left: toastLeft,
            top: toastTop,
            pointerEvents: 'none',
            userSelect: 'none',
            zIndex: 9999,
          }}
        >
          {hud.toast.text}
        </div>
      )}
    </>
  )
}
```

---

#### 2. StatusBarç»„ä»¶ï¼ˆåº•éƒ¨çŠ¶æ€æ ï¼‰

```typescript
// ui/StatusBar.tsx

import React from 'react'
import type { AngleHUDModel } from '../angle/hud-model'

interface StatusBarProps {
  hud: AngleHUDModel
}

/**
 * çŠ¶æ€æ ç»„ä»¶
 * 
 * æ˜¾ç¤ºå½“å‰è§’åº¦çŠ¶æ€
 */
export function StatusBar({ hud }: StatusBarProps) {
  return (
    <div className="statusbar">
      <span className="statusbar-item">{hud.statusBarText}</span>
    </div>
  )
}
```

---

#### 3. çº¿æ¡æ ·å¼å‡½æ•°

```typescript
// ui/stroke-style.ts

import type { AngleHUDModel } from '../angle/hud-model'

/**
 * çº¿æ¡æ ·å¼å®šä¹‰
 */
interface StrokeStyle {
  color: string
  width: number
}

/**
 * æ ¹æ®è§’åº¦çŠ¶æ€è·å–é¢„è§ˆçº¿æ¡æ ·å¼
 * 
 * @param hud - HUDæ•°æ®æ¨¡å‹
 * @param baseWidth - åŸºç¡€çº¿å®½
 * @returns çº¿æ¡æ ·å¼
 */
export function getPreviewStrokeStyle(
  hud: AngleHUDModel, 
  baseWidth: number = 1
): StrokeStyle {
  switch (hud.styleToken) {
    case 'locked':
      return { 
        color: '#1F5EFF',      // æ·±è“
        width: baseWidth * 1.15 // åŠ ç²—15%
      }
    
    case 'ortho':
      return { 
        color: '#2A7FFF',      // æ·±è“
        width: baseWidth 
      }
    
    case 'snap':
      return { 
        color: '#4A9EFF',      // æµ…è“
        width: baseWidth 
      }
    
    case 'free':
    default:
      return { 
        color: '#333333',      // é»˜è®¤æ·±ç°
        width: baseWidth 
      }
  }
}

/**
 * æ ¹æ®è§’åº¦çŠ¶æ€è·å–å·²æäº¤çº¿æ¡æ ·å¼
 * ï¼ˆä¸é¢„è§ˆçº¿æ¡ä¿æŒä¸€è‡´ï¼‰
 */
export function getCommittedStrokeStyle(
  hud: AngleHUDModel, 
  baseWidth: number = 1
): StrokeStyle {
  // å·²æäº¤çš„çº¿æ¡ä½¿ç”¨ç›¸åŒè§„åˆ™
  return getPreviewStrokeStyle(hud, baseWidth)
}
```

---

### äº”ã€CSSæ ·å¼è§„èŒƒ

```css
/* ui/angle-hud.css */

/* åŸºç¡€HUDæ ·å¼ */
.angle-hud {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  padding: 4px 8px;
  border-radius: 3px;
  background: rgba(0, 0, 0, 0.75);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: opacity 80ms ease-out;
}

/* SNAPæ¨¡å¼ */
.angle-hud-snap {
  color: #2A7FFF;
  font-weight: 600; /* Semi-bold */
  font-size: 16.8px; /* 1.2Ã— */
}

/* ORTHOæ¨¡å¼ */
.angle-hud-ortho {
  color: #1F5EFF;
  font-weight: 700; /* Bold */
  font-size: 16.8px;
}

/* LOCKEDæ¨¡å¼ */
.angle-hud-locked {
  color: #0B5ED7;
  font-weight: 700;
  font-size: 16.8px;
  background: rgba(11, 94, 215, 0.15); /* è½»å¾®èƒŒæ™¯ */
}

/* Toastæç¤º */
.angle-hud-toast {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  color: #fff;
  padding: 6px 12px;
  border-radius: 4px;
  background: rgba(31, 94, 255, 0.9);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  animation: fadeOut 800ms ease-out forwards;
}

@keyframes fadeOut {
  0% { opacity: 1; }
  70% { opacity: 1; }
  100% { opacity: 0; }
}

/* çŠ¶æ€æ  */
.statusbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 24px;
  background: #f5f5f5;
  border-top: 1px solid #ddd;
  display: flex;
  align-items: center;
  padding: 0 12px;
  font-size: 12px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.statusbar-item {
  color: #333;
  margin-right: 16px;
}
```

---

### å…­ã€åœ¨Reducerä¸­é›†æˆï¼ˆå…³é”®ï¼‰

```typescript
// reducer/pointer-move-handler.ts

import { deriveAngleHUD } from '../angle/derive-hud'
import type { AngleHUDModel } from '../angle/hud-model'

/**
 * POINTER_MOVEäº‹ä»¶å¤„ç†
 */
function onPointerMove(
  world: { x: number; y: number },
  screen: { x: number; y: number },
  opts: { shift: boolean }
) {
  // 1. æ¨æ–­ç»ˆç‚¹ï¼ˆåŒ…å«è§’åº¦ä¿¡æ¯ï¼‰
  const inf = engine.inferDraw(
    drawStart.x, 
    drawStart.y,
    world.x, 
    world.y,
    scale, 
    snapStep,
    {
      shiftPressed: opts.shift,
      explicitAngleLockRad: state.explicitAngleLockRad,
      angleSetName: state.angleSetName,
    }
  )

  // 2. è®¾ç½®é¢„è§ˆç»ˆç‚¹
  setPreviewEnd(inf.point)

  // 3. æ£€æµ‹ShiftçŠ¶æ€å˜åŒ–
  const justPressedShift = !prevShift && opts.shift
  setPrevShift(opts.shift)

  // 4. æ´¾ç”ŸHUDï¼ˆå…³é”®æ­¥éª¤ï¼‰
  const hud: AngleHUDModel = deriveAngleHUD(inf.angleInfo, {
    justPressedShift,
  })

  // 5. æ›´æ–°çŠ¶æ€
  setAngleHUD(hud)
  setCursorScreen(screen)
}
```

**å…³é”®ç‚¹ï¼š**
```
âœ… æ¯æ¬¡pointer-moveéƒ½è°ƒç”¨deriveAngleHUD
âœ… HUDå­˜å…¥stateï¼ŒUIç»„ä»¶ç›´æ¥è¯»å–
âœ… ä¸è®©UIè‡ªå·±çŒœæµ‹çŠ¶æ€
```

---

## ğŸ“Š å®ç°è®¡åˆ’

### Phase 1: æ ¸å¿ƒHUDï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡ï¼š**
- [ ] å®ç° `AngleMode` å’Œ `AngleHUDModel` ç±»å‹å®šä¹‰
- [ ] å®ç° `deriveAngleHUD()` å‡½æ•°
- [ ] å®ç° `AngleHUD` Reactç»„ä»¶
- [ ] åœ¨reducerä¸­é›†æˆHUDæ´¾ç”Ÿ

**éªŒæ”¶ï¼š**
- å…‰æ ‡é™„è¿‘èƒ½æ˜¾ç¤ºè§’åº¦æ–‡å­—
- SNAP/ORTHO/LOCKEDæ–‡æ¡ˆæ­£ç¡®
- çŠ¶æ€åˆ‡æ¢æ—¶æ–‡å­—ç«‹å³æ›´æ–°

---

### Phase 2: è§†è§‰åé¦ˆï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡ï¼š**
- [ ] å®ç° `getPreviewStrokeStyle()` å‡½æ•°
- [ ] åœ¨Canvasæ¸²æŸ“ä¸­åº”ç”¨çº¿æ¡é¢œè‰²
- [ ] LOCKEDæ¨¡å¼çº¿æ¡åŠ ç²—15%
- [ ] æ·»åŠ CSSæ ·å¼æ–‡ä»¶

**éªŒæ”¶ï¼š**
- FREEæ¨¡å¼ï¼šæ·±ç°è‰²
- SNAPæ¨¡å¼ï¼šæµ…è“è‰²
- ORTHOæ¨¡å¼ï¼šæ·±è“è‰²
- LOCKEDæ¨¡å¼ï¼šæ·±è“è‰²+åŠ ç²—

---

### Phase 3: Shiftå¢å¼º + çŠ¶æ€æ ï¼ˆ0.5å¤©ï¼‰

**ä»»åŠ¡ï¼š**
- [ ] ShiftæŒ‰ä¸‹æ˜¾ç¤ºToastï¼ˆ"ORTHO MODE"ï¼Œ0.8ç§’ï¼‰
- [ ] å®ç° `StatusBar` ç»„ä»¶
- [ ] åœ¨reducerä¸­æ£€æµ‹ShiftçŠ¶æ€å˜åŒ–
- [ ] æ·»åŠ fadeOutåŠ¨ç”»

**éªŒæ”¶ï¼š**
- ShiftæŒ‰ä¸‹æ—¶å‡ºç°Toast
- 0.8ç§’åè‡ªåŠ¨æ¶ˆå¤±
- çŠ¶æ€æ æ˜¾ç¤ºæ­£ç¡®æ–‡æ¡ˆ
- åŠ¨ç”»æµç•…

---

## âœ… å®Œæˆå®šä¹‰ï¼ˆDoDï¼‰

### A. åŠŸèƒ½å±‚DoDï¼ˆç¡¬æŒ‡æ ‡ï¼‰

#### A1. åŸºç¡€è¡Œä¸º

- [ ] ä¸æŒ‰ä»»ä½•é”®æ—¶ï¼Œå…‰æ ‡é™„è¿‘æ— è§’åº¦æ–‡å­—
- [ ] æ¥è¿‘30/45/60/90Â°æ—¶æ˜¾ç¤ºè§’åº¦ï¼ˆå¦‚"45Â°"ï¼‰
- [ ] æŒ‰ä½Shiftï¼Œæ˜¾ç¤º"ORTHO 90Â°"æˆ–"ORTHO 0Â°"
- [ ] æ˜¾å¼é”è§’åï¼Œæ˜¾ç¤º"LOCKED 30Â°"

#### A2. çŠ¶æ€ä¸€è‡´æ€§

- [ ] HUDæ–‡å­—ã€çº¿æ¡é¢œè‰²ã€çŠ¶æ€æ å¿…é¡»åŒæ­¥
- [ ] æ‰€æœ‰UIåªçœ‹`AngleHUDModel`ï¼Œä¸è‡ªå·±çŒœçŠ¶æ€
- [ ] Previewå’ŒCommitä½¿ç”¨ç›¸åŒæ ·å¼è§„åˆ™

---

### B. UXå±‚DoDï¼ˆè¿™æ˜¯CPOæœ€çœ‹é‡çš„ï¼‰

#### B1. å¯æ„ŸçŸ¥æ€§ï¼ˆå¿…é¡»å…¨éƒ¨æ»¡è¶³ï¼‰

- [ ] **é”è§’æ—¶å¿…æœ‰å¯è§è§’åº¦æ–‡å­—**
  - æ–‡å­—å¤§å°å¿…é¡»æ˜¯æ™®é€šæ ‡æ³¨çš„1.2Ã—
  - é¢œè‰²å¿…é¡»æ˜¯è“è‰²ç³»
  - è·Ÿéšé¼ æ ‡ï¼Œä¸é®æŒ¡çº¿æ¡

- [ ] **é”è§’æ—¶çº¿æ¡é¢œè‰²å˜åŒ–**
  - SNAPï¼šæµ…è“
  - ORTHOï¼šæ·±è“
  - LOCKEDï¼šæ·±è“+åŠ ç²—

- [ ] **Shiftæ—¶æ˜ç¡®æ˜¾ç¤ºORTHO**
  - æ–‡å­—å¿…é¡»åŒ…å«"ORTHO"
  - Toastæç¤º"ORTHO MODE"
  - 0.8ç§’è‡ªåŠ¨æ¶ˆå¤±

**åˆ¤æ–­æ ‡å‡†ï¼š**
```
å¦‚æœç”¨æˆ·åœ¨å½•å±é‡Œçœ‹ä¸å‡ºæ¥é”è§’ â†’ ä¸é€šè¿‡
```

---

#### B2. ç¨³å®šæ€§ï¼ˆä½“éªŒæŒ‡æ ‡ï¼‰

- [ ] **åœ¨snapåŒºåŸŸå†…å°å¹…æ™ƒåŠ¨ï¼Œè§’åº¦ä¸æ¥å›è·³**
  - è¿›å…¥snapï¼šÂ±3Â°
  - è„±ç¦»snapï¼šÂ±6Â°
  - Hysteresisæ•ˆæœæ˜æ˜¾

- [ ] **å¿…é¡»æ˜æ˜¾æ‹–ç¦»snapåŒºåŸŸæ‰ä¼šé‡Šæ”¾**
  - ä¸èƒ½è½»å¾®æŠ–åŠ¨å°±é‡Šæ”¾
  - é‡Šæ”¾æ—¶æ–‡å­—ç«‹å³æ¶ˆå¤±

- [ ] **ShiftæŒ‰ä½æœŸé—´ï¼Œè§’åº¦ç»ä¸æ¼‚ç§»**
  - åªèƒ½æ˜¯0Â°æˆ–90Â°
  - ä¸ä¼šè¢«Smart Snapå¹²æ‰°

---

### C. CEOéªŒæ”¶æ ‡å‡†ï¼ˆæœ€é‡è¦ï¼‰

**CEOï¼ˆéCTOï¼‰åœ¨ä¸çŸ¥é“å†…éƒ¨å®ç°çš„æƒ…å†µä¸‹ï¼š**

1. [ ] **æ‰“å¼€PlanSnap**
2. [ ] **ç”»3æ¡çº¿**
3. [ ] **ä¸çœ‹æ–‡æ¡£**
4. [ ] **èƒ½æ˜ç¡®æ„ŸçŸ¥ä»€ä¹ˆæ—¶å€™çº¿æ˜¯"è¢«æ§åˆ¶çš„"**

**åˆ¤æ–­ï¼š**
```
âœ… ç­”æ¡ˆæ˜¯ Yes â†’ äº¤ä»˜å®Œæˆ
âŒ ç­”æ¡ˆæ˜¯ "å¥½åƒæœ‰ï¼Œä½†ä¸ç¡®å®š" â†’ è¿”å·¥
```

---

### D. å½•å±éªŒæ”¶ï¼ˆæ¨èï¼‰

**å½•åˆ¶1åˆ†é’Ÿè§†é¢‘ï¼ŒåŒ…å«ï¼š**
1. ç”»ä¸€æ¡æ¥è¿‘90Â°çš„çº¿ï¼ˆåº”æ˜¾ç¤º"90Â°"ï¼Œçº¿æ¡å˜è“ï¼‰
2. æŒ‰ä½Shiftç”»çº¿ï¼ˆåº”æ˜¾ç¤º"ORTHO MODE" + "ORTHO 90Â°"ï¼‰
3. é”å®š30Â°ç”»çº¿ï¼ˆåº”æ˜¾ç¤º"LOCKED 30Â°"ï¼Œçº¿æ¡æ·±è“+åŠ ç²—ï¼‰

**å‘ç»™å›¢é˜Ÿæˆå‘˜çœ‹ï¼Œé—®ï¼š**
```
"ä½ èƒ½çœ‹å‡ºä»€ä¹ˆæ—¶å€™è§’åº¦è¢«é”å®šäº†å—ï¼Ÿ"
```

å¦‚æœ5ä¸ªäººéƒ½è¯´èƒ½çœ‹å‡ºæ¥ â†’ é€šè¿‡

---

## ğŸš¨ å…³é”®æ³¨æ„äº‹é¡¹

### 1. UIä¸èƒ½è‡ªå·±çŒœçŠ¶æ€

**é”™è¯¯æ¨¡å¼ï¼š**
```typescript
// âŒ UIè‡ªå·±æ ¹æ®isSnappedæ¨æ–­
function AngleHUD({ isSnapped, angleDeg }) {
  const text = isSnapped ? `${angleDeg}Â°` : null
  // ...
}
```

**æ­£ç¡®æ¨¡å¼ï¼š**
```typescript
// âœ… UIåªè¯»å–HUDæ¨¡å‹
function AngleHUD({ hud }: { hud: AngleHUDModel }) {
  return <div>{hud.textNearCursor}</div>
}
```

---

### 2. æ–‡æ¡ˆå¿…é¡»å®Œå…¨ä¸€è‡´

**é”™è¯¯ï¼š**
```
æœ‰çš„åœ°æ–¹æ˜¾ç¤º "90Â°"
æœ‰çš„åœ°æ–¹æ˜¾ç¤º "Ortho 90Â°"
æœ‰çš„åœ°æ–¹æ˜¾ç¤º "ORTHO 90Â°"
```

**æ­£ç¡®ï¼š**
```
æ‰€æœ‰ORTHOæ¨¡å¼éƒ½æ˜¾ç¤º "ORTHO 90Â°"
æ‰€æœ‰æ–‡æ¡ˆä»deriveAngleHUD()ç»Ÿä¸€è¾“å‡º
```

---

### 3. Previewå’ŒCommitå¿…é¡»ä¸€è‡´

**é”™è¯¯ï¼š**
```
Previewæ—¶ï¼šè“è‰²
Commitåï¼šé»‘è‰²ï¼ˆå› ä¸ºå¿˜è®°åº”ç”¨styleTokenï¼‰
```

**æ­£ç¡®ï¼š**
```
Previewå’ŒCommitéƒ½ä½¿ç”¨getPreviewStrokeStyle()
ç”¨æˆ·çœ‹åˆ°çš„æ°¸è¿œä¸€è‡´
```

---

### 4. Hysteresisæ˜¯ä½“éªŒå…³é”®

**æ²¡æœ‰Hysteresisï¼š**
```
é¼ æ ‡åœ¨89Â°-91Â°æ™ƒåŠ¨
è§’åº¦æ–‡å­—ç–¯ç‹‚é—ªçƒï¼š"90Â°" "89Â°" "90Â°" "91Â°" ...
ç”¨æˆ·ï¼šè¿™ä»€ä¹ˆç ´ç©æ„ï¼Ÿ
```

**æœ‰Hysteresisï¼š**
```
é¼ æ ‡åœ¨89Â°-91Â°æ™ƒåŠ¨
è§’åº¦æ–‡å­—ç¨³å®šæ˜¾ç¤ºï¼š"90Â°"
åªæœ‰åç¦»åˆ°84Â°æˆ–96Â°æ‰é‡Šæ”¾
ç”¨æˆ·ï¼šçœŸç¨³ï¼
```

---

## ğŸ’¬ CPOåŸè¯ï¼ˆé‡è¦ï¼‰

### å…³äºç›®æ ‡

> "ç®—æ³•å·²ç»é€šè¿‡ï¼Œç°åœ¨è¿™ä¸æ˜¯'æŠ€æœ¯é—®é¢˜'ï¼Œæ˜¯'ä¿¡ä»»æ„Ÿé—®é¢˜'ã€‚æˆ‘ä»¬éœ€è¦æŠŠ Angle Lock åšåˆ°åƒ SketchUp ä¸€æ ·è®©äººå®‰å¿ƒï¼ŒDoD åªçœ‹ç”¨æˆ·æ˜¯å¦èƒ½æ˜æ˜¾æ„Ÿè§‰åˆ°é”å®šçŠ¶æ€ã€‚"

### å…³äºè®¾è®¡åŸåˆ™

> "çŠ¶æ€å¿…é¡»'è¯´è¯'ï¼Œä¸é æ„Ÿè§‰ï¼Œä¸é æ•™ç¨‹ï¼ŒçŠ¶æ€è‡ªå·±å‘Šè¯‰ç”¨æˆ·ã€‚æ–‡å­— > å›¾æ ‡ã€‚çŸ­ã€ç¡¬ã€å·¥ç¨‹æ„Ÿ - ä¸è¦è¥é”€æ–‡æ¡ˆï¼Œåªè¦å·¥ç¨‹è¯­è¨€ã€‚"

### å…³äºShift

> "Shift = ç”¨æˆ·è¯´äº†ç®—ï¼Œè¿™æ˜¯ CAD çš„åŸºæœ¬å°Šé‡ã€‚"

### å…³äºéªŒæ”¶

> "å¦‚æœç”¨æˆ·åœ¨å½•å±é‡Œçœ‹ä¸å‡ºæ¥é”è§’ â†’ ä¸é€šè¿‡ã€‚"

---

## ğŸ“š å‚è€ƒå®ç°

### SketchUpé£æ ¼å‚è€ƒ

**å…‰æ ‡æç¤ºï¼š**
- ç®€æ´ã€ç›´æ¥
- è·Ÿéšé¼ æ ‡
- é«˜å¯¹æ¯”åº¦

**çº¿æ¡åé¦ˆï¼š**
- è¢«çº¦æŸçš„çº¿æ¡æœ‰æ˜æ˜¾è§†è§‰åŒºåˆ«
- é¢œè‰²æˆ–æ ·å¼å˜åŒ–

**çŠ¶æ€æç¤ºï¼š**
- åº•éƒ¨çŠ¶æ€æ æŒç»­æ˜¾ç¤º
- ä¸“ä¸šç”¨æˆ·ä¾èµ–è¿™ä¸ª

---

### AutoCADé£æ ¼å‚è€ƒ

**æ­£äº¤æ¨¡å¼ï¼š**
- æ˜ç¡®çš„"ORTHO"æ–‡å­—
- ä¸ç”¨çŒœæ˜¯ä¸æ˜¯æ­£äº¤

**è§’åº¦é”å®šï¼š**
- æ•°å­—+æ–‡å­—ç»„åˆ
- ä¾‹å¦‚"ORTHO 90Â°"

---

## ğŸ“‹ æ–‡æ¡£å¯¹ç…§è¡¨

### çŠ¶æ€ â†” æ–‡æ¡ˆ â†” æ ·å¼

| AngleMode | textNearCursor | statusBarText | strokeToken | çº¿æ¡é¢œè‰² |
|-----------|----------------|---------------|-------------|---------|
| FREE | null | `Angle: Free` | free | `#333333` |
| SNAP | `45Â°` | `Angle: Snap 45Â°` | snap | `#4A9EFF` |
| SHIFT_ORTHO | `ORTHO 90Â°` | `Angle: Ortho` | ortho | `#2A7FFF` |
| LOCKED | `LOCKED 30Â°` | `Angle: Locked 30Â°` | locked | `#1F5EFF` + åŠ ç²— |

### Toastæç¤º

| è§¦å‘æ¡ä»¶ | æ–‡æ¡ˆ | æŒç»­æ—¶é—´ |
|---------|------|---------|
| ShiftåˆšæŒ‰ä¸‹ | `ORTHO MODE` | 0.8ç§’ |

---

## âœ… å¼€å§‹ä¿¡å·

CTOå¯ä»¥ç›´æ¥æŒ‰è¿™ä¸ªè§„èŒƒå¼€å§‹å®ç°ã€‚

**å¦‚æœ‰ç–‘é—®ï¼š**
- æ–‡æ¡ˆé—®é¢˜ â†’ å‚è€ƒç¬¬äºŒèŠ‚å®Œæ•´æ–‡æ¡ˆè¡¨
- çŠ¶æ€é—®é¢˜ â†’ å‚è€ƒç¬¬ä¸‰èŠ‚çŠ¶æ€æšä¸¾
- æ ·å¼é—®é¢˜ â†’ å‚è€ƒç¬¬å››èŠ‚CSSè§„èŒƒ
- é›†æˆé—®é¢˜ â†’ å‚è€ƒç¬¬äº”èŠ‚Reduceré›†æˆ

**é¢„è®¡1.5å¤©å®Œæˆï¼Œç¬¬2å¤©å¯ä»¥ç»™CPOæ¼”ç¤ºã€‚**

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** CDO  
**æœ€åæ›´æ–°ï¼š** 2026-02-03  
**ç‰ˆæœ¬ï¼š** v1.0  
**çŠ¶æ€ï¼š** âœ… Ready for Implementation
