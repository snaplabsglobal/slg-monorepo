# UI清爽化 - 快速执行清单

> **CTO 5分钟速查卡**  
> **预计工作量：** 0.5-1天  
> **优先级：** 🟡 P1 - Important

---

## ⚡ 一句话目标

**减少UI噪音，让界面清爽专业**

**CEO判断：**
> "底层已经对了，但UI噪音太大，正在'出卖手感'。"

---

## 🎯 5项减法（Copy & Paste）

### 1. 角度显示：只显示30/45/60

```typescript
function shouldShowAngleLabel(angleDeg: number): boolean {
  const normalized = ((angleDeg % 360) + 360) % 360
  
  // 正交角不显示
  const orthogonal = [0, 90, 180, 270]
  if (orthogonal.some(a => Math.abs(normalized - a) < 0.1)) {
    return false  // ❌ 不显示
  }
  
  // 只显示特殊角
  const special = [30, 45, 60]
  return special.some(a => Math.abs(normalized - a) < 0.1)  // ✅ 显示
}
```

**UI使用：**
```tsx
function AngleLabel({ angleDeg }) {
  if (!shouldShowAngleLabel(angleDeg)) return null
  return <div>{angleDeg}°</div>
}
```

---

### 2. 删除Angle Toolbar

**文件：** `src/ui/toolbar.tsx`

**删除这一行：**
```tsx
<ToolbarButton icon="angle" label="Angle" onClick={...} />  // ❌ 删除
```

**保留底层：**
```
✅ Smart Snap仍然工作
✅ Shift正交锁定仍然工作
✅ Explicit Lock仍然工作
```

---

### 3. 删除DIM Toolbar

**文件：** `src/ui/toolbar.tsx`

**删除这一行：**
```tsx
<ToolbarButton icon="dimension" label="DIM" onClick={...} />  // ❌ 删除
```

**替代方案：**
```
✅ 线的长度自动显示
✅ 跟随线方向
✅ 实时更新
```

---

### 4. 尺寸显示简化

```typescript
/**
 * 简化分数
 * 例如：2/16 → 1/8, 4/16 → 1/4
 */
function simplifyFraction(num: number, den: number): string | null {
  if (num === 0) return null
  
  // 最大公约数
  const gcd = (a: number, b: number): number => 
    b ? gcd(b, a % b) : a
  
  const g = gcd(num, den)
  const sNum = num / g
  const sDen = den / g
  
  // 如果分母是1，不显示分数
  if (sDen === 1) return null
  
  return `${sNum}/${sDen}`
}

/**
 * 格式化长度（简化版）
 */
function formatLength(
  lenMm: number,
  snapPrecision: Precision
): string {
  const inches = lenMm / 25.4
  
  // 圆整到snap精度
  const rounded = roundToSnapPrecision(inches, snapPrecision)
  
  // 分解为whole + fraction
  const whole = Math.floor(rounded)
  const frac = rounded - whole
  
  // 计算分数
  const denominator = Math.round(1 / snapPrecision)
  const numerator = Math.round(frac * denominator)
  
  const fraction = simplifyFraction(numerator, denominator)
  
  // 格式化
  if (whole >= 12) {
    const feet = Math.floor(whole / 12)
    const inch = whole % 12
    
    if (fraction) {
      return `${feet}'-${inch} ${fraction}"`
    } else if (inch > 0) {
      return `${feet}'-${inch}"`
    } else {
      return `${feet}'"`
    }
  }
  
  if (fraction) {
    return `${whole} ${fraction}"`
  }
  return `${whole}"`
}
```

---

### 5. Grid颜色：+10-15%

**文件：** `src/renderer/grid.ts` 或 `src/styles/grid.css`

**修改：**
```typescript
// 当前
const GRID_COLOR_MAJOR = 'rgba(0, 0, 0, 0.1)'
const GRID_COLOR_MINOR = 'rgba(0, 0, 0, 0.05)'

// 修改为
const GRID_COLOR_MAJOR = 'rgba(0, 0, 0, 0.12)'  // +20%
const GRID_COLOR_MINOR = 'rgba(0, 0, 0, 0.06)'  // +20%
```

**或CSS：**
```css
.grid-major {
  stroke: rgba(0, 0, 0, 0.12);  /* 从0.1提升 */
}

.grid-minor {
  stroke: rgba(0, 0, 0, 0.06);  /* 从0.05提升 */
}
```

---

## 📋 半天计划

### 上午（2-3小时）

- [ ] 角度显示filter（30分钟）
  - 实现shouldShowAngleLabel
  - 应用到AngleLabel组件
  - 测试0/90/180/270不显示

- [ ] Toolbar清理（30分钟）
  - 删除Angle按钮
  - 删除DIM按钮
  - 验证其他工具正常

- [ ] 尺寸简化（1小时）
  - 实现simplifyFraction
  - 修改formatLength
  - 测试各种分数

- [ ] Grid颜色（15分钟）
  - 调整opacity
  - 测试可见性

---

### 下午（1-2小时）

- [ ] 全面测试（1小时）
  - 角度显示测试
  - Toolbar测试
  - 尺寸显示测试
  - Grid测试

- [ ] 回归验证（1小时）
  - 功能完整性
  - 几何精度不变
  - UI清爽度

---

## ✅ 验收清单

### 角度显示

- [ ] **0度线：不显示角度**
- [ ] **90度线：不显示角度**
- [ ] **30度线：显示"30°"**
- [ ] **45度线：显示"45°"**
- [ ] **60度线：显示"60°"**

---

### Toolbar

- [ ] **Angle按钮已删除**
- [ ] **DIM按钮已删除**
- [ ] **Select/Line/Tape/Eraser保留**
- [ ] **基础功能正常**

---

### 尺寸显示

| 输入 | 期望显示 |
|------|---------|
| 1/16" | 1/16" |
| 2/16" | 1/8" (简化) |
| 1/4" | 1/4" |
| 4/16" | 1/4" (简化) |
| 3" | 3" |
| 36" | 3'-0" |

- [ ] **不显示2/16, 4/16, 8/16**
- [ ] **不显示0/16**
- [ ] **不显示多余精度**

---

### Grid

- [ ] **主Grid比之前明显**
- [ ] **次Grid可选明显**
- [ ] **不抢线**
- [ ] **给视觉锚点**

---

### 回归

- [ ] **角度snap仍工作**
- [ ] **长度计算准确**
- [ ] **几何精度不变**
- [ ] **整体UI清爽**

---

## 🧪 快速测试

### Test 1: 角度
```
画0度线 → 无角度标签 ✓
画90度线 → 无角度标签 ✓
画45度线 → 显示"45°" ✓
```

### Test 2: Toolbar
```
打开应用 → Angle/DIM已删除 ✓
Select/Line正常 ✓
```

### Test 3: 分数
```
画2/16"线 → 显示"1/8"" ✓
画1/4"线 → 显示"1/4"" ✓
```

### Test 4: Grid
```
观察grid → 比之前稍明显 ✓
画线snap → 有视觉锚点 ✓
```

---

## 🚨 关键接线点

### 1. 角度Label组件

**文件：** `src/ui/angle-label.tsx` 或类似

**修改点：**
```tsx
// 在render前加filter
if (!shouldShowAngleLabel(angleDeg)) {
  return null
}
```

---

### 2. Toolbar组件

**文件：** `src/ui/toolbar.tsx`

**删除这两行：**
```tsx
<ToolbarButton icon="angle" ... />     // 删除
<ToolbarButton icon="dimension" ... /> // 删除
```

---

### 3. 长度格式化

**文件：** `src/utils/format-length.ts`

**添加simplifyFraction函数**

**修改formatLength函数**

---

### 4. Grid渲染

**文件：** `src/renderer/grid.ts` 或 CSS

**调整opacity值**

---

## 💬 CEO关键引用

### 关于总体
> "底层已经对了，但UI噪音太大，正在'出卖手感'。"

### 关于角度
> "正交角本来就是'默认常识'，不需要被提醒。"

### 关于Toolbar
> "如果连CEO都要问'DIM是干什么的'，那用户一定更迷糊。"

### 关于尺寸
> "如果是1/16就标1/16，1/4就1/4，要保持界面清爽。"

### 关于原则
> "显示精度永远 ≤ snap精度，UI不得暴露计算残差。"

---

## 📊 显示规则速查

### 角度显示

| 角度 | 显示 |
|------|------|
| 0° | ❌ 不显示 |
| 30° | ✅ "30°" |
| 45° | ✅ "45°" |
| 60° | ✅ "60°" |
| 90° | ❌ 不显示 |
| 180° | ❌ 不显示 |
| 270° | ❌ 不显示 |

---

### 分数简化

| 原始 | 简化后 |
|------|--------|
| 0/16 | (不显示) |
| 1/16 | 1/16 |
| 2/16 | 1/8 |
| 4/16 | 1/4 |
| 8/16 | 1/2 |
| 16/16 | (不显示分数) |

---

## 📞 有问题？

- 角度filter逻辑 → 看会议纪要"角度提示"章节
- 分数简化算法 → 看会议纪要"尺寸显示规则"章节
- Grid颜色选择 → 看会议纪要"Grid颜色"章节

---

**开始清爽UI！** 🚀

完整文档：`2026-02-03_会议纪要_UI清爽化减法设计.md`
