# JSS 产品宪法 (Constitution)

> **状态**: 生效中
> **版本**: v1.0
> **生效日期**: 2026-02-08
> **修改流程**: 必须通过 PR + Review

---

## 第一章：产品定位

### 1.1 核心使命
JobSite Snap (JSS) 是为建筑承包商设计的现场照片证据管理工具。

### 1.2 目标用户
- 主要用户：小型建筑承包商 (1-10人团队)
- 使用场景：工地现场拍照、进度记录、成本追踪

### 1.3 核心价值
1. **快速拍照** - 一次点击完成拍照
2. **自动归档** - 照片自动关联工作项目
3. **离线优先** - 工地无网络也能正常工作
4. **证据可追溯** - 时间戳、GPS、项目关联

---

## 第二章：技术架构原则

### 2.1 非阻塞相机原则 (Non-Blocking Camera)
```
相机必须采用非阻塞架构:
capture() → enqueue() → return (立即返回继续拍照)

禁止:
- 拍照后跳转确认页面
- 等待上传完成才能继续拍照
- 任何阻塞用户拍照流程的操作
```

### 2.2 离线优先原则 (Offline-First)
```
所有核心功能必须支持离线使用:
1. 照片存储到 IndexedDB
2. 上传队列后台自动重试
3. 网络恢复后自动同步
```

### 2.3 状态机严格性
```
相机状态机只允许以下状态:
READY → CAPTURING → READY

禁止添加:
- CONFIRMING
- UPLOADING
- REVIEWING
或任何其他阻塞状态
```

---

## 第三章：代码规范

### 3.1 相机模块
- 唯一入口: `/jobs/[id]/camera` (SnapCamera)
- 禁止使用: CameraCapture 组件 (已废弃)

### 3.2 上传模块
- 使用 upload-queue 后台上传
- IndexedDB 持久化队列
- 指数退避重试策略

### 3.3 认证模块
- 使用 Supabase Auth
- signout 必须使用 POST 方法

---

## 第四章：修改流程

### 4.1 宪法级文件
以下文件的修改必须通过 PR + Review:
- `JSS_CONSTITUTION.md` (本文件)
- `JSS_CAMERA_STATE_MACHINE.md`

### 4.2 审核要求
- 至少 1 名 Reviewer 批准
- 必须说明修改原因
- 禁止 force push

---

## 附录：版本历史

| 版本 | 日期 | 修改内容 | 审核人 |
|------|------|----------|--------|
| v1.0 | 2026-02-08 | 初始版本 | - |
