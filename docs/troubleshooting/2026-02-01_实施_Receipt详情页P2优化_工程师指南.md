# Receipt è¯¦æƒ…é¡µ P2 ä¼˜åŒ– - å·¥ç¨‹å¸ˆå®æ–½æŒ‡å—

> **ä¼˜å…ˆçº§ï¼š** P2ï¼ˆå¾…P0/P1å®Œæˆåæ‰§è¡Œï¼‰  
> **æ€»å·¥ä½œé‡ï¼š** 14-19 å°æ—¶  
> **ä»»åŠ¡ç±»å‹ï¼š** ä½“éªŒä¼˜åŒ– + æ–°å¢åŠŸèƒ½  

---

## ğŸ¯ å¿«é€Ÿæ‘˜è¦ï¼ˆ2åˆ†é’Ÿï¼‰

### è¦åšä»€ä¹ˆ
ä¼˜åŒ– Receipt è¯¦æƒ…é¡µçš„ 6 ä¸ªåŠŸèƒ½ï¼š

| # | åŠŸèƒ½ | ç±»å‹ | å·¥ä½œé‡ |
|---|------|------|--------|
| 1 | é‡æ–°è¯†åˆ«æŒ‰é’® | åŠŸèƒ½å¢å¼º | 2-3h |
| 2 | å›¾ç‰‡ç¼©æ”¾ä¼˜åŒ– | äº¤äº’æ”¹è¿› | 3-4h |
| 3 | Category é»˜è®¤å€¼ | æ•ˆç‡æå‡ | 1h |
| 4 | Notes å­—æ®µ | æ–°å¢åŠŸèƒ½ | 2h |
| 5 | Project å­—æ®µ | æ–°å¢åŠŸèƒ½ | 2-4h |
| 6 | UI ç²¾ç®€ | UI ä¼˜åŒ– | 1.5h |

**æ€»è®¡ï¼š** 14-19 å°æ—¶ï¼ˆåˆ†3å‘¨å®Œæˆï¼‰

---

### å…³é”®äº§å“å†³ç­–ï¼ˆæ¥è‡ª GPT CPOï¼‰

**å¿…é¡»éµå®ˆçš„è§„åˆ™ï¼š**
- âœ… GIFI ä¸å¼ºåˆ¶å¡«å†™ï¼Œæ”¾åœ¨é«˜çº§é€‰é¡¹
- âœ… Home Depot = Materialï¼ˆé»˜è®¤ï¼Œå¯ä¿®æ”¹ï¼‰
- âœ… Project å¯é€‰ï¼Œä¸åœ¨ä¸Šä¼ æ—¶æ‰“æ–­
- âœ… Notes å°±å« "Notes"ï¼ˆä¸æ˜¯ Memoï¼‰

**è¯¦ç»†å†³ç­–è§ï¼š** [æœ€ç»ˆå†³ç­–æ–‡æ¡£](./2026-02-01_å†³ç­–_Receiptè¯¦æƒ…é¡µP2ä¼˜åŒ–_æœ€ç»ˆæ–¹æ¡ˆ.md)

---

## ğŸ“‹ å®æ–½æ¸…å•ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### âœ… Week 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆP2-Highï¼‰â±ï¸ 6-8h

- [ ] **Task 1.1:** é‡æ–°è¯†åˆ«æŒ‰é’®ï¼ˆ2-3hï¼‰
- [ ] **Task 1.2:** å›¾ç‰‡ç¼©æ”¾ä¼˜åŒ–ï¼ˆ3-4hï¼‰
- [ ] **Task 1.3:** Category é»˜è®¤å€¼ï¼ˆ1hï¼‰

---

### âœ… Week 2: å­—æ®µå¢å¼ºï¼ˆP2-Mediumï¼‰â±ï¸ 4-6h

- [ ] **Task 2.1:** Notes å­—æ®µï¼ˆ2hï¼‰
- [ ] **Task 2.2:** Project å­—æ®µï¼ˆ2-4hï¼‰

---

### âœ… Week 3: UI ç²¾ç®€ + æµ‹è¯•ï¼ˆP2-Lowï¼‰â±ï¸ 3.5-5h

- [ ] **Task 3.1:** GIFI å­—æ®µè°ƒæ•´ï¼ˆ30minï¼‰
- [ ] **Task 3.2:** åˆ é™¤ä¸­æ–‡ä¹±ç ï¼ˆ30minï¼‰
- [ ] **Task 3.3:** å…¶ä»– UI å¾®è°ƒï¼ˆ30minï¼‰
- [ ] **Task 3.4:** æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3hï¼‰

---

## ğŸ”§ Week 1: æ ¸å¿ƒåŠŸèƒ½å®æ–½

### Task 1.1: é‡æ–°è¯†åˆ«æŒ‰é’®ï¼ˆ2-3hï¼‰

#### åŠŸèƒ½æè¿°
å½“è¯†åˆ«å¤±è´¥æˆ– pending è¶…è¿‡ 5 åˆ†é’Ÿæ—¶ï¼Œæ˜¾ç¤º"é‡æ–°è¯†åˆ«"æŒ‰é’®ï¼Œå…è®¸ç”¨æˆ·ç”¨åŸå›¾é‡æ–°è§¦å‘åˆ†æã€‚

---

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/TransactionDetailSlideOver.tsx
apps/web-app/src/components/transactions/MobileBottomSheet.tsx
```

**æ­¥éª¤ 1ï¼šæ·»åŠ çŠ¶æ€ç®¡ç†**

```tsx
// TransactionDetailSlideOver.tsx
import { useState } from 'react';

const [isReAnalyzing, setIsReAnalyzing] = useState(false);
```

**æ­¥éª¤ 2ï¼šæ·»åŠ é‡æ–°è¯†åˆ«å‡½æ•°**

```tsx
const handleReAnalyze = async () => {
  if (isReAnalyzing) return;
  
  setIsReAnalyzing(true);
  
  try {
    // è°ƒç”¨ analyze API
    const res = await fetch(`/api/transactions/${transaction.id}/analyze`, {
      method: 'POST',
    });
    
    if (!res.ok) {
      throw new Error('Re-analysis failed');
    }
    
    // æ˜¾ç¤ºæˆåŠŸæç¤º
    toast.success('é‡æ–°è¯†åˆ«ä¸­ï¼Œç¨ç­‰ç‰‡åˆ»...');
    
    // å¯é€‰ï¼šç«‹å³æ›´æ–°æœ¬åœ°çŠ¶æ€
    // setTransaction({ ...transaction, status: 'pending' });
    
  } catch (error) {
    console.error('Re-analyze error:', error);
    toast.error('é‡æ–°è¯†åˆ«å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  } finally {
    setIsReAnalyzing(false);
  }
};
```

**æ­¥éª¤ 3ï¼šæ·»åŠ æŒ‰é’® UI**

```tsx
// åœ¨ "Replace" æŒ‰é’®æ—è¾¹æ·»åŠ 
{/* æ˜¾ç¤ºæ¡ä»¶ */}
{(transaction.status === 'needs_review' || 
  transaction.status === 'error' || 
  (transaction.status === 'pending' && isPendingTooLong())) && (
  
  <button
    onClick={handleReAnalyze}
    disabled={isReAnalyzing}
    className="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
  >
    {isReAnalyzing ? (
      <>
        <LoadingSpinner className="w-4 h-4" />
        é‡æ–°è¯†åˆ«ä¸­...
      </>
    ) : (
      <>
        <ArrowPathIcon className="w-4 h-4" />
        é‡æ–°è¯†åˆ«
      </>
    )}
  </button>
)}
```

**æ­¥éª¤ 4ï¼šæ·»åŠ è¾…åŠ©å‡½æ•°**

```tsx
// åˆ¤æ–­ pending æ˜¯å¦è¶…è¿‡ 5 åˆ†é’Ÿ
const isPendingTooLong = () => {
  if (transaction.status !== 'pending') return false;
  
  const createdAt = new Date(transaction.created_at);
  const now = new Date();
  const diffMinutes = (now.getTime() - createdAt.getTime()) / (1000 * 60);
  
  return diffMinutes > 5;
};
```

**æ­¥éª¤ 5ï¼šç§»åŠ¨ç«¯åŒæ­¥**

```tsx
// MobileBottomSheet.tsx
// åœ¨ footer åŒºåŸŸ ConfirmDataButton æ—è¾¹æ·»åŠ ç›¸åŒçš„æŒ‰é’®
// ä»£ç ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ç§»åŠ¨ç«¯æ ·å¼
```

---

#### åç«¯ä¿®æ”¹

**âœ… æ— éœ€ä¿®æ”¹ï¼**

åç«¯çš„ `POST /api/transactions/{id}/analyze` å·²ç»å­˜åœ¨ï¼š
- è·¯å¾„ï¼š`apps/api/src/routes/analyze/route.ts:63-92`
- åŠŸèƒ½ï¼šè‡ªåŠ¨åˆ›å»º `pending_analysis` å¹¶è§¦å‘ worker

---

#### æµ‹è¯•æ¸…å•

- [ ] çŠ¶æ€ä¸º `needs_review` æ—¶æ˜¾ç¤ºæŒ‰é’®
- [ ] çŠ¶æ€ä¸º `error` æ—¶æ˜¾ç¤ºæŒ‰é’®
- [ ] çŠ¶æ€ä¸º `pending` ä¸”è¶…è¿‡ 5 åˆ†é’Ÿæ—¶æ˜¾ç¤ºæŒ‰é’®
- [ ] ç‚¹å‡»æŒ‰é’®åæ˜¾ç¤º loading çŠ¶æ€
- [ ] API è°ƒç”¨æˆåŠŸåæ˜¾ç¤º toast
- [ ] API è°ƒç”¨å¤±è´¥åæ˜¾ç¤ºé”™è¯¯æç¤º
- [ ] æŒ‰é’®åœ¨ disabled æ—¶ä¸å¯ç‚¹å‡»
- [ ] ç§»åŠ¨ç«¯åŠŸèƒ½æ­£å¸¸

---

### Task 1.2: å›¾ç‰‡ç¼©æ”¾ä¼˜åŒ–ï¼ˆ3-4hï¼‰

#### åŠŸèƒ½æè¿°
å®ç°é¼ æ ‡æ»šè½®ç¼©æ”¾å’Œæ‰‹æŒ‡æåˆç¼©æ”¾ï¼Œæ›¿ä»£å½“å‰çš„ zoom sliderã€‚

---

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/ReceiptImagePanel.tsx
```

**å½“å‰å®ç°ï¼ˆCTO åˆ†æï¼‰ï¼š**
- å·²æœ‰ CSS Transform scale
- å·²æœ‰ input onChange zoomï¼ˆ0.5x - 2xï¼‰
- å·²æœ‰ Pointer Events æ‹–æ‹½ï¼ˆ5px thresholdï¼‰

**éœ€è¦æ·»åŠ ï¼š**
1. onWheel é¼ æ ‡æ»šè½®ç¼©æ”¾
2. onTouchMove æ‰‹æŒ‡æåˆç¼©æ”¾

---

**æ­¥éª¤ 1ï¼šæ·»åŠ é¼ æ ‡æ»šè½®ç¼©æ”¾**

```tsx
// ReceiptImagePanel.tsx

const handleWheel = (e: React.WheelEvent) => {
  e.preventDefault();
  
  // deltaY > 0 = å‘ä¸‹æ»šåŠ¨ = ç¼©å°
  // deltaY < 0 = å‘ä¸Šæ»šåŠ¨ = æ”¾å¤§
  const delta = e.deltaY > 0 ? -0.1 : 0.1;
  
  setZoom(prev => {
    const newZoom = prev + delta;
    // é™åˆ¶åœ¨ 0.5x - 2.0x
    return Math.max(0.5, Math.min(2.0, newZoom));
  });
};

// æ·»åŠ åˆ° img å…ƒç´ 
<img
  src={imageUrl}
  onWheel={handleWheel}
  // ... å…¶ä»– props
/>
```

---

**æ­¥éª¤ 2ï¼šæ·»åŠ æ‰‹æŒ‡æåˆç¼©æ”¾ï¼ˆç§»åŠ¨ç«¯ï¼‰**

```tsx
// çŠ¶æ€ç®¡ç†
const [initialDistance, setInitialDistance] = useState<number | null>(null);
const [initialZoom, setInitialZoom] = useState<number>(1);

// è®¡ç®—ä¸¤æŒ‡è·ç¦»
const getDistance = (touch1: React.Touch, touch2: React.Touch) => {
  const dx = touch1.clientX - touch2.clientX;
  const dy = touch1.clientY - touch2.clientY;
  return Math.sqrt(dx * dx + dy * dy);
};

const handleTouchStart = (e: React.TouchEvent) => {
  if (e.touches.length === 2) {
    // åŒæŒ‡è§¦æ‘¸ï¼Œå¼€å§‹æåˆ
    const distance = getDistance(e.touches[0], e.touches[1]);
    setInitialDistance(distance);
    setInitialZoom(zoom);
  }
};

const handleTouchMove = (e: React.TouchEvent) => {
  if (e.touches.length === 2 && initialDistance !== null) {
    e.preventDefault();
    
    const distance = getDistance(e.touches[0], e.touches[1]);
    const scale = distance / initialDistance;
    
    const newZoom = initialZoom * scale;
    setZoom(Math.max(0.5, Math.min(2.0, newZoom)));
  }
};

const handleTouchEnd = (e: React.TouchEvent) => {
  if (e.touches.length < 2) {
    setInitialDistance(null);
  }
};

// æ·»åŠ åˆ° img å…ƒç´ 
<img
  src={imageUrl}
  onWheel={handleWheel}
  onTouchStart={handleTouchStart}
  onTouchMove={handleTouchMove}
  onTouchEnd={handleTouchEnd}
  // ... å…¶ä»– props
/>
```

---

**æ­¥éª¤ 3ï¼šä¼˜åŒ– zoom slider ä½ç½®**

```tsx
// å°† slider ç§»åˆ°å³ä¸Šè§’ï¼Œç¼©å°å°ºå¯¸
<div className="absolute top-4 right-4 bg-white/90 backdrop-blur rounded-lg p-2 shadow-md">
  <div className="flex items-center gap-2">
    <button 
      onClick={() => setZoom(prev => Math.max(0.5, prev - 0.1))}
      className="p-1 hover:bg-gray-100 rounded"
    >
      <MinusIcon className="w-4 h-4" />
    </button>
    
    <span className="text-sm font-medium w-12 text-center">
      {Math.round(zoom * 100)}%
    </span>
    
    <button 
      onClick={() => setZoom(prev => Math.min(2.0, prev + 0.1))}
      className="p-1 hover:bg-gray-100 rounded"
    >
      <PlusIcon className="w-4 h-4" />
    </button>
  </div>
</div>
```

æˆ–è€…ä¿ç•™åŸæœ‰çš„ sliderï¼Œä½†æ ·å¼è°ƒæ•´ï¼š

```tsx
// æ”¹ä¸ºæ›´å°çš„å°ºå¯¸ï¼Œæ”¾åœ¨å³ä¸Šè§’
<div className="absolute top-4 right-4 w-32">
  <input
    type="range"
    min="50"
    max="200"
    value={zoom * 100}
    onChange={(e) => setZoom(Number(e.target.value) / 100)}
    className="w-full"
  />
</div>
```

---

**æ­¥éª¤ 4ï¼šæ·»åŠ åŒå‡»é‡ç½®**

```tsx
const handleDoubleClick = () => {
  setZoom(1);
  setPan({ x: 0, y: 0 });
};

<img
  src={imageUrl}
  onDoubleClick={handleDoubleClick}
  // ... å…¶ä»– props
/>
```

---

#### æµ‹è¯•æ¸…å•

- [ ] é¼ æ ‡æ»šè½®å‘ä¸Š = æ”¾å¤§
- [ ] é¼ æ ‡æ»šè½®å‘ä¸‹ = ç¼©å°
- [ ] ç¼©æ”¾é™åˆ¶åœ¨ 0.5x - 2.0x
- [ ] æ‰‹æŒ‡æåˆæ”¾å¤§æ­£å¸¸ï¼ˆç§»åŠ¨ç«¯ï¼‰
- [ ] æ‰‹æŒ‡æåˆç¼©å°æ­£å¸¸ï¼ˆç§»åŠ¨ç«¯ï¼‰
- [ ] åŒå‡»é‡ç½®ç¼©æ”¾å’Œä½ç½®
- [ ] zoom sliderï¼ˆæˆ– +/- æŒ‰é’®ï¼‰æ­£å¸¸å·¥ä½œ
- [ ] ç¼©æ”¾åå¯ä»¥æ‹–æ‹½å¹³ç§»
- [ ] åœ¨ Chrome, Safari, Firefox éƒ½æ­£å¸¸

---

### Task 1.3: Category é»˜è®¤å€¼ï¼ˆ1hï¼‰

#### åŠŸèƒ½æè¿°
æ ¹æ® vendor è‡ªåŠ¨å¡«å……é»˜è®¤ categoryï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œã€‚

---

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/TransactionDataForms.tsx
æˆ–ç±»ä¼¼çš„ Category é€‰æ‹©ç»„ä»¶
```

**æ­¥éª¤ 1ï¼šåˆ›å»º vendor â†’ category æ˜ å°„**

```typescript
// å¯ä»¥æ”¾åœ¨ç»„ä»¶å†…éƒ¨æˆ–å•ç‹¬çš„ constants æ–‡ä»¶
const VENDOR_CATEGORY_DEFAULTS: Record<string, string> = {
  'the home depot': 'Materials & Supplies',
  'home depot': 'Materials & Supplies',
  'canadian tire': 'Materials & Supplies',
  'costco': 'Office Supplies',
  'staples': 'Office Supplies',
  // å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤š vendor
};

// è¾…åŠ©å‡½æ•°ï¼šè·å–é»˜è®¤ category
const getDefaultCategory = (vendorName: string | null): string | null => {
  if (!vendorName) return null;
  
  const normalized = vendorName.toLowerCase().trim();
  return VENDOR_CATEGORY_DEFAULTS[normalized] || null;
};
```

**æ­¥éª¤ 2ï¼šåœ¨ç»„ä»¶ä¸­åº”ç”¨é»˜è®¤å€¼**

```tsx
// åœ¨ Category é€‰æ‹©ç»„ä»¶ä¸­
const displayCategory = useMemo(() => {
  // ä¼˜å…ˆçº§ï¼š
  // 1. ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©çš„ category_user
  // 2. vendor é»˜è®¤ category
  // 3. AI è¿”å›çš„ category
  // 4. 'Other'
  
  if (transaction.category_user) {
    return transaction.category_user;
  }
  
  const defaultCategory = getDefaultCategory(transaction.vendor_name);
  if (defaultCategory) {
    return defaultCategory;
  }
  
  if (transaction.category) {
    return transaction.category;
  }
  
  return 'Other';
}, [transaction.category_user, transaction.vendor_name, transaction.category]);
```

**æ­¥éª¤ 3ï¼šç”¨æˆ·ä¿®æ”¹åä¿å­˜**

```tsx
const handleCategoryChange = async (newCategory: string) => {
  // ä¿å­˜åˆ° category_user å­—æ®µ
  await updateTransaction({
    category_user: newCategory
  });
};
```

**æ­¥éª¤ 4ï¼šUI æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰**

```tsx
// å¦‚æœæ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªå°æç¤º
{displayCategory === getDefaultCategory(transaction.vendor_name) && (
  <span className="text-xs text-gray-500 ml-2">
    (é»˜è®¤)
  </span>
)}
```

---

#### åç«¯ä¿®æ”¹

**âœ… æ— éœ€ä¿®æ”¹ï¼**

- `category_user` å­—æ®µå·²å­˜åœ¨
- åªéœ€å‰ç«¯é€»è¾‘è°ƒæ•´

---

#### æµ‹è¯•æ¸…å•

- [ ] Home Depot receipt è‡ªåŠ¨æ˜¾ç¤º "Materials & Supplies"
- [ ] Canadian Tire receipt è‡ªåŠ¨æ˜¾ç¤º "Materials & Supplies"
- [ ] Costco receipt è‡ªåŠ¨æ˜¾ç¤º "Office Supplies"
- [ ] æœªçŸ¥ vendor æ˜¾ç¤º AI è¿”å›çš„ category æˆ– 'Other'
- [ ] ç”¨æˆ·ä¿®æ”¹ category åï¼Œä¿å­˜æˆåŠŸ
- [ ] ä¸‹æ¬¡æ‰“å¼€åŒä¸€ receiptï¼Œæ˜¾ç¤ºç”¨æˆ·é€‰æ‹©çš„ category
- [ ] ä¸‹æ¬¡æ‰“å¼€åŒ vendor çš„æ–° receiptï¼Œä»æ˜¾ç¤ºé»˜è®¤å€¼
- [ ] é»˜è®¤å€¼å¯ä»¥æ­£å¸¸ä¿®æ”¹

---

## ğŸ”§ Week 2: å­—æ®µå¢å¼º

### Task 2.1: Notes å­—æ®µï¼ˆ2hï¼‰

#### åŠŸèƒ½æè¿°
æ·»åŠ  Notes å­—æ®µï¼Œå…è®¸ç”¨æˆ·è®°å½•å¤‡æ³¨ä¿¡æ¯ã€‚

---

#### æ•°æ®åº“ç¡®è®¤

**âœ… å­—æ®µå·²å­˜åœ¨ï¼š**
```sql
-- transactions è¡¨
notes TEXT
```

æ— éœ€æ•°æ®åº“ä¿®æ”¹ï¼

---

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/TransactionDetailSlideOver.tsx
æˆ– TransactionDataForms.tsx
```

**æ­¥éª¤ 1ï¼šæ·»åŠ  Notes è¾“å…¥æ¡†**

```tsx
// åœ¨ Category ä¸‹æ–¹æ·»åŠ 
<div className="space-y-2">
  <label className="block text-sm font-medium text-gray-700">
    Notes (optional)
  </label>
  
  <textarea
    value={notes || ''}
    onChange={(e) => setNotes(e.target.value)}
    onBlur={handleNotesBlur}
    placeholder="e.g. Return reason, customer request, project details..."
    rows={3}
    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
  />
  
  <p className="text-xs text-gray-500">
    Add notes for future reference or accounting records
  </p>
</div>
```

**æ­¥éª¤ 2ï¼šçŠ¶æ€ç®¡ç†**

```tsx
const [notes, setNotes] = useState(transaction.notes || '');

const handleNotesBlur = async () => {
  // åªåœ¨å†…å®¹æ”¹å˜æ—¶ä¿å­˜
  if (notes === transaction.notes) return;
  
  try {
    await updateTransaction({
      notes: notes.trim() || null
    });
    
    toast.success('Notes saved');
  } catch (error) {
    console.error('Failed to save notes:', error);
    toast.error('Failed to save notes');
  }
};
```

---

#### ç§»åŠ¨ç«¯åŒæ­¥

```tsx
// MobileBottomSheet.tsx
// æ·»åŠ ç›¸åŒçš„ textareaï¼Œå¯èƒ½éœ€è¦è°ƒæ•´æ ·å¼
```

---

#### æµ‹è¯•æ¸…å•

- [ ] Notes è¾“å…¥æ¡†æ­£å¸¸æ˜¾ç¤º
- [ ] å¯ä»¥è¾“å…¥å¤šè¡Œæ–‡æœ¬
- [ ] å¤±å»ç„¦ç‚¹æ—¶è‡ªåŠ¨ä¿å­˜
- [ ] ä¿å­˜æˆåŠŸåæ˜¾ç¤º toast
- [ ] åˆ·æ–°é¡µé¢å notes ä¿ç•™
- [ ] æ¸…ç©º notes åä¿å­˜ä¸º null
- [ ] ç§»åŠ¨ç«¯åŠŸèƒ½æ­£å¸¸

---

### Task 2.2: Project å­—æ®µï¼ˆ2-4hï¼‰

#### åŠŸèƒ½æè¿°
æ·»åŠ  Project é€‰æ‹©æ¡†ï¼Œæ”¯æŒé€‰æ‹©å·²æœ‰é¡¹ç›®æˆ–åˆ›å»ºæ–°é¡¹ç›®ã€‚

---

#### æ•°æ®åº“ç¡®è®¤

**âœ… å­—æ®µå·²å­˜åœ¨ï¼š**
```sql
-- transactions è¡¨
project_id UUID REFERENCES projects(id)

-- projects è¡¨
id UUID PRIMARY KEY
name VARCHAR(255)
user_id UUID
created_at TIMESTAMP
```

æ— éœ€æ•°æ®åº“ä¿®æ”¹ï¼

---

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/TransactionDetailSlideOver.tsx
æˆ– TransactionDataForms.tsx
```

**æ­¥éª¤ 1ï¼šè·å–é¡¹ç›®åˆ—è¡¨**

```tsx
// æ·»åŠ é¡¹ç›®åˆ—è¡¨æŸ¥è¯¢
const { data: projects, isLoading: projectsLoading } = useQuery({
  queryKey: ['projects'],
  queryFn: async () => {
    const res = await fetch('/api/projects');
    return res.json();
  }
});
```

**æ­¥éª¤ 2ï¼šæ·»åŠ  Project é€‰æ‹©æ¡†**

```tsx
<div className="space-y-2">
  <label className="block text-sm font-medium text-gray-700">
    Project (optional)
  </label>
  
  <select
    value={transaction.project_id || ''}
    onChange={handleProjectChange}
    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
  >
    <option value="">No project</option>
    
    {/* æœ€è¿‘é¡¹ç›®ï¼ˆå¯é€‰ï¼‰ */}
    {recentProjects?.length > 0 && (
      <optgroup label="Recent">
        {recentProjects.map(project => (
          <option key={project.id} value={project.id}>
            {project.name}
          </option>
        ))}
      </optgroup>
    )}
    
    {/* æ‰€æœ‰é¡¹ç›® */}
    <optgroup label="All Projects">
      {projects?.map(project => (
        <option key={project.id} value={project.id}>
          {project.name}
        </option>
      ))}
    </optgroup>
    
    {/* åˆ›å»ºæ–°é¡¹ç›® */}
    <option value="__create_new__">+ Create New Project</option>
  </select>
</div>
```

**æ­¥éª¤ 3ï¼šå¤„ç†é€‰æ‹©å˜æ›´**

```tsx
const handleProjectChange = async (e: React.ChangeEvent<HTMLSelectElement>) => {
  const value = e.target.value;
  
  if (value === '__create_new__') {
    // æ˜¾ç¤ºåˆ›å»ºé¡¹ç›®å¯¹è¯æ¡†
    setShowCreateProjectDialog(true);
    return;
  }
  
  try {
    await updateTransaction({
      project_id: value || null
    });
    
    toast.success('Project updated');
  } catch (error) {
    console.error('Failed to update project:', error);
    toast.error('Failed to update project');
  }
};
```

**æ­¥éª¤ 4ï¼šåˆ›å»ºé¡¹ç›®å¯¹è¯æ¡†ï¼ˆå¯é€‰ï¼Œç®€åŒ–ç‰ˆï¼‰**

```tsx
const [showCreateProjectDialog, setShowCreateProjectDialog] = useState(false);
const [newProjectName, setNewProjectName] = useState('');

const handleCreateProject = async () => {
  if (!newProjectName.trim()) {
    toast.error('Project name is required');
    return;
  }
  
  try {
    const res = await fetch('/api/projects', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: newProjectName })
    });
    
    const newProject = await res.json();
    
    // å°†æ–°é¡¹ç›®åº”ç”¨åˆ°å½“å‰ transaction
    await updateTransaction({
      project_id: newProject.id
    });
    
    toast.success('Project created');
    setShowCreateProjectDialog(false);
    setNewProjectName('');
    
  } catch (error) {
    console.error('Failed to create project:', error);
    toast.error('Failed to create project');
  }
};

// å¯¹è¯æ¡† UIï¼ˆç®€åŒ–ç‰ˆï¼‰
{showCreateProjectDialog && (
  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div className="bg-white rounded-lg p-6 max-w-md w-full">
      <h3 className="text-lg font-semibold mb-4">Create New Project</h3>
      
      <input
        type="text"
        value={newProjectName}
        onChange={(e) => setNewProjectName(e.target.value)}
        placeholder="Project name"
        className="w-full px-3 py-2 border rounded-lg mb-4"
        autoFocus
      />
      
      <div className="flex gap-2 justify-end">
        <button
          onClick={() => setShowCreateProjectDialog(false)}
          className="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg"
        >
          Cancel
        </button>
        <button
          onClick={handleCreateProject}
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          Create
        </button>
      </div>
    </div>
  </div>
)}
```

---

#### åç«¯ä¿®æ”¹ï¼ˆå¦‚æœ API ä¸å­˜åœ¨ï¼‰

**æ£€æŸ¥æ˜¯å¦å·²æœ‰ï¼š**
```
GET /api/projects
POST /api/projects
```

**å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºï¼š**

```typescript
// apps/api/src/routes/projects/route.ts

// GET /api/projects
export async function GET(req: Request) {
  const userId = getUserId(req);
  
  const projects = await db.projects
    .where({ user_id: userId })
    .orderBy('created_at', 'desc')
    .select();
  
  return Response.json(projects);
}

// POST /api/projects
export async function POST(req: Request) {
  const userId = getUserId(req);
  const { name } = await req.json();
  
  if (!name || typeof name !== 'string') {
    return Response.json({ error: 'Name is required' }, { status: 400 });
  }
  
  const project = await db.projects.insert({
    id: crypto.randomUUID(),
    user_id: userId,
    name: name.trim(),
    created_at: new Date()
  });
  
  return Response.json(project);
}
```

---

#### æµ‹è¯•æ¸…å•

- [ ] Project ä¸‹æ‹‰æ­£å¸¸æ˜¾ç¤º
- [ ] å¯ä»¥é€‰æ‹©å·²æœ‰é¡¹ç›®
- [ ] é€‰æ‹©åæ­£ç¡®ä¿å­˜
- [ ] å¯ä»¥æ¸…é™¤é¡¹ç›®ï¼ˆé€‰æ‹©"No project"ï¼‰
- [ ] ç‚¹å‡»"Create New Project"æ˜¾ç¤ºå¯¹è¯æ¡†
- [ ] å¯ä»¥åˆ›å»ºæ–°é¡¹ç›®
- [ ] æ–°é¡¹ç›®åˆ›å»ºåè‡ªåŠ¨åº”ç”¨åˆ°å½“å‰ transaction
- [ ] åˆ·æ–°é¡µé¢åé¡¹ç›®ä¿ç•™
- [ ] ç§»åŠ¨ç«¯åŠŸèƒ½æ­£å¸¸

---

## ğŸ”§ Week 3: UI ç²¾ç®€ + æµ‹è¯•

### Task 3.1: GIFI å­—æ®µè°ƒæ•´ï¼ˆ30minï¼‰

#### åŠŸèƒ½æè¿°
å°† GIFI å­—æ®µç§»åˆ°"é«˜çº§é€‰é¡¹"æˆ–"ä¼šè®¡æ¨¡å¼"ï¼Œä¸åœ¨ä¸»ç•Œé¢æ˜¾ç¤ºã€‚

---

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/TransactionDetailSlideOver.tsx
```

**é€‰é¡¹ Aï¼šç§»åˆ°æŠ˜å åŒºåŸŸ**

```tsx
// æ·»åŠ "Advanced"æŠ˜å åŒº
const [showAdvanced, setShowAdvanced] = useState(false);

// ä¸»ç•Œé¢
<div>
  {/* Category, Notes, Project ç­‰ä¸»è¦å­—æ®µ */}
  
  {/* æŠ˜å æŒ‰é’® */}
  <button
    onClick={() => setShowAdvanced(!showAdvanced)}
    className="text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1"
  >
    {showAdvanced ? 'éšè—é«˜çº§é€‰é¡¹' : 'æ˜¾ç¤ºé«˜çº§é€‰é¡¹'}
    <ChevronDownIcon className={`w-4 h-4 transition-transform ${showAdvanced ? 'rotate-180' : ''}`} />
  </button>
  
  {/* æŠ˜å å†…å®¹ */}
  {showAdvanced && (
    <div className="mt-4 pt-4 border-t space-y-4">
      <div className="space-y-2">
        <label className="block text-sm font-medium text-gray-700">
          GIFI Code
        </label>
        <input
          type="text"
          value={gifiCode || ''}
          onChange={(e) => setGifiCode(e.target.value)}
          placeholder="Optional"
          className="w-full px-3 py-2 border rounded-lg"
        />
        <p className="text-xs text-gray-500">
          For accounting and tax purposes
        </p>
      </div>
    </div>
  )}
</div>
```

**é€‰é¡¹ Bï¼šåªåœ¨"ä¼šè®¡æ¨¡å¼"æ˜¾ç¤º**

```tsx
// è¯»å–ç”¨æˆ·è®¾ç½®
const { accountingMode } = useSettings();

// åªåœ¨ä¼šè®¡æ¨¡å¼æ˜¾ç¤º
{accountingMode && (
  <div className="space-y-2">
    <label>GIFI Code</label>
    <input ... />
  </div>
)}
```

---

#### æµ‹è¯•æ¸…å•

- [ ] é»˜è®¤ä¸æ˜¾ç¤º GIFI
- [ ] ç‚¹å‡»"é«˜çº§é€‰é¡¹"åæ˜¾ç¤º GIFI
- [ ] GIFI å¯ä»¥æ­£å¸¸è¾“å…¥å’Œä¿å­˜
- [ ] æŠ˜å çŠ¶æ€ä¿ç•™ï¼ˆæˆ–æ¯æ¬¡é»˜è®¤æŠ˜å ï¼‰

---

### Task 3.2: åˆ é™¤ä¸­æ–‡ä¹±ç ï¼ˆ30minï¼‰

#### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶ä½ç½®ï¼š**
```
apps/web-app/src/components/transactions/TransactionDetailSlideOver.tsx
æˆ–ç›¸å…³çš„ Tax æ˜¾ç¤ºç»„ä»¶
```

**ä¿®æ”¹ 1ï¼šCanada tax breakdown æç¤º**

```tsx
// å½“å‰
<div>
  <p>Canada tax breakdown</p>
  <p className="text-yellow-600">
    ç¨ç‡æç¤ºï¼šç¨å…¨éå®ŒæˆæˆåŠŸï¼Œæå—æ•°
    è¯·æ ¸å¯¦å¾Œå†é»ã€Œç¢ºèªæ•¸æ“šã€ã€‚
  </p>
</div>

// ä¿®æ”¹å
<div>
  <p className="font-medium">Canada tax breakdown</p>
  {/* åªåœ¨ç¨ç‡å¼‚å¸¸æ—¶æ˜¾ç¤ºè­¦å‘Š */}
  {taxRateAbnormal && (
    <p className="text-sm text-yellow-600">
      Tax rates may be incorrect. Please verify.
    </p>
  )}
</div>
```

**ä¿®æ”¹ 2ï¼šè¯†åˆ«ä¸­çš„å ä½ç¬¦**

```tsx
// å½“å‰
vendor: "AI æ­£åœ¨è­˜åˆ¥ä¸­..."
date: "è¯†åˆ«ä¸­"

// ä¿®æ”¹å
vendor: "Analyzing..."
date: "Analyzing..."
total: "Analyzing..."
```

æ‰¾åˆ°æ˜¾ç¤ºè¿™äº›å ä½ç¬¦çš„åœ°æ–¹ï¼Œç»Ÿä¸€æ”¹ä¸ºè‹±æ–‡ã€‚

---

#### æµ‹è¯•æ¸…å•

- [ ] Canada tax breakdown ä¸æ˜¾ç¤ºä¸­æ–‡
- [ ] è¯†åˆ«ä¸­çš„å ä½ç¬¦ä¸ºè‹±æ–‡
- [ ] æ²¡æœ‰å…¶ä»–ä¸­æ–‡ä¹±ç æ®‹ç•™

---

### Task 3.3: å…¶ä»– UI å¾®è°ƒï¼ˆ30minï¼‰

#### å°ä¼˜åŒ–æ¸…å•

1. **ç»Ÿä¸€ loading çŠ¶æ€æ˜¾ç¤º**
   - ä½¿ç”¨ä¸€è‡´çš„ LoadingSpinner ç»„ä»¶
   - ç»Ÿä¸€ loading æ–‡æ¡ˆ

2. **ç»Ÿä¸€æŒ‰é’®æ ·å¼**
   - ä¸»æŒ‰é’®ï¼šè“è‰²
   - æ¬¡æŒ‰é’®ï¼šç°è‰²
   - å±é™©æŒ‰é’®ï¼šçº¢è‰²

3. **ä¼˜åŒ–é—´è·**
   - ç¡®ä¿å­—æ®µä¹‹é—´é—´è·ä¸€è‡´
   - ç§»åŠ¨ç«¯é€‚é…

---

### Task 3.4: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3hï¼‰

#### å®Œæ•´æµ‹è¯•æ¸…å•

**åŠŸèƒ½æµ‹è¯•ï¼š**

- [ ] **é‡æ–°è¯†åˆ«**
  - [ ] æŒ‰é’®åœ¨æ­£ç¡®æ¡ä»¶ä¸‹æ˜¾ç¤º
  - [ ] ç‚¹å‡»åæ­£ç¡®è°ƒç”¨ API
  - [ ] Loading çŠ¶æ€æ­£ç¡®
  - [ ] æˆåŠŸ/å¤±è´¥æç¤ºæ­£ç¡®

- [ ] **å›¾ç‰‡ç¼©æ”¾**
  - [ ] é¼ æ ‡æ»šè½®ç¼©æ”¾æµç•…
  - [ ] æ‰‹æŒ‡æåˆç¼©æ”¾æµç•…ï¼ˆç§»åŠ¨ç«¯ï¼‰
  - [ ] åŒå‡»é‡ç½®æ­£å¸¸
  - [ ] ç¼©æ”¾é™åˆ¶åœ¨ 0.5x - 2.0x

- [ ] **Category é»˜è®¤å€¼**
  - [ ] Home Depot = Material
  - [ ] Canadian Tire = Material
  - [ ] Costco = Office Supplies
  - [ ] ç”¨æˆ·ä¿®æ”¹åä¿å­˜
  - [ ] ä¸‹æ¬¡æ‰“å¼€è®°ä½ç”¨æˆ·é€‰æ‹©

- [ ] **Notes å­—æ®µ**
  - [ ] å¯ä»¥è¾“å…¥å¤šè¡Œ
  - [ ] è‡ªåŠ¨ä¿å­˜
  - [ ] æ¸…ç©ºä¿å­˜ä¸º null

- [ ] **Project å­—æ®µ**
  - [ ] ä¸‹æ‹‰æ­£å¸¸
  - [ ] é€‰æ‹©ä¿å­˜
  - [ ] åˆ›å»ºæ–°é¡¹ç›®

- [ ] **GIFI å­—æ®µ**
  - [ ] é»˜è®¤éšè—
  - [ ] é«˜çº§é€‰é¡¹ä¸­å¯è§

**æµè§ˆå™¨å…¼å®¹æ€§ï¼š**
- [ ] Chrome
- [ ] Safari
- [ ] Firefox
- [ ] Edge

**å“åº”å¼æµ‹è¯•ï¼š**
- [ ] æ¡Œé¢ï¼ˆ1920x1080ï¼‰
- [ ] å¹³æ¿ï¼ˆ768x1024ï¼‰
- [ ] æ‰‹æœºï¼ˆ375x667ï¼‰

**æ€§èƒ½æµ‹è¯•ï¼š**
- [ ] å›¾ç‰‡ç¼©æ”¾ä¸å¡é¡¿
- [ ] é¡µé¢åŠ è½½é€Ÿåº¦æ­£å¸¸

---

## ğŸ“ ä»£ç é£æ ¼æŒ‡å—

### TypeScript ç±»å‹

```typescript
// æ·»åŠ æ–°å­—æ®µçš„ç±»å‹å®šä¹‰
interface Transaction {
  // ... ç°æœ‰å­—æ®µ
  notes: string | null;
  project_id: string | null;
  category_user: string | null;
}

interface Project {
  id: string;
  name: string;
  user_id: string;
  created_at: string;
}
```

---

### å‘½åè§„èŒƒ

```typescript
// çŠ¶æ€ï¼šuse + æè¿° + çŠ¶æ€ç±»å‹
const [isReAnalyzing, setIsReAnalyzing] = useState(false);
const [showAdvanced, setShowAdvanced] = useState(false);

// å‡½æ•°ï¼šhandle + åŠ¨ä½œ
const handleReAnalyze = async () => { ... };
const handleProjectChange = async (e) => { ... };

// å¸¸é‡ï¼šå¤§å†™ + ä¸‹åˆ’çº¿
const VENDOR_CATEGORY_DEFAULTS = { ... };
```

---

### ç»„ä»¶ç»“æ„

```tsx
// 1. Imports
import { useState } from 'react';
import { toast } from 'sonner';

// 2. ç±»å‹å®šä¹‰
interface Props { ... }

// 3. å¸¸é‡
const VENDOR_CATEGORY_DEFAULTS = { ... };

// 4. ç»„ä»¶
export function Component({ ... }: Props) {
  // 4.1 Hooks
  const [state, setState] = useState();
  
  // 4.2 äº‹ä»¶å¤„ç†
  const handleEvent = () => { ... };
  
  // 4.3 å‰¯ä½œç”¨
  useEffect(() => { ... }, []);
  
  // 4.4 æ¸²æŸ“
  return ( ... );
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: API è°ƒç”¨å¤±è´¥

**é—®é¢˜ï¼š** é‡æ–°è¯†åˆ«æŒ‰é’®ç‚¹å‡»åæŠ¥ 404

**æ’æŸ¥ï¼š**
```typescript
// æ£€æŸ¥ API endpoint
console.log(`/api/transactions/${transaction.id}/analyze`);

// æ£€æŸ¥ transaction.id æ˜¯å¦å­˜åœ¨
console.log('Transaction ID:', transaction.id);
```

**è§£å†³ï¼š**
- ç¡®è®¤ API route å­˜åœ¨
- ç¡®è®¤ transaction.id æ­£ç¡®

---

### Q2: å›¾ç‰‡ç¼©æ”¾ä¸æµç•…

**é—®é¢˜ï¼š** é¼ æ ‡æ»šè½®ç¼©æ”¾æœ‰å»¶è¿Ÿ

**æ’æŸ¥ï¼š**
```typescript
// æ£€æŸ¥ CSS transform æ˜¯å¦æ­£ç¡®
// æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–äº‹ä»¶ç›‘å¬å™¨å†²çª
```

**è§£å†³ï¼š**
```typescript
// ç¡®ä¿ preventDefault
e.preventDefault();

// ä½¿ç”¨ CSS transformï¼ˆå·²æœ‰ï¼‰
style={{ transform: `scale(${zoom})` }}
```

---

### Q3: ç§»åŠ¨ç«¯æåˆç¼©æ”¾ä¸å·¥ä½œ

**é—®é¢˜ï¼š** æ‰‹æŒ‡æåˆæ²¡æœ‰ååº”

**æ’æŸ¥ï¼š**
```typescript
console.log('Touches:', e.touches.length);
```

**è§£å†³ï¼š**
```typescript
// ç¡®ä¿æ·»åŠ äº†æ‰€æœ‰ touch äº‹ä»¶
onTouchStart={handleTouchStart}
onTouchMove={handleTouchMove}
onTouchEnd={handleTouchEnd}

// ç¡®ä¿ preventDefaultï¼ˆé˜»æ­¢æµè§ˆå™¨é»˜è®¤ç¼©æ”¾ï¼‰
if (e.touches.length === 2) {
  e.preventDefault();
}
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

**äº§å“é—®é¢˜ï¼š** GPT (CPO)  
**æŠ€æœ¯é—®é¢˜ï¼š** CTO (Claude Code)  
**æ–‡æ¡£é—®é¢˜ï¼š** CDO (Claude Web AI)

---

## âœ… å®Œæˆå

### æäº¤å‰æ£€æŸ¥

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å·² lint
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
- [ ] æ›´æ–°äº† CHANGELOGï¼ˆå¦‚æœæœ‰ï¼‰

---

### é€šçŸ¥å›¢é˜Ÿ

**æ¶ˆæ¯æ¨¡æ¿ï¼š**

```
âœ… Receipt è¯¦æƒ…é¡µ P2 ä¼˜åŒ–å®Œæˆ

æ–°å¢åŠŸèƒ½ï¼š
- é‡æ–°è¯†åˆ«æŒ‰é’®ï¼ˆè¯†åˆ«å¤±è´¥æ—¶å¯é‡è¯•ï¼‰
- å›¾ç‰‡ç¼©æ”¾ä¼˜åŒ–ï¼ˆé¼ æ ‡æ»šè½® + æ‰‹æŒ‡æåˆï¼‰
- Category è‡ªåŠ¨å¡«å……ï¼ˆHome Depot = Materialï¼‰
- Notes å­—æ®µï¼ˆè®°å½•å¤‡æ³¨ï¼‰
- Project å­—æ®µï¼ˆæ‰¿åŒ…å•†æŒ‰é¡¹ç›®åˆ†ç±»ï¼‰
- GIFI ç§»åˆ°é«˜çº§é€‰é¡¹

UI æ”¹è¿›ï¼š
- åˆ é™¤ä¸­æ–‡ä¹±ç 
- ç»Ÿä¸€æŒ‰é’®æ ·å¼
- ä¼˜åŒ–é—´è·

æµ‹è¯•ï¼š
- åŠŸèƒ½æµ‹è¯•é€šè¿‡
- æµè§ˆå™¨å…¼å®¹æ€§éªŒè¯
- ç§»åŠ¨ç«¯é€‚é…å®Œæˆ

å¾…éªŒæ”¶ï¼šCEO + GPT (CPO)
```

**ç„¶åé€šçŸ¥ CDO æ›´æ–°æ–‡æ¡£ï¼**

---

**ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¶é—´ï¼š** 2026-02-01  
**è´Ÿè´£äººï¼š** CDO (Claude Web AI)  
**ä»»åŠ¡çŠ¶æ€ï¼š** å¾…å®æ–½

---

**æ€»å·¥ä½œé‡ï¼š** 14-19 å°æ—¶  
**æ¨èæ—¶é—´è¡¨ï¼š** 3 å‘¨ï¼ˆæ¯å‘¨ 5-7 å°æ—¶ï¼‰

---

**è®°ä½ï¼šè¿™æ˜¯ P2 ä»»åŠ¡ï¼Œåœ¨ P0/P1 å®Œæˆåå†å¼€å§‹ï¼** âœ…
