# TypeScript æ„å»ºé”™è¯¯ï¼šNullish Coalescing è¯­æ³•é—®é¢˜

> **æ–‡æ¡£ç±»å‹ï¼š** é—®é¢˜æ’æŸ¥  
> **å‘ç°æ—¶é—´ï¼š** 2026-02-01  
> **ä¸¥é‡ç¨‹åº¦ï¼š** ğŸ”´ é«˜ï¼ˆé˜»å¡æ„å»ºï¼‰  
> **çŠ¶æ€ï¼š** ğŸ”§ å¾…ä¿®å¤  

---

## ğŸš¨ é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯

```
Build Error
Ã— Nullish coalescing operator(??) requires parens when mixing with logical operators
```

### é”™è¯¯ä½ç½®

- **æ–‡ä»¶ï¼š** `/app/components/transactions/TransactionsTable.tsx`
- **è¡Œå·ï¼š** 58
- **ä»£ç ï¼š**
  
  ```typescript
  const statusLabel = dbStatus === 'approved' ? âœ“ $(DB_LABEL(dbStatus) ?? dbStatus
  ```

### é”™è¯¯åŸå› 

TypeScript/ESLint è§„åˆ™ï¼šå½“ `??` (nullish coalescing æ“ä½œç¬¦) å’Œ `?` (ä¸‰å…ƒè¿ç®—ç¬¦) æ··ç”¨æ—¶ï¼Œéœ€è¦ç”¨æ‹¬å·æ˜ç¡®ä¼˜å…ˆçº§ã€‚

---

## ğŸ‘¥ è§’è‰²åˆ†å·¥ï¼ˆæŒ‰ AI åä½œè§„èŒƒï¼‰

| è§’è‰²                    | è´Ÿè´£å†…å®¹        | çŠ¶æ€     |
| --------------------- | ----------- | ------ |
| **CEO**               | å‘ç°é—®é¢˜ï¼Œæäº¤ç»™å›¢é˜Ÿ  | âœ… å·²å®Œæˆ  |
| **CTO** (Claude Code) | è¯Šæ–­æ ¹å› ï¼Œæä¾›ä¿®å¤æ–¹æ¡ˆ | â³ å¾…å¤„ç†  |
| **å·¥ç¨‹** (Cursor)       | æ‰§è¡Œä¿®å¤ï¼Œæµ‹è¯•éªŒè¯   | â³ å¾…å¤„ç†  |
| **CPO** (GPT)         | è¯„ä¼°ä¼šè®¡å½±å“      | â³ å¾…å¤„ç†  |
| **CDO** (Claude Web)  | è®°å½•é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ   | ğŸ”„ è¿›è¡Œä¸­ |

---

## ğŸ” CTO åˆ†æï¼ˆå¾… Claude Code è¡¥å……ï¼‰

### é—®é¢˜åˆ†ç±»

- [ ] è¯­æ³•é”™è¯¯ï¼ˆSyntax Errorï¼‰âœ… **æ˜¯è¿™ä¸ª**
- [ ] è¿è¡Œæ—¶é”™è¯¯ï¼ˆRuntime Errorï¼‰
- [ ] é€»è¾‘é”™è¯¯ï¼ˆLogic Bugï¼‰
- [ ] æ€§èƒ½é—®é¢˜ï¼ˆPerformance Issueï¼‰

### å½±å“èŒƒå›´è¯„ä¼°

**å—å½±å“æ¨¡å—ï¼š**

- âœ… TransactionsTable ç»„ä»¶
- â“ æ˜¯å¦å½±å“å…¶ä»–ä½¿ç”¨ `dbStatus` çš„åœ°æ–¹ï¼Ÿï¼ˆéœ€ CTO ç¡®è®¤ï¼‰

**é˜»å¡çº§åˆ«ï¼š**

- âœ… é˜»å¡æ„å»ºï¼ˆæ— æ³•ç¼–è¯‘ï¼‰
- âœ… é˜»å¡å¼€å‘
- âœ… é˜»å¡éƒ¨ç½²

### ç³»ç»Ÿæ€§é£é™©

**éœ€è¦ CTO æ£€æŸ¥ï¼š**

- [ ] ä»£ç åº“ä¸­æ˜¯å¦æœ‰å…¶ä»–ç±»ä¼¼çš„ `?? + ?` æ··ç”¨æƒ…å†µï¼Ÿ
- [ ] ESLint é…ç½®æ˜¯å¦éœ€è¦æ›´æ–°ï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦åœ¨ pre-commit hook ä¸­åŠ å…¥æ­¤è§„åˆ™æ£€æŸ¥ï¼Ÿ

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆï¼ˆå¾… Cursor å®æ–½ï¼‰

### æ–¹æ¡ˆ 1ï¼šåŠ æ‹¬å·ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

**ä¿®æ”¹å‰ï¼š**

```typescript
const statusLabel = dbStatus === 'approved' ? âœ“ $(DB_LABEL(dbStatus) ?? dbStatus
```

**ä¿®æ”¹åï¼š**

```typescript
const statusLabel = dbStatus === 'approved' ? âœ“ $((DB_LABEL(dbStatus) ?? dbStatus))
```

**è¯´æ˜ï¼š** ç”¨æ‹¬å·åŒ…è£¹ `??` è¡¨è¾¾å¼ï¼Œæ˜ç¡®ä¼˜å…ˆçº§

---

### æ–¹æ¡ˆ 2ï¼šæ‹†åˆ†é€»è¾‘ï¼ˆå¦‚æœé€»è¾‘å¤æ‚ï¼‰

**ä¿®æ”¹åï¼š**

```typescript
const label = DB_LABEL(dbStatus) ?? dbStatus;
const statusLabel = dbStatus === 'approved' ? âœ“ $(label) : label;
```

**è¯´æ˜ï¼š** å…ˆå¤„ç† `??`ï¼Œå†å¤„ç†ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œé€»è¾‘æ›´æ¸…æ™°

---

### æ–¹æ¡ˆé€‰æ‹©

**æ¨èï¼š** æ–¹æ¡ˆ 1ï¼ˆåŠ æ‹¬å·ï¼‰

**ç†ç”±ï¼š**

- æ”¹åŠ¨æœ€å°
- æ€§èƒ½æ— å½±å“
- ç¬¦åˆ TypeScript è§„èŒƒ

---

## ğŸ“Š CPO å½±å“è¯„ä¼°ï¼ˆå¾… GPT è¡¥å……ï¼‰

### ä¼šè®¡å¯ç”¨æ€§å½±å“

**å½“å‰çŠ¶æ€ï¼š**

- âŒ äº¤æ˜“åˆ—è¡¨é¡µæ— æ³•åŠ è½½
- âŒ ä¼šè®¡æ— æ³•æŸ¥çœ‹äº¤æ˜“çŠ¶æ€
- âŒ å½±å“æ ¸å¿ƒåŠŸèƒ½

**ä¼˜å…ˆçº§è¯„ä¼°ï¼š**

- ğŸ”´ **P0 - ç´§æ€¥ä¿®å¤**ï¼ˆé˜»å¡æ ¸å¿ƒåŠŸèƒ½ï¼‰

### ç”¨æˆ·é€šçŸ¥

**æ˜¯å¦éœ€è¦é€šçŸ¥ç”¨æˆ·ï¼Ÿ**

- âŒ ä¸éœ€è¦ï¼ˆå¼€å‘ç¯å¢ƒé—®é¢˜ï¼Œæœªå½±å“ç”Ÿäº§ï¼‰

---

## âš¡ ä¿®å¤æ­¥éª¤ï¼ˆCursor æ‰§è¡Œæ¸…å•ï¼‰

### Step 1: ä¿®æ”¹ä»£ç 

```bash
# æ‰“å¼€æ–‡ä»¶
code /app/components/transactions/TransactionsTable.tsx

# ä¿®æ”¹ line 58
# åŸ: const statusLabel = dbStatus === 'approved' ? âœ“ $(DB_LABEL(dbStatus) ?? dbStatus
# æ–°: const statusLabel = dbStatus === 'approved' ? âœ“ $((DB_LABEL(dbStatus) ?? dbStatus))
```

### Step 2: éªŒè¯ä¿®å¤

```bash
# é‡æ–°æ„å»º
npm run build

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»– TypeScript é”™è¯¯
npm run type-check

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨æµ‹è¯•
npm run dev
```

### Step 3: æµ‹è¯•åŠŸèƒ½

- [ ] è®¿é—® `/transactions` é¡µé¢
- [ ] ç¡®è®¤äº¤æ˜“åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [ ] ç¡®è®¤çŠ¶æ€æ ‡ç­¾æ­£ç¡®æ˜¾ç¤º
- [ ] æµ‹è¯•ä¸åŒçŠ¶æ€ï¼ˆapproved / pending / rejectedï¼‰

### Step 4: æäº¤ä»£ç 

```bash
git add /app/components/transactions/TransactionsTable.tsx
git commit -m "fix: add parens for nullish coalescing with ternary operator

- Fixed TypeScript syntax error in TransactionsTable
- Added parentheses to clarify operator precedence
- Ref: troubleshooting/2026-02-01_é—®é¢˜_TypeScript-Nullish-Coalescingè¯­æ³•é”™è¯¯.md"

git push
```

---

## ğŸ”„ é¢„é˜²æªæ–½ï¼ˆåç»­æ”¹è¿›ï¼‰

### 1. ESLint è§„åˆ™æ›´æ–°

```json
// .eslintrc.json
{
  "rules": {
    "no-mixed-operators": ["error", {
      "groups": [
        ["??", "||", "&&"],
        ["?:", "??"]
      ]
    }]
  }
}
```

### 2. Pre-commit Hook

ç¡®ä¿ `husky + lint-staged` åœ¨æäº¤å‰è¿è¡Œï¼š

```bash
npm run type-check
npm run lint
```

### 3. ä»£ç å®¡æŸ¥æ¸…å•

åœ¨ PR æ¨¡æ¿ä¸­åŠ å…¥ï¼š

- [ ] æ˜¯å¦æœ‰ `?? + ?` æ··ç”¨æƒ…å†µï¼Ÿ
- [ ] TypeScript æ„å»ºæ˜¯å¦é€šè¿‡ï¼Ÿ

---

## ğŸ“ æ ¹å› åˆ†æï¼ˆ5 Whyï¼‰

1. **ä¸ºä»€ä¹ˆæ„å»ºå¤±è´¥ï¼Ÿ**  
   å› ä¸º TypeScript è¯­æ³•é”™è¯¯

2. **ä¸ºä»€ä¹ˆæœ‰è¯­æ³•é”™è¯¯ï¼Ÿ**  
   å› ä¸º `??` å’Œ `?` æ··ç”¨æ—¶æ²¡åŠ æ‹¬å·

3. **ä¸ºä»€ä¹ˆæ²¡åŠ æ‹¬å·ï¼Ÿ**  
   å› ä¸ºå¼€å‘è€…ä¸æ¸…æ¥šè¿™ä¸ªè§„åˆ™ï¼Œæˆ–è€… ESLint æ²¡æœ‰å³æ—¶æç¤º

4. **ä¸ºä»€ä¹ˆ ESLint æ²¡æœ‰æç¤ºï¼Ÿ**  
   å› ä¸ºå¯èƒ½åœ¨ç¼–è¾‘å™¨ä¸­æ²¡æœ‰é…ç½®å®æ—¶æ£€æŸ¥ï¼Œæˆ–è€…è§„åˆ™ä¸å¤Ÿä¸¥æ ¼

5. **å¦‚ä½•é¿å…å†æ¬¡å‘ç”Ÿï¼Ÿ**  
   
   - æ›´æ–° ESLint é…ç½®
   - åŠ å¼º pre-commit æ£€æŸ¥
   - å›¢é˜ŸåŸ¹è®­ TypeScript æ“ä½œç¬¦ä¼˜å…ˆçº§è§„åˆ™

---

## ğŸ“š ç›¸å…³çŸ¥è¯†

### TypeScript æ“ä½œç¬¦ä¼˜å…ˆçº§

| æ“ä½œç¬¦  | åç§°                 | ä¼˜å…ˆçº§ |
| ---- | ------------------ | --- |
| `?:` | ä¸‰å…ƒè¿ç®—ç¬¦              | ä½   |
| `??` | Nullish coalescing | ä½   |
| `&&` | é€»è¾‘ä¸                | ä¸­   |
| `    |                    | `   |

**è§„åˆ™ï¼š** å½“ä¼˜å…ˆçº§ç›¸è¿‘çš„æ“ä½œç¬¦æ··ç”¨æ—¶ï¼Œå¿…é¡»ç”¨æ‹¬å·æ˜ç¡®é¡ºåº

### å‚è€ƒèµ„æ–™

- [MDN: Nullish coalescing operator](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing)
- [TypeScript: Operator Precedence](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html)

---

## âœ… è§£å†³ç¡®è®¤

### ä¿®å¤å®Œæˆåå¡«å†™ï¼š

- [ ] ä»£ç å·²ä¿®æ”¹
- [ ] æ„å»ºå·²é€šè¿‡
- [ ] åŠŸèƒ½å·²æµ‹è¯•
- [ ] ä»£ç å·²æäº¤
- [ ] é¢„é˜²æªæ–½å·²å®æ–½

**ä¿®å¤äººï¼š** _______  
**ä¿®å¤æ—¶é—´ï¼š** _______  
**éªŒè¯äººï¼š** _______

---

## ğŸ“ é™„ä»¶

- é”™è¯¯æˆªå›¾ï¼š[å·²ä¸Šä¼ ]
- ä¿®å¤ä»£ç å¯¹æ¯”ï¼š[å¾…è¡¥å……]
- æµ‹è¯•æˆªå›¾ï¼š[å¾…è¡¥å……]

---

## ğŸ“ æ›´æ–°æ—¥å¿—

| æ—¥æœŸ         | æ›´æ–°å†…å®¹          | æ›´æ–°äºº              |
| ---------- | ------------- | ---------------- |
| 2026-02-01 | åˆå§‹åˆ›å»ºï¼Œè®°å½•é—®é¢˜     | CDO (Claude Web) |
| 2026-02-01 | å¾… CTO è¡¥å……è¯Šæ–­åˆ†æ  | -                |
| 2026-02-01 | å¾… Cursor æ‰§è¡Œä¿®å¤ | -                |
| 2026-02-01 | å¾… CPO è¯„ä¼°å½±å“    | -                |

---

**å½“å‰çŠ¶æ€ï¼š** ğŸ”§ å¾…ä¿®å¤  
**ä¸‹ä¸€æ­¥ï¼š** CTO è¯Šæ–­ â†’ Cursor ä¿®å¤ â†’ GPT è¯„ä¼° â†’ CDO å½’æ¡£

---

*æ­¤æ–‡æ¡£ä¼šåœ¨é—®é¢˜è§£å†³åç§»è‡³ `troubleshooting/2026-02-01_é—®é¢˜_TypeScript-Nullish-Coalescingè¯­æ³•é”™è¯¯.md`*
